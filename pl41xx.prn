SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   1
PL41XX  Z80

    1                   ;---------------------------------------------------------------------
    2                   ; Reassemblerlisting des BASIC-Plotter-Treibers PLOT41XX.KCC
    3                   ; mit Einarbeitung der Kommentare aus graf.asm (grafik.zip) vom KC87
    4                   ;
    5                   ; Original stammt das Programm vom KC87 mit Grafik-Zusatzmodul.
    6                   ; Deshalb werden Ausgaben zu Portadresse 0B8H gemacht, diese gehoeren
    7                   ; beim KC85 dem EPROMMER-Modul, beim KC87 zum Grafik-Modul!
    8                   ;---------------------------------------------------------------------
    9                   ;
   10                   ; Speicherbelegung:		Ladebereich	6200H-7800H
   11                   ; wird zur Ausfuehrung umgeladen nach RAM8:	9600H-A9FFH
   12                   ;	0234H - 035BH		Arbeitszellen im RAM
   13                   ;	9400H - 9604H	516 Byte frei
   14                   ;	9605H - 96DFH		Token-Zeichenketten
   15                   ;	96E0H - 96F5H		BASIC-Erweiterungstoken verarbeiten
   16                   ;	96F6H - 9749H		Token-Sprungtabelle
   17                   ;	974AH - 974FH	6 Byte frei
   18                   ;	9750H - 9769H		neue BASIC-Begruessungsmeldung
   19                   ;	976AH - 97FFH	150 Byte frei
   20                   ;	9800H - A32BH		physischer Plotter-Treiber
   21                   ;	A32CH - A7BEH		BASIC-Interface
   22                   ;	A7BFH - A7D5H	23 Byte frei
   23                   ;	A7D6H - A7FFH		Sprungverteiler (eigentlich unnoetig)
   24                   ;	A800H - A9FAH	507 Byte frei
   25                   ;	A9FBH - BFFFH	5.637 Byte frei	(INIT-Programm)
   26                   ; => insgesamt mehr als 6 KByte freier Speicherplatz dazwischen frei?
   27                   ;
   28                   ; Modifikationen/Fehlerbeseitigung:
   29                   ; - Startprogramm von Wolf-Peter Wruck, ersetzt durch eine Variante
   30                   ;   fuer CAOS 3.1-4.8 (kopiert die Original-Tokenadressen aus CAOS)
   31                   ; - M022 und M011 als RAM-Modul zugelassen (M022 nicht beim KC85/3)
   32                   ; - Modifikation der Portadressen fuer M001-PIO-Port B und Schaltplan
   33                   ;   nach Empfehlung in rfe 4/1989 (W. Domschke)
   34                   ; - NOP-Befehle statt OUT (0B8H),A fuer den Einsatz am KC85
   35                   ; - Sprungbefehl zu Adresse C806H ersetzt zu END0 (Programmabbruch)
   36                   ; - Modulsuche komplett neu programmiert, stoppt sobald beide Module
   37                   ;   gefunden wurden
   38                   ; - alle "freien" DS-Bereiche auskommentiert, Programm ist nun nur
   39                   ;   noch von 6200H bis 749EH bzw. von 9600H bis A89EH
   40                   ; -> Programm kann 1700H nach hinten verschoben werden, also
   41                   ;   von AD00H bis BF9EH / Ladebereich 6D00 bis 7F9EH (OFS=4000H)
   42                   ;
   43                   ; 02.10.2022 - Version 1.0:
   44                   ; - lange Zeitkonstante (12.000), wenn Stift gehoben/gesenkt wird
   45                   ;   und kurze Zeitkonstante (450) sonst (vorher 2048). Dadurch insgesamt
   46                   ;   schneller und ein saubereres Schriftbild, auch bei laengeren Stiften
   47                   ;---------------------------------------------------------------------
   48                   ; 10.10.2022 - Version 2.0:
   49                   ; - Lage der Token veraendert, damit die DEVICE-Befehle von CAOS 4.8 nutzbar
   50                   ;   bleiben
   51                   ;	E4 = PSET	Setzen eines Punktes
   52                   ;	F2 = LINE	Zeichnen einer Linie (Gerade)
   53                   ;	F3 = CIRCLE	Zeichnen eines Kreises
   54                   ;	F5 = DEVICE bzw. DRIVE bei CAOS 4.5	sonst SN-ERROR
   55                   ;	F6 = FILES				sonst SN-ERROR
   56                   ;	F7 = CHDIR				sonst SN-ERROR
   57                   ;	F8 = ZERO	Festlegung des Koordinatenursprungs
   58                   ;	F9 = HOME	Stift zum Koordinatenursprung
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   2
PL41XX  Z80

   59                   ;	FA = SCREEN	Plotters ein/aus, schaltet PSET, LINE und CIRCLE um
   60                   ;	FB = SIZE	Festlegen der Schriftart	
   61                   ;	FC = LABEL	Ausgabe einer Zeichenkette
   62                   ;	FD = SCALE	Skalierungsfaktoren
   63                   ;	FE = GCLS	Grundeinstellung des Plotters
   64                   ;
   65                   ; 16.10.2022:
   66                   ; - M001-Portadresse direkt programmiert
   67                   ; - Schreibgeschwindigkeit gemessen ca. 50mm/s (lange Seite 5s, kurze Seite 4s)
   68                   ;   Plotter soll laut Datenblatt 100mm/s schreiben -> Zeitkonstante von 450 auf
   69                   ;   225 reduziert - ohne Aenderung, auch der andere Wert 768 brachte nichts
   70                   ;
   71                   ; 02.11.2022:
   72                   ; die beiden Zeitkonstanten sind einmal beim Erreichen der Zeichenposition (768)
   73                   ; das andere mal beim Heben/Senken des Stftes (12000)
   74                   ; Fuer die Schreibgeschwindigkeit ist der Wert in UN0260 relevant, welcher im
   75                   ; Programm berechnet wird, aber immer 27H ergibt.
   76                   ;
   77                   ; 23.12.2022:
   78                   ; Ladeprogramm nochmals angepasst. Wird jetzt ab 300H geladen. Beim KC85/3 muss
   79                   ; nun vorher nicht erst der RAM4 eingeschalten werden.
   80                   ;
   81                   ; Mario Leubner, 16.01.2022 - 23.12.2022
   82                   ;---------------------------------------------------------------------
   83                   ; Signalspiel nach Empfehlung und rfe 4/1989:
   84                   ;
   85                   ;			Bit:	7 (PEN)	2 (V/R)	1 (X/Y)	0 (STEP)
   86                   ; Schritt X-				0	0	0
   87                   ; (nach links)	OR	1		0	0	1
   88                   ;
   89                   ; Schritt Y-	OR	2		0	1	0
   90                   ;		OR	1		0	1	1
   91                   ;
   92                   ; Schritt X+	OR	4		1	0	0
   93                   ; (nach rechts)	OR	1		1	0	1
   94                   ;
   95                   ; Schritt Y+	OR	6		1	1	0
   96                   ;		OR	1		1	1	1
   97                   ;
   98                   ; Stift senken	OR	80H	1
   99                   ; Stift heben	AND	7FH	0
  100                   ;---------------------------------------------------------------------
  101                   
  102                   	include	caos48.inc	; CAOS-Vereinbarungen einbinden
    1                   ;-----------------------------------------------;
    2                   ;	CAOS-Vereinbarungen (bis CAOS 4.8)	;
    3                   ;	---------------------------------	;
    4                   ;						;
    5                   ; als INCLUDE fuer ASM-Quelltexte		;
    6                   ;						;
    7                   ; CAOS48.INC	ML-Soft 08.01.1994-30.05.2021	;
    8                   ;-----------------------------------------------;
    9                   
   10                   ; Portadressen im Grundgeraet:
   11                   
   12         0084      PORT1	EQU	84H	; Ausgabe-Port D08A	Merkzelle ist (IX+1)
   13                   			;	Bit 0 - Anzeige Bild 0 oder 1
   14                   			;	Bit 1 - Zugriff auf 0=Pixel- oder 1=Farbebene
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   3
CAOS48  INC

   15                   			;	Bit 2 - Zugriff auf Bild 0 oder 1
   16                   			;	Bit 3 - 0=hohe Farbaufloesung oder 1=niedrige
   17                   			;	Bit 4-7 Auswahl der RAM8-Ebene (256K)
   18         0086      PORT2	EQU	86H	; Ausgabe-Port D09A	Merkzelle ist (IX+4)
   19                   			;	Bit 0 - RAM4 ein/aus
   20                   			;	Bit 1 - RAM4 Schreibschutz (1=aus)
   21                   			;	Bit 2-4 Bankauswahl fuer 2MB RAM On Board
   22                   			;	Bit 5-6 Auswahl der USER-ROM-Ebene
   23                   			;	Bit 7 - CAOS-ROM C ein/aus
   24         0088      PIOAD	EQU	88H	; System-PIO Datenbyte Port A
   25                   			;	Bit 0 - CAOS ROM-E ein/aus
   26                   			;	Bit 1 - RAM0 ein/aus
   27                   			;	Bit 2 - IRM ein/aus
   28                   			;	Bit 3 - Schreibschutz RAM0
   29                   			;	Bit 4 - K_OUT
   30                   			;	Bit 5 - System-LED
   31                   			;	Bit 6 - Motorschaltspannung
   32                   			;	Bit 7 - USER-ROM ein/aus
   33         0089      PIOBD	EQU	89H	; System-PIO Datenbyte Port B
   34                   			;	Bit 0 - Symmetrie-Flip-Flop Tonausgabe
   35                   			;	Bit 1 \
   36                   			;	Bit 2 - Lautstaerke Tonausgabe
   37                   			;	Bit 3 - 4 Bit (Low-aktiv)
   38                   			;	Bit 4 /
   39                   			;	Bit 5 - RAM8 ein/aus
   40                   			;	Bit 6 - Schreibschutz RAM8
   41                   			;	Bit 7 - Blinken ein/aus
   42         008A      PIOAS	EQU	8AH	; System-PIO Steuerbyte Port A
   43         008B      PIOBS	EQU	8BH	; System-PIO Steuerbyte Port B
   44         008C      CTC0	EQU	8CH	; CTC Kanal 0 (Tonhoehe 1)
   45         008D      CTC1	EQU	8DH	; CTC Kanal 1 (Kassettenausgabe)
   46         008E      CTC2	EQU	8EH	; CTC Kanal 2 (Tondauer)
   47         008F      CTC3	EQU	8FH	; CTC Kanal 3 (Tastatur)
   48                   
   49                   ; Portadressen des Koppel-RAM (D004):
   50                   
   51         00F1      ERRTX	EQU	000F1H	; Fehlertext			(ab DEP 2.0)
   52         80F1      STBYT2	EQU	080F1H	; 2. Steuerbyte:		(ab DEP 2.0)
   53                   			;	Bit 0 - Anforderung
   54                   			;	Bit 1 - Laufwerkswechsel
   55                   			;	Bit 2 - Userwechsel
   56                   			;	Bit 3..6 reserviert
   57                   			;	Bit 7 - Fehlerrueckmeldung
   58         81F1      LWANF	EQU	081F1H	; Laufwerk ('A', 'B', ... 'P')
   59         82F1      UANF	EQU	082F1H	; User-Bereich (00H ... 1FH)	(ab DEP 3.5 bis 31)
   60         83F1      DEPVER	EQU	083F1H	; DEP-Version BCD
   61         84F1      DATE	EQU	084F1H	; Datum BCD			(ab DEP 3.0)
   62                   			;	Jahr (00..99)
   63                   			;	Monat (1..12)
   64                   			;	Tag (1..31)
   65         87F1      TIME	EQU	087F1H	; Uhrzeit BCD			(ab DEP 3.0)
   66                   			;	Stunde (0..23)
   67                   			;	Minute (0..59)
   68                   			;	Sekunde (0..59)
   69                   
   70         80F2      FDATA	EQU	080F2H	; Daten- bzw. Sektorpuffer 128 Byte lang
   71         80F3      STBYT1	EQU	080F3H	; 1. Steuerbyte:
   72                   			;	Bit 0 - Anforderung
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   4
CAOS48  INC

   73                   			;	Bit 1 - 1=schreiben/0=lesen
   74                   			;	Bit 3 - oeffnen
   75                   			;	Bit 6 - schliessen
   76                   			;	Bit 7 - Fehlerrueckmeldung
   77                   			;	Bit	5 4 2	Funktionsauswahl:
   78                   			;		0 0 0	Sektor lesen/schreiben
   79                   			;		0 0 1	DIR-Anforderung
   80                   			;		0 1 0	ERA
   81                   			;		0 1 1	STAT
   82                   			;		1 0 0	REN
   83                   			;		1 0 1	SETRO
   84                   			;		1 1 0	SETWR
   85                   			;		1 1 1	BASIC-Byte lesen/schreiben
   86         81F3      FCODE	EQU	081F3H	; Fehlercode
   87         82F3      DIRBUF	EQU	082F3H	; Puffer fuer Dateiname oder Directory
   88         8EF3      BASBYT	EQU	08EF3H	; Datenbyte fuer BASIC-Byte-Schnittstelle
   89         B3F3      UROK	EQU	0B3F3H	; Betriebsart	0 = Anfangswert
   90                   			;		1 = CP/M-System lauft
   91                   			;		2 = Not ready
   92                   			;		3 = Can't read
   93                   			;		4 = No system
   94                   			;		5 = CAOS-Betriebsart / DEP laeuft
   95                   
   96                   ; RAM0-Arbeitszellen:
   97                   
   98         01F0      SIX	EQU	1F0H	; CAOS-Belegung IX-Register
   99                   
  100                   ; Belegung der IX - Zellen:
  101                   
  102                   ; IX+0	Zeitkonstante fuer Kassettenroutinen
  103                   ; IX+1	Merkzelle fuer Ausgabeport 84H
  104                   ; IX+2	gelesene Blocknummer (Kassette)
  105                   ; IX+3	erwartete Blocknummer (Kassette)
  106                   ; IX+4	Merkzelle fuer Ausgabeport 86H
  107                   ; IX+5	Ein- Ausgabepufferadresse (low)
  108                   ; IX+6	Ein- Ausgabepufferadresse (high)
  109                   ; IX+7	Kennbyte fuer LOAD/VERIFY
  110                   ;	 BIT 0: =1 ->LOAD  =0 ->VERIFY
  111                   ;	 BIT 1: =1 kein Selbstart bei LOAD (in BASIC Kennung fuer 1. Block)
  112                   ;	 BIT 2-4 : Anzahl Argumente (bei SAVE)/ARGN>3 (Startoffset)
  113                   ;	 BIT 5-7 : BASIC: fuer CLOAD/CSAVE 
  114                   ; IX+8	Kennbyte Tastatur
  115                   ;	 BIT 0: gueltiges Byte (ASCII) in IX+13
  116                   ;	 BIT 1: Tonausgabe laeuft
  117                   ;	 BIT 2-4: aktuelles Speichergeraet
  118                   ;		  0=Kassette, 1=Diskette, 2=USB (M052), 3=Netzwerk (M052)
  119                   ;		  4=Headersave, 5..7 frei
  120                   ;	 BIT 5: Tastenclick ein/aus
  121                   ;	 BIT 6: Code kommt von F-Taste
  122                   ;	 BIT 7: 0=Shiftlock
  123                   ; IX+9	Prologbyte (normal 7FH)
  124                   ; IX+10	Autorepeatzaehler (Tastatur)
  125                   ; IX+11	Merkzelle fuer Akku (bei BWS on/off mit Stackverlagerung)
  126                   ;	und Pruefsummenberechnung fuer MB-Eingabe
  127                   ; IX+12	7-Bit-Scancode von Tastatur
  128                   ; IX+13	ASCII-Code von Tastatur
  129                   ; IX+14	Tastaturcodetabelle low
  130                   ; IX+15	Tastaturcodetabelle high
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   5
CAOS48  INC

  131                   
  132                   ; IRM-Arbeitszellen:
  133                   
  134         A800      V24PL	EQU	0A800H	; Steckplatz V.24-Modul				  1 Byte
  135                   ;INTV1		0A801H	; Initialisierungsdaten V.24-Druckausgabe	  8 Byte
  136                   ;INTV2		0A809H	; Initialisierungsdaten V.24-duplex		  9 Byte
  137                   	; bis	0A811H
  138                   ;		0A820H	; urspruenglich geplant fuer Arbeitszellen Maustreiber
  139                   	; bis	0A87FH	; frei					       (96 Byte)
  140                   
  141         A880      INITU	EQU	0A880h	; Kommandoablage von INITIAL.UUU als Tastencode
  142                   	; bis	0A8FFh	; und Assemblierpuffer von EDAS/ASM
  143                   
  144         A900      DEVTAB	EQU	0A900H	; Tabelle der 8 Geraetetreiber: 8*32=256 Byte gross
  145         AA00      SULEN	EQU	0AA00H	; letzte benutzte UP-Nr. in SUTAB
  146         AA01      SUT_IRM	EQU	0AA01H	; SUTAB per Default im IRM
  147                   	; bis	0AA94h	fuer UP 00 bis 49h				148 Byte
  148                   ;		0AA95H	reserviert fuer kuenftige CAOS-Erweiterungen
  149                   	; bis	0AABEH	z.B. CAOS-UP's 4Ah bis 5Eh			 42 Byte
  150                   ; 1 Byte frei
  151         AAC0      JOYIRM	EQU	0AAC0H	; Joystick-Tabelle (noch nicht endgueltig)
  152                   	; bis	0AACBh							 12 Byte
  153                   
  154         AACC      JWORK	EQU	0AACCH	; Arbeitszellen vom Joystick-Editor
  155                   	; bis	0AADCH							 17 Byte
  156                   
  157         AADD      WIN2	EQU	0AADDH	; Schattenspeicher fuer WINNR bis WEND (Bildwechsel)
  158                   	; bis	0AAE7	; 30.09.2020 neu definiert			 11 Byte
  159                   
  160         AAE8      WTEMO	EQU	0AAE8H	; TEMO-Arbeitszellen zur Ablage von 2 Fenster-Daten
  161                   	; bis	0AAFFH							 24 Byte
  162                   
  163                   ;		0AB00H	; reserviert fuer anwenderspez. Systemerweiterungen
  164                   	; bis	0ACFFH	; z.B. Treiber UOUT1/2 oder UIN1/2		512 Byte
  165                   
  166         AD00      VRAM1	EQU	0AD00H	; ASCII-RAM Bild 1
  167                   	; bis	0B1FFH
  168         B200      VRAM0	EQU	0B200H	; ASCII-RAM Bild 0
  169                   	; bis	0B6FFh
  170         B700      CASS	EQU	0B700H	; 128 Byte Kassettenpuffer (bis	0B77FH)
  171         B780      ARGC	EQU	0B780H	; UP-Nummer fuer PV2 und PV6
  172         B781      ARGN	EQU	0B781H	; Anzahl Argumente
  173         B782      ARG1	EQU	0B782H	; Argument 1
  174         B784      ARG2	EQU	0B784H	;    "	   2
  175         B786      ARG3	EQU	0B786H	;    "	   3
  176         B788      ARG4	EQU	0B788H	;    "	   4
  177         B78A      ARG5	EQU	0B78AH	;    "	   5
  178         B78C      ARG6	EQU	0B78CH	;    "	   6
  179         B78E      ARG7	EQU	0B78EH	;    "	   7
  180         B790      ARG8	EQU	0B790H	;    "	   8
  181         B792      ARG9	EQU	0B792H	;    "	   9
  182         B794      ARG10	EQU	0B794H	;    "	  10
  183         B796      NUMNX	EQU	0B796H	; Anzahl Zeichen einer Hex-Zahl
  184         B797      NUMVX	EQU	0B797H	; Wert HEX-Zahl
  185         B799      HCADR	EQU	0B799H	; Hardcopy-Aufruf
  186         B79B      WINNR	EQU	0B79BH	; Nr. des aktuellen Bildschirmfensters
  187         B79C      WINON	EQU	0B79CH	; Fenster-Anfang
  188         B79E      WINLG	EQU	0B79EH	; Fenster-Groesse
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   6
CAOS48  INC

  189         B7A0      CURSO	EQU	0B7A0H	; Cursor-Position
  190         B7A2      STBT	EQU	0B7A2H	; Bildschirm-Steuerbyte
  191                   		; Bit 0 = 1 Schreiben Pixel-IRM AUS
  192                   		; Bit 1 = 1 Schreiben Color-IRM AUS
  193                   		; Bit 2 = 1 Inversdarstellung EIN (ab CAOS 3.4)
  194                   		; Bit 3 = 1 Steuercode als Zeichen darstellen
  195                   		; Bit 4 = 1 ESC aktiv (ab CAOS 4.1)
  196                   		; Bit 5 = 1 IBM-Zeichensatz EIN (ab CAOS 4.3)
  197                   		; Bit 6 = 1 HRG-Modus EIN (ab CAOS 4.3)
  198                   		; Bit 7 = 1 2-Monitor-Modus aktiv (ab CAOS 4.8)
  199         B7A3      COLOR	EQU	0B7A3H	; Farbe
  200         B7A4      WEND	EQU	0B7A4H	; Reaktionsprogramm auf Bildschirmende
  201         B7A6      CCTL0	EQU	0B7A6H	; Zeichentabelle 0 20H...5FH
  202         B7A8      CCTL1	EQU	0B7A8H	;	"	 1 00H...1FH und 60H...7FH
  203         B7AA      CCTL2	EQU	0B7AAH	;	"	 2 A0H...DFH
  204         B7AC      CCTL3	EQU	0B7ACH	;	"	 3 80H...9FH und E0H...FFH
  205         B7AE      SYSP	EQU	0B7AEH	; System Stackpointer
  206         B7B0      SUTAB	EQU	0B7B0H	; Adresse der Unterprogrammtabelle
  207         B7B2      CTAB	EQU	0B7B2H	; CRT-Steuerprogramm-Tabelle
  208         B7B4      NCAOS	EQU	0B7B4H	; Sprung in neues System ueber IRM
  209         B7B9      OUTAB	EQU	0B7B9H	; Adresse fuer Zeiger auf UP-Nr. bei Ausgabe
  210         B7BB      INTAB	EQU	0B7BBH	; Adresse fuer Zeiger auf UP-Nr. bei Eingabe
  211         B7BD      UOUT1	EQU	0B7BDH	; Sprung zu USER-Ausgabekanal 2 (Drucker)
  212         B7C0      UIN1	EQU	0B7C0H	; Sprung zu USER-Eingabekanal 2
  213         B7C3      UOUT2	EQU	0B7C3H	; Sprung zu USER-Ausgabekanal 3 V.24-duplex
  214         B7C6      UIN2	EQU	0B7C6H	; Sprung zu USER-Eingabekanal 3 V.24-duplex
  215         B7C9      IOERR	EQU	0B7C9H	; Reaktionsprogramm fuer BASIC I/O-Error bis CAOS 4.7
  216         B7CB      VRAM	EQU	0B7CBH	; VRAM-Adresse des eingestellten Bildes
  217         B7CD      ZOTAB	EQU	0B7CDH	; Zwischenspeicher fuer OUTAB
  218         B7CF      ZWEND	EQU	0B7CFH	; Zwischenspeicher fuer WEND
  219         B7D1      FTAST	EQU	0B7D1H	; F-Tastenpointer
  220         B7D3      HOR	EQU	0B7D3H	; Grafik Horizontalposition (X-Wert)
  221         B7D5      VERT	EQU	0B7D5H	; Grafik Vertikalposition (Y-Wert)
  222         B7D6      FARB	EQU	0B7D6H	; Grafik Farbe
  223                   		; Bit 0=1	XOR-Funktion
  224                   		; Bit 1=1	Punkt loeschen
  225                   		; Bit 2=1	Farbebene nicht veraendern
  226                   		; Bit 3-7	Vordergrundfarbe + Blinken
  227         B7D7      MIXIT	EQU	0B7D7H	; IX-Merker (H-Teil von IX und I-Tabelle)
  228         B7D8      VORTN	EQU	0B7D8H	; Vortonlaenge fuer byteweise Kassettenausgabe
  229         B7DA      DTPTR	EQU	0B7DAH	; CASS-Pointer (Zeiger in Kassettenpuffer)
  230         B7DB      CTCMD	EQU	0B7DBH	; CTC2-Modus
  231         B7DC      BLINK	EQU	0B7DCH	; Blinkfrequenz
  232         B7DD      L3TAB	EQU	0B7DDH	; Adresse der ESC-Steuerfunktionstabelle
  233         B7DF      L3SIZ	EQU	0B7DFH	; Anzahl der ESC-Steuerfunktionenn
  234         B7E0      COUNT	EQU	0B7E0H	; Zeiteinheiten fuer 1. Autorepeat (Tastatur)
  235         B7E1      HCPZ	EQU	0B7E1H	; Steuerbyte Druckerausgabe
  236                   		; Bit 0=0	Protokollfunktion
  237                   		; Bit 0=1	Hardcopyfunktion
  238                   		; Bit 1=0/1	USER I/O-Kanal 1/2
  239                   		; Bit 2=0/1	SIO-Kanal A oder B
  240                   		; Bit 3		-
  241                   		; Bit 4..7	Druckertyp (0 bis F)
  242                   		; Bit 7=0	Matrixdrucker
  243                   		; Bit 7=1	Schreibmaschine
  244         B7E2      INTV1	EQU	0B7E2H	; Adresse V.24-Init-Tabelle fuer Druckerausgabe
  245         B7E4      INTV1L	EQU	0B7E4H	; Laenge V.24-Initialisierungtabelle
  246         B7E5      INTV2	EQU	0B7E5H	; Adresse V.24-Init-Tabelle fuer Duplexroutine
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   7
CAOS48  INC

  247         B7E7      INTV2L	EQU	0B7E7H	; Laenge V.24-Initialisierungstabelle
  248         B7E8      HCPZ2	EQU	0B7E8H	; Steuerbyte Duplexroutine
  249                   		; Bit 0		-
  250                   		; Bit 1=0/1	USER I/O-Kanal 1/2
  251                   		; Bit 2=0/1	SIO-Kanal A oder B
  252                   		; Bit 3		WR5 Bit 3: Senden ein/aus
  253                   		; Bit 4		-
  254                   		; Bit 5,6	WR5 Bit 5,6: 5-8 Bit pro Zeichen (Senden)
  255                   		; Bit 7		WR3 Bit 7: 7/8 Bit pro Zeichen (Empfang)
  256         B7E9      OFILT	EQU	0B7E9H	; Sprung zu Druckroutine (ungefiltert)
  257         B7EC      PROMPT	EQU	0B7ECH	; Systemprompt
  258         B7ED      LINTYP	EQU	0B7EDH	; Linientyp
  259         B7EE      CUMUST	EQU	0B7EEH	; Zeiger zu Cursormuster
  260         B7F0      JOYTAB	EQU	0B7F0H	; Zeiger zu Joystick-Tastencodes
  261         B800      MODST	EQU	0B800H	; Modulsteuerbytespeicher (bis B8FFH)
  262         B900      FTASTE	EQU	0B900H	; Funktionstastenspeicher (bis B99BH)
  263         B99C      WNDFN	EQU	0B99CH	; Fenstersvektorpeicher (bis B9FFH)
  264                   
  265                   ; Sprungadressen:
  266                   
  267         E000      RESET	EQU	0E000H	; Einsprungadresse bei "RESET"
  268         EDFF      CAOSNR	EQU	0EDFFH	; Versionsnummer von CAOS
  269         F000      PWRON	EQU	0F000H	; Einsprungadresse bei "POWER ON"
  270         F003      PV1	EQU	0F003H	; Programmverteiler 1
  271         F006      PV2	EQU	0F006H	; Programmverteiler 2
  272         F008      ZEI2	EQU	0F008H	; Zeiger auf 2 = UOUT1 ab CAOS 4.7
  273         F009      PV3	EQU	0F009H	; Programmverteiler 3
  274         F00B      ZEI3	EQU	0F00BH	; Zeiger auf 3 = UOUT2 ab CAOS 4.7
  275         F00C      PV4	EQU	0F00CH	; Programmverteiler 4
  276         F00F      UREL	EQU	0F00FH	; Relativer UP-Aufruf
  277         F012      JMPADR	EQU	0F012H	; Einsprungadresse "JUMP"
  278         F015      PV5	EQU	0F015H	; Programmverteiler 5
  279         F018      IRMON	EQU	0F018H	; IRM einschalten
  280         F01B      IRMOF	EQU	0F01BH	; IRM abschalten
  281         F01E      PV6	EQU	0F01EH	; Programmverteiler 6
  282         F021      PV7	EQU	0F021H	; Programmverteiler fuer Treiberaufrufe
  283                   			; (bis CAOS 4.5 Floppy-Treiber wie SERVICE.KCC)
  284         FDF8      BITTAB	EQU	0FDF8H	; Bittabelle
  285                   
  286                   ; Bildschirm-Steuerzeichen:
  287                   
  288         0009      TAB	EQU	09H	; Tabulator
  289         000A      LF	EQU	0AH	; Zeilenvorschub
  290         000C      CLS	EQU	0CH	; Bildschirm loeschen
  291         000D      CR	EQU	0DH	; zum Zeilenanfang
  292         001B      ESC	EQU	1BH	; Steuerzeichen
  293                   
  294                   ; CAOS-Unterprogramme:
  295                   
  296         0000      CRT	EQU	00H	; Zeichenausgabe auf Bildschirm
  297         0001      MBO	EQU	01H	; Ausgabe Datenblock auf Kassette
  298         0002      UOT1	EQU	02H	; Ausgabe auf Anwenderkanal 1
  299         0003      UOT2	EQU	03H	; Ausgabe auf Anwenderkanal 2
  300         0004      KBD	EQU	04H	; Tastatureingebe mit Cursoreinblendung
  301         0005      MBI	EQU	05H	; Datenblock von Kassette einlesen
  302         0006      USIN1	EQU	06H	; Eingabe von Anwenderkanal 1
  303         0007      USIN2	EQU	07H	; Eingabe von Anwenderkanal 2
  304         0008      ISRO	EQU	08H	; Ausgabe 1. Block auf Kassette
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   8
CAOS48  INC

  305         0009      CSRO	EQU	09H	; Ausgabe letzten Block auf Kassette
  306         000A      ISRI	EQU	0AH	; Einlesen 1. Block von Kassette
  307         000B      CSRI	EQU	0BH	; Abschluss Magnetbandeingabe
  308         000C      KBDS	EQU	0CH	; Tastenstatusabfrage ohne Quittung
  309         000D      BYE	EQU	0DH	; Sprung zu RESET (Warmstart)
  310         000E      KBDZ	EQU	0EH	; Tastenstatusabfrage mit Quittung
  311         000F      COLORUP	EQU	0FH	; Farbe einstellen
  312         0010      LOAD	EQU	10H	; Einlesen MC-Programm von Kassette
  313         0011      VERIF	EQU	11H	; Ueberpruefung von Kassettenaufzeichnungen
  314         0012      LOOP	EQU	12H	; Ruecksprung zu CAOS-Menueschleife
  315         0013      NORM	EQU	13H	; Rueckschalten Ein-/Ausgabe auf CRT und KBD
  316         0014      WAIT	EQU	14H	; Warteschleife
  317         0015      LARG	EQU	15H	; Register mit Argumenten laden
  318         0016      INTB	EQU	16H	; Eingabe vom aktuellen Eingabekanal
  319         0017      INLIN	EQU	17H	; Eingabe einer Zeile
  320         0018      RHEX	EQU	18H	; Erfassung HEX-Zahl aus Zeichenkette
  321         0019      ERRM	EQU	19H	; Fehlermeldung "ERROR"
  322         001A      HLHX	EQU	1AH	; Ausgabe des Wertes von HL als HEX-Zahl
  323         001B      HLDE	EQU	1BH	; Ausgabe der Werte von HL und DE als HEX-Zahlen
  324         001C      AHEX	EQU	1CH	; Ausgabe des Wertes von A als HEX-Zahl
  325         001D      ZSUCH	EQU	1DH	; Suche nach Zeichenkette (Menuewort)
  326         001E      SOUT	EQU	1EH	; Zeiger auf Ausgabetabelle setzen
  327         001F      SIN	EQU	1FH	; Zeiger auf Eingabetabelle setzen
  328         0020      NOUT	EQU	20H	; Zeiger auf Normalausgabe (CRT) setzen
  329         0021      NIN	EQU	21H	; Zeiger auf Normaleingabe (KBD) setzen
  330         0022      GARG	EQU	22H	; Erfassen von max. 10 HEX-Zahlen
  331         0023      OSTR	EQU	23H	; Ausgabe folgender Zeichenkette
  332         0024      OCHR	EQU	24H	; Zeichenausgabe ueber Ausgabetabelle
  333         0025      CUCP	EQU	25H	; Cursor komplementieren
  334         0026      MODU	EQU	26H	; Modulsteuerung
  335         0027      JUMP	EQU	27H	; Neues Betriebssystem anspringen
  336         0028      LDMA	EQU	28H	; Speicher (IRM) schreiben
  337         0029      LDAM	EQU	29H	; Speicher (IRM) lesen
  338         002A      BRKT	EQU	2AH	; Test BRK-Taste
  339         002B      SPACE	EQU	2BH	; Ausgabe Leerzeichen
  340         002C      CRLF	EQU	2CH	; Ausgabe CR und LF
  341         002D      HOME	EQU	2DH	; Ausgabe HOME
  342         002E      MODI	EQU	2EH	; Systemkommando "MODIFY"
  343         002F      PUDE	EQU	2FH	; Punkt loeschen
  344         0030      PUSE	EQU	30H	; Punkt setzen
  345         0031      SIXD	EQU	31H	; Verlagerung IX-Arbeitsbereich von CAOS
  346         0032      DABR	EQU	32H	; Berechnung VRAM-Adresse
  347         0033      TCIF	EQU	33H	; Test, ob Cursorposition im Fenster
  348         0034      PADR	EQU	34H	; Berechnen Pixel- und Farbadresse
  349         0035      TON	EQU	35H	; Tonausgabe
  350         0036      SAVE	EQU	36H	; Ausgabe MC-Programm auf Kassette
  351         0037      MBIN	EQU	37H	; Byteweise Eingabe von Kassette
  352         0038      MBOUT	EQU	38H	; Byteweise Ausgabe auf Kassette
  353         0039      KEY	EQU	39H	; Belegen einer F-Taste
  354         003A      KEYLI	EQU	3AH	; Anzeige F-Tastenbelegung
  355         003B      DISP	EQU	3BH	; Systemkommando "DISPLAY"
  356         003C      WININ	EQU	3CH	; Fenster initialisieren
  357         003D      WINAK	EQU	3DH	; Fenster ueber Nummer aufrufen
  358         003E      LINE	EQU	3EH	; Linie zeichnen
  359         003F      CIRCLE	EQU	3FH	; Kreis zeichnen
  360         0040      SQR	EQU	40H	; Quadratwurzel berechnen
  361         0041      MULT	EQU	41H	; Multiplikation
  362         0042      CSTBT	EQU	42H	; Bildschirmanzeige Steuerzeichensymbol
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page   9
CAOS48  INC

  363         0043      INIEA	EQU	43H	; Initialisierung E/A-Kanal
  364         0044      INIME	EQU	44H	; Initialisierung mehrerer E/A-Kanaele
  365         0045      ZKOUT	EQU	45H	; Ausgabe Zeichenkette
  366         0046      MENU	EQU	46H	; aktuelles Menue ausschreiben
  367         0047      V24OUT	EQU	47H	; Initialisierung Druckerausgabe
  368         0048      V24DUP	EQU	48H	; Initialisierung V.24-Duplexroutine
  369         0049      DEVICE	EQU	49H	; DEVICE-Funktionen ab CAOS 4.6
  370         004A      HLDEZ	EQU	4AH	; HL dezimal anzeigen ab CAOS 4.8
  371         004B      RDEZ	EQU	4BH	; Erfassung Dezimalzahl aus Zeichenkette ab CAOS 4.8
  372         004C      GARGC	EQU	4CH	; bis zu 10 Argumente mit variabler Zahlenbasis erfassen
  373                   
  374                   ; allgemeine Macros:
  375                   
  376                   MESSAGE	MACRO	MSG1,N,MSG2
  377                   	 .PRINTX MSG1 N MSG2
  378                   	ENDM
  379                   
  380                   ; Mit FF auffuellen, bis die absolute Adresse LOC erreicht ist:
  381                   ABSFILL	MACRO	LOC,WHAT
  382                   	 IF $ GT LOC
  383                   	  MESSAGE <Fehler! LOC:>,% $ - LOC,<Byte zu viel vor WHAT>
  384                   	 ELSE
  385                   	  IF2
  386                   	   MESSAGE <LOC:>,% LOC - $,<Byte frei vor WHAT>
  387                   	  ENDIF
  388                   	  DS	LOC - $,0FFh
  389                   	 ENDIF
  390                   	ENDM
  391                   
  392                   ; end of include
  103         0005      PIOB	EQU	5		; M001-PIO Datenport Kanal B
  104         AE00      ADRES	EQU	0AE00H		; Programmcode wird hier im RAM8 ausgefuehrt
  105                   				; Laenge = 1200H, also bis BFFFH
  106         AB00      OFFS	EQU	ADRES-300H	; Offset Ladeadresse zu Adresse, wo Code ausgefuehrt wird
  107                   				; 300H = Ladeadresse
  108                   
  109                   ; Setze Bit 7 des ersten Zeichens fuer BASIC-Token:
  110                   TOKEN	MACRO	STRING
  111                   Y	 DEFL	80h
  112                   	 IRPC	X,STRING
  113                   	  DB	'&X' + Y
  114                   Y	  DEFL	0
  115                   	 ENDM
  116                   	ENDM
  117                   ;
  118                   ; genutzte Arbeitszellen
  119                   ;
  120         0234      UN0234	EQU	0234H	; 3 Byte Koordinate fuer Meldung "OUT OF RANGE"
  121         0239      UN0239	EQU	0239H	; 8 Byte
  122         023B      UN023B	EQU	023BH
  123         023D      UN023D	EQU	023DH
  124         023F      UN023F	EQU	023FH
  125         0241      XHOME	EQU	0241H	; 2 Byte X-Home
  126         0243      YHOME	EQU	0243H	; 2 Byte Y-Home
  127         0245      POSX	EQU	0245H	; 2 Byte X-Position
  128         0247      POSY	EQU	0247H	; 2 Byte Y-Position
  129         0249      UN0249	EQU	0249H
  130         024A      UN024A	EQU	024AH
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  10
PL41XX  Z80

  131         024B      UN024B	EQU	024BH
  132         024C      UN024C	EQU	024CH	; 80H Stift senken / 00H Stift heben
  133         024D      UN024D	EQU	024DH	; 80H Stift unten / 00h Stift oben
  134         024E      UN024E	EQU	024EH	; letzter Ausgabewert Datenport?
  135         024F      UN024F	EQU	024FH
  136         0250      UN0250	EQU	0250H
  137         0252      UN0252	EQU	0252H
  138         0254      UN0254	EQU	0254H	; out-of-range, wenn > 0
  139         0256      UN0256	EQU	0256H
  140         0258      UN0258	EQU	0258H
  141         025A      UN025A	EQU	025AH
  142         025C      UN025C	EQU	025CH
  143         025E      UN025E	EQU	025EH
  144         0260      UN0260	EQU	0260H	; Zeitkonstante fuer Schreibgeschwindigkeit (Original 27h)
  145         0261      UN0261	EQU	0261H
  146         0262      UN0262	EQU	0262H
  147         0263      UN0263	EQU	0263H
  148         0265      UN0265	EQU	0265H
  149         0267      INITM	EQU	0267H	; INIT-Merker, enthaelt CFH wenn PIO initialisiert ist
  150         0268      UN0268	EQU	0268H	; Datensatz 1	Zaehlerwert
  151         026A      UN026A	EQU	026AH	;		Programmcode
  152         026D      UN026D	EQU	026DH	;		03H 13H	
  153         0273      UN0273	EQU	0273H	; Datensatz 2	Zahlenwert
  154                   ;		0275H	Programmcode
  155         0278      UN0278	EQU	0278H	;		01H, 13H	oder	00H, 1BH
  156         027B      UN027B	EQU	027BH	;		Programmcode
  157         027C      UN027C	EQU	027CH
  158         027D      XSCALE	EQU	027DH	; SCALE x-Faktor (4 Byte Float)
  159         0281      YSCALE	EQU	0281H	; SCALE y-Faktor (4 Byte Float)
  160         0285      PARAM	EQU	0285H	; Buffer fuer Parameteruebergabe zu phys. Treiber
  161         029A      UN029A	EQU	029AH	; ???
  162         029B      UN029B	EQU	029BH	; ???
  163         035A      WINJP	EQU	035AH	; Bit0 = 0/1	Plotter aus/ein
  164                   			; Bit7 = 1	SCREEN wurde aufgerufen, Scale initialisiert
  165         035B      PL_PORT	EQU	035BH	; Portadresse (Daten) Plotteranschluss bei KC87
  166                   ;
  167         03E5      WRA1	EQU	03E5H	; Arithmetikregister 1
  168                   ;
  169                   ; genutzte Einspruenge vom BASIC-ROM
  170                   ;
  171         C00D      LDWSP	EQU	0C00DH	; BASIC-Kaltstart mit Laden Workspace
  172         C023      RESSP	EQU	0C023H	; Name des BASIC-Interpreters
  173         C041      RAMSCH	EQU	0C041H	; RAM-Suche bis zu Adresse
  174         C348      SNER	EQU	0C348H
  175         C540      SCANEX	EQU	0C540H	; Verwendung der Token-Erweiterungs-Tabelle
  176         C689      CPREG	EQU	0C689H	; Vergleich Register DE mit HL
  177         C69C      IOTEST1	EQU	0C69CH
  178         C7A3      LISTX	EQU	0C7A3H	; Verwendung von EXTTAB (externe Token)
  179         C8AB      EXT1	EQU	0C8ABH	; Absprung zu den Erweiterungen
  180         C8B7      DLI22	EQU	0C8B7H	; Ansprung Tokenverarbeitung
  181         C8BD      TCHAR	EQU	0C8BDH	; Token konsumieren
  182         C8BE      TCHAR1	EQU	0C8BEH
  183         C8D6      CPCOMM	EQU	0C8D6H
  184         C8F9      TESC	EQU	0C8F9H	; Test auf Unterbrechungsanforderung
  185         C91B      END0	EQU	0C91BH	; BASIC-Programmabbruch
  186         C967      FCER	EQU	0C967H
  187         C96C      EPRVL4	EQU	0C96CH
  188         C96F      EPRVL3	EQU	0C96FH
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  11
PL41XX  Z80

  189         D0B1      FRE3	EQU	0D0B1H
  190         CD3A      SNALY	EQU	0CD3AH
  191         D1C9      TEXTO	EQU	0D1C9H
  192         D330      LEN1	EQU	0D330H
  193         D421      ARGVL1	EQU	0D421H
  194         D461      ADD2	EQU	0D461H
  195         D466      ADD3	EQU	0D466H
  196         D46F      ADD5	EQU	0D46FH
  197         D59A      MUL1	EQU	0D59AH
  198         D5F5      DIV1	EQU	0D5F5H
  199         D6C8      OPARST	EQU	0D6C8H
  200         D6DD      OPKOP	EQU	0D6DDH
  201         D6EE      OPLAD	EQU	0D6EEH
  202         D6F7      OPTRAN	EQU	0D6F7H
  203         D91F      B_SQR	EQU	0D91FH
  204         D6E0      OPKOP1	EQU	0D6E0H
  205         DA70      COS	EQU	0DA70H
  206         DA76      B_SIN	EQU	0DA76H
  207         DABA      COSL	EQU	0DABAH
  208                   
  209                   ;-----------------------------------------------------------------------------
  210                   ; CAOS-Vorblock:
  211                   ;-----------------------------------------------------------------------------
  212                   
  213 0100  50 4C 42 41 	DB	'PLBASIC.KCC'	; 11 Byte Dateiname
  214 010B  00 00 00 00 	DS	5,0
  215 0110  03          	DB	3		; 3 Argumente
  216 0111  0300        	DW	300H		; Anfangsadresse (Ladeadresse)
  217 0113  15D1        	DW	EADR		; Endadresse
  218 0115  1420        	DW	START-ADRES+300H; Startadresse (INIT-Routine)
  219 0117  00 00 00 00 	DS	95,0		; Rest von Vorblock
  220 0176  32 33 2E 31 	DB	'23.12.2022'	; Datum
  221                   ;
  222                   	.phase	ADRES		; Adresse, wo Code ausgefuehrt wird
  223                   
  224                   ;	DS	5,0		; frei ???
  225                   
  226                   ;-----------------------------------------------------------------------------
  227                   ; BASIC-Token	(Bit 7 im 1. Byte gesetzt!)
  228                   ;-----------------------------------------------------------------------------
  229                   
  230 AE00              TOKTAB:	TOKEN	INKEY$		; D5
    1 AE00  C9          	  DB	'I' + Y
    1 AE01  4E          	  DB	'N' + Y
    1 AE02  4B          	  DB	'K' + Y
    1 AE03  45          	  DB	'E' + Y
    1 AE04  59          	  DB	'Y' + Y
    1 AE05  24          	  DB	'$' + Y
  231                   	TOKEN	JOYST		; D6
    1 AE06  CA          	  DB	'J' + Y
    1 AE07  4F          	  DB	'O' + Y
    1 AE08  59          	  DB	'Y' + Y
    1 AE09  53          	  DB	'S' + Y
    1 AE0A  54          	  DB	'T' + Y
  232                   	TOKEN	STRING$		; D7
    1 AE0B  D3          	  DB	'S' + Y
    1 AE0C  54          	  DB	'T' + Y
    1 AE0D  52          	  DB	'R' + Y
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  12
PL41XX  Z80

    1 AE0E  49          	  DB	'I' + Y
    1 AE0F  4E          	  DB	'N' + Y
    1 AE10  47          	  DB	'G' + Y
    1 AE11  24          	  DB	'$' + Y
  233                   	TOKEN	INSTR		; D8
    1 AE12  C9          	  DB	'I' + Y
    1 AE13  4E          	  DB	'N' + Y
    1 AE14  53          	  DB	'S' + Y
    1 AE15  54          	  DB	'T' + Y
    1 AE16  52          	  DB	'R' + Y
  234                   	TOKEN	RENUMBER	; D9
    1 AE17  D2          	  DB	'R' + Y
    1 AE18  45          	  DB	'E' + Y
    1 AE19  4E          	  DB	'N' + Y
    1 AE1A  55          	  DB	'U' + Y
    1 AE1B  4D          	  DB	'M' + Y
    1 AE1C  42          	  DB	'B' + Y
    1 AE1D  45          	  DB	'E' + Y
    1 AE1E  52          	  DB	'R' + Y
  235                   	TOKEN	DELETE		; DA
    1 AE1F  C4          	  DB	'D' + Y
    1 AE20  45          	  DB	'E' + Y
    1 AE21  4C          	  DB	'L' + Y
    1 AE22  45          	  DB	'E' + Y
    1 AE23  54          	  DB	'T' + Y
    1 AE24  45          	  DB	'E' + Y
  236                   	TOKEN	PAUSE		; DB
    1 AE25  D0          	  DB	'P' + Y
    1 AE26  41          	  DB	'A' + Y
    1 AE27  55          	  DB	'U' + Y
    1 AE28  53          	  DB	'S' + Y
    1 AE29  45          	  DB	'E' + Y
  237                   	TOKEN	BEEP		; DC
    1 AE2A  C2          	  DB	'B' + Y
    1 AE2B  45          	  DB	'E' + Y
    1 AE2C  45          	  DB	'E' + Y
    1 AE2D  50          	  DB	'P' + Y
  238                   	TOKEN	WINDOW		; DD
    1 AE2E  D7          	  DB	'W' + Y
    1 AE2F  49          	  DB	'I' + Y
    1 AE30  4E          	  DB	'N' + Y
    1 AE31  44          	  DB	'D' + Y
    1 AE32  4F          	  DB	'O' + Y
    1 AE33  57          	  DB	'W' + Y
  239                   	TOKEN	BORDER		; DE
    1 AE34  C2          	  DB	'B' + Y
    1 AE35  4F          	  DB	'O' + Y
    1 AE36  52          	  DB	'R' + Y
    1 AE37  44          	  DB	'D' + Y
    1 AE38  45          	  DB	'E' + Y
    1 AE39  52          	  DB	'R' + Y
  240                   	TOKEN	INK		; DF
    1 AE3A  C9          	  DB	'I' + Y
    1 AE3B  4E          	  DB	'N' + Y
    1 AE3C  4B          	  DB	'K' + Y
  241                   	TOKEN	PAPER		; E0
    1 AE3D  D0          	  DB	'P' + Y
    1 AE3E  41          	  DB	'A' + Y
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  13
PL41XX  Z80

    1 AE3F  50          	  DB	'P' + Y
    1 AE40  45          	  DB	'E' + Y
    1 AE41  52          	  DB	'R' + Y
  242                   	TOKEN	AT		; E1
    1 AE42  C1          	  DB	'A' + Y
    1 AE43  54          	  DB	'T' + Y
  243                   	TOKEN	COLOR		; E2
    1 AE44  C3          	  DB	'C' + Y
    1 AE45  4F          	  DB	'O' + Y
    1 AE46  4C          	  DB	'L' + Y
    1 AE47  4F          	  DB	'O' + Y
    1 AE48  52          	  DB	'R' + Y
  244                   	TOKEN	SOUND		; E3
    1 AE49  D3          	  DB	'S' + Y
    1 AE4A  4F          	  DB	'O' + Y
    1 AE4B  55          	  DB	'U' + Y
    1 AE4C  4E          	  DB	'N' + Y
    1 AE4D  44          	  DB	'D' + Y
  245                   	TOKEN	PSET		; E4	wird auch fuer Plotter genutzt!
    1 AE4E  D0          	  DB	'P' + Y
    1 AE4F  53          	  DB	'S' + Y
    1 AE50  45          	  DB	'E' + Y
    1 AE51  54          	  DB	'T' + Y
  246                   	TOKEN	PRESET		; E5
    1 AE52  D0          	  DB	'P' + Y
    1 AE53  52          	  DB	'R' + Y
    1 AE54  45          	  DB	'E' + Y
    1 AE55  53          	  DB	'S' + Y
    1 AE56  45          	  DB	'E' + Y
    1 AE57  54          	  DB	'T' + Y
  247                   	TOKEN	BLOAD		; E6
    1 AE58  C2          	  DB	'B' + Y
    1 AE59  4C          	  DB	'L' + Y
    1 AE5A  4F          	  DB	'O' + Y
    1 AE5B  41          	  DB	'A' + Y
    1 AE5C  44          	  DB	'D' + Y
  248                   	TOKEN	VPEEK		; E7
    1 AE5D  D6          	  DB	'V' + Y
    1 AE5E  50          	  DB	'P' + Y
    1 AE5F  45          	  DB	'E' + Y
    1 AE60  45          	  DB	'E' + Y
    1 AE61  4B          	  DB	'K' + Y
  249                   	TOKEN	VPOKE		; E8
    1 AE62  D6          	  DB	'V' + Y
    1 AE63  50          	  DB	'P' + Y
    1 AE64  4F          	  DB	'O' + Y
    1 AE65  4B          	  DB	'K' + Y
    1 AE66  45          	  DB	'E' + Y
  250                   	TOKEN	LOCATE		; E9
    1 AE67  CC          	  DB	'L' + Y
    1 AE68  4F          	  DB	'O' + Y
    1 AE69  43          	  DB	'C' + Y
    1 AE6A  41          	  DB	'A' + Y
    1 AE6B  54          	  DB	'T' + Y
    1 AE6C  45          	  DB	'E' + Y
  251                   	TOKEN	KEYLIST		; EA
    1 AE6D  CB          	  DB	'K' + Y
    1 AE6E  45          	  DB	'E' + Y
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  14
PL41XX  Z80

    1 AE6F  59          	  DB	'Y' + Y
    1 AE70  4C          	  DB	'L' + Y
    1 AE71  49          	  DB	'I' + Y
    1 AE72  53          	  DB	'S' + Y
    1 AE73  54          	  DB	'T' + Y
  252                   	TOKEN	KEY		; EB
    1 AE74  CB          	  DB	'K' + Y
    1 AE75  45          	  DB	'E' + Y
    1 AE76  59          	  DB	'Y' + Y
  253                   	TOKEN	SWITCH		; EC
    1 AE77  D3          	  DB	'S' + Y
    1 AE78  57          	  DB	'W' + Y
    1 AE79  49          	  DB	'I' + Y
    1 AE7A  54          	  DB	'T' + Y
    1 AE7B  43          	  DB	'C' + Y
    1 AE7C  48          	  DB	'H' + Y
  254                   	TOKEN	PTEST		; ED
    1 AE7D  D0          	  DB	'P' + Y
    1 AE7E  54          	  DB	'T' + Y
    1 AE7F  45          	  DB	'E' + Y
    1 AE80  53          	  DB	'S' + Y
    1 AE81  54          	  DB	'T' + Y
  255                   	TOKEN	CLOSE		; EE
    1 AE82  C3          	  DB	'C' + Y
    1 AE83  4C          	  DB	'L' + Y
    1 AE84  4F          	  DB	'O' + Y
    1 AE85  53          	  DB	'S' + Y
    1 AE86  45          	  DB	'E' + Y
  256                   	TOKEN	OPEN		; EF
    1 AE87  CF          	  DB	'O' + Y
    1 AE88  50          	  DB	'P' + Y
    1 AE89  45          	  DB	'E' + Y
    1 AE8A  4E          	  DB	'N' + Y
  257                   	TOKEN	RANDOMIZE	; F0
    1 AE8B  D2          	  DB	'R' + Y
    1 AE8C  41          	  DB	'A' + Y
    1 AE8D  4E          	  DB	'N' + Y
    1 AE8E  44          	  DB	'D' + Y
    1 AE8F  4F          	  DB	'O' + Y
    1 AE90  4D          	  DB	'M' + Y
    1 AE91  49          	  DB	'I' + Y
    1 AE92  5A          	  DB	'Z' + Y
    1 AE93  45          	  DB	'E' + Y
  258                   	TOKEN	VGET$		; F1
    1 AE94  D6          	  DB	'V' + Y
    1 AE95  47          	  DB	'G' + Y
    1 AE96  45          	  DB	'E' + Y
    1 AE97  54          	  DB	'T' + Y
    1 AE98  24          	  DB	'$' + Y
  259                   	TOKEN	LINE		; F2	wird auch fuer Plotter genutzt!
    1 AE99  CC          	  DB	'L' + Y
    1 AE9A  49          	  DB	'I' + Y
    1 AE9B  4E          	  DB	'N' + Y
    1 AE9C  45          	  DB	'E' + Y
  260                   	TOKEN	CIRCLE		; F3	wird auch fuer Plotter genutzt!
    1 AE9D  C3          	  DB	'C' + Y
    1 AE9E  49          	  DB	'I' + Y
    1 AE9F  52          	  DB	'R' + Y
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  15
PL41XX  Z80

    1 AEA0  43          	  DB	'C' + Y
    1 AEA1  4C          	  DB	'L' + Y
    1 AEA2  45          	  DB	'E' + Y
  261                   	TOKEN	CSRLIN		; F4 bis hierher in CAOS 3.1 bis 4.4
    1 AEA3  C3          	  DB	'C' + Y
    1 AEA4  53          	  DB	'S' + Y
    1 AEA5  52          	  DB	'R' + Y
    1 AEA6  4C          	  DB	'L' + Y
    1 AEA7  49          	  DB	'I' + Y
    1 AEA8  4E          	  DB	'N' + Y
  262                   	TOKEN	DEVICE		; F5 ab CAOS 4.8 (DRIVE bei CAOS 4.5)
    1 AEA9  C4          	  DB	'D' + Y
    1 AEAA  45          	  DB	'E' + Y
    1 AEAB  56          	  DB	'V' + Y
    1 AEAC  49          	  DB	'I' + Y
    1 AEAD  43          	  DB	'C' + Y
    1 AEAE  45          	  DB	'E' + Y
  263                   	TOKEN	FILES		; F6 ab CAOS 4.8
    1 AEAF  C6          	  DB	'F' + Y
    1 AEB0  49          	  DB	'I' + Y
    1 AEB1  4C          	  DB	'L' + Y
    1 AEB2  45          	  DB	'E' + Y
    1 AEB3  53          	  DB	'S' + Y
  264                   	TOKEN	CHDIR		; F7 ab CAOS 4.8
    1 AEB4  C3          	  DB	'C' + Y
    1 AEB5  48          	  DB	'H' + Y
    1 AEB6  44          	  DB	'D' + Y
    1 AEB7  49          	  DB	'I' + Y
    1 AEB8  52          	  DB	'R' + Y
  265                   	
  266                   ; ab F8 Spezial-Token fuer das Plotter-BASIC 2.0:
  267 AEB9              TOKF8:	TOKEN	ZERO		; F8
    1 AEB9  DA          	  DB	'Z' + Y
    1 AEBA  45          	  DB	'E' + Y
    1 AEBB  52          	  DB	'R' + Y
    1 AEBC  4F          	  DB	'O' + Y
  268                   	TOKEN	HOME		; F9
    1 AEBD  C8          	  DB	'H' + Y
    1 AEBE  4F          	  DB	'O' + Y
    1 AEBF  4D          	  DB	'M' + Y
    1 AEC0  45          	  DB	'E' + Y
  269                   	TOKEN	SCREEN		; FA (F7 in Plotter BASIC 1.0)
    1 AEC1  D3          	  DB	'S' + Y
    1 AEC2  43          	  DB	'C' + Y
    1 AEC3  52          	  DB	'R' + Y
    1 AEC4  45          	  DB	'E' + Y
    1 AEC5  45          	  DB	'E' + Y
    1 AEC6  4E          	  DB	'N' + Y
  270                   	TOKEN	SIZE		; FB
    1 AEC7  D3          	  DB	'S' + Y
    1 AEC8  49          	  DB	'I' + Y
    1 AEC9  5A          	  DB	'Z' + Y
    1 AECA  45          	  DB	'E' + Y
  271                   	TOKEN	LABEL		; FC
    1 AECB  CC          	  DB	'L' + Y
    1 AECC  41          	  DB	'A' + Y
    1 AECD  42          	  DB	'B' + Y
    1 AECE  45          	  DB	'E' + Y
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  16
PL41XX  Z80

    1 AECF  4C          	  DB	'L' + Y
  272                   	TOKEN	SCALE		; FD
    1 AED0  D3          	  DB	'S' + Y
    1 AED1  43          	  DB	'C' + Y
    1 AED2  41          	  DB	'A' + Y
    1 AED3  4C          	  DB	'L' + Y
    1 AED4  45          	  DB	'E' + Y
  273                   	TOKEN	GCLS		; FE
    1 AED5  C7          	  DB	'G' + Y
    1 AED6  43          	  DB	'C' + Y
    1 AED7  4C          	  DB	'L' + Y
    1 AED8  53          	  DB	'S' + Y
  274                   ;	TOKEN	PLINE		; F5 in Plotter BASIC 1.0
  275                   ;	TOKEN	PCIRCLE		; F6 in Plotter BASIC 1.0
  276                   ;	TOKEN	PPSET		; FA in Plotter BASIC 1.0
  277 AED9  80          	DB	80H		; Ende-Kennung
  278 AEDA              TOKFF:
  279                   ; BASIC-Erweiterung 1: Erweiterungstoken starten
  280                   ;
  281                   ;***************************************************************
  282                   ;*  E: <B>: TOKEN-LDTOK
  283                   ;*     <HL>: AUF TOKEN
  284                   ;*  A: <<SP>>: STARTADRESSE ROUTINE
  285                   ;*     <HL>: AUF TOKEN
  286                   ;***************************************************************
  287                   
  288 AEDA  78          BEXP1:	LD	A,B		; Nr.
  289 AEDB  D6 09       	SUB	9
  290 AEDD  DA C348     	JP	C,SNER
  291 AEE0  FE 26       	CP	(TOKJPE-TOKJP)/2-4	; 27 waren es Original
  292 AEE2  D2 C348     	JP	NC,SNER		; Token ausserhalb
  293 AEE5  07          	RLCA			; *2
  294 AEE6  4F          	LD	C,A
  295 AEE7  06 00       	LD	B,0
  296 AEE9  EB          	EX	DE,HL
  297 AEEA  21 AEF8     	LD	HL,TADR5
  298 AEED  C3 C8B7     	JP	DLI22		; Ruecksprung zu Tokenverarbeitung
  299                   ;
  300                   ; zugehoerige Sprungtabelle fuer BASIC-Token
  301                   ; (Adressen entsprechen CAOS 4.2)
  302                   ;
  303 AEF0  EB7D        TOKJP:	DW	0EB7DH	; INKEY		; D5
  304 AEF2  02FD        	DW	02FDH	; JOYST		; D6
  305 AEF4  E706        	DW	0E706H	; STRING	; D7
  306 AEF6  EC24        	DW	0EC24H	; INSTR		; D8
  307 AEF8  E765        TADR5:	DW	0E765H	; RENUM		; D9
  308 AEFA  E945        	DW	0E945H	; DELETE	; DA
  309 AEFC  E96A        	DW	0E96AH	; PAUSE		; DB
  310 AEFE  E99E        	DW	0E99EH	; BBEEP		; DC
  311 AF00  E9B3        	DW	0E9B3H	; WINDOW	; DD
  312 AF02  EA89        	DW	0EA89H	; BORDER	; DE
  313 AF04  EAFA        	DW	0EAFAH	; INK		; DF
  314 AF06  EB14        	DW	0EB14H	; PAPER		; E0
  315 AF08  C348        	DW	SNER	; Funktion AT	; E1
  316 AF0A  EB30        	DW	0EB30H	; BCOLOR	; E2
  317 AF0C  EB98        	DW	0EB98H	; SOUND		; E3
  318 AF0E  EBDB        TOKE4:	DW	0EBDBH	; PSET		; E4	!!!
  319 AF10  EC0C        	DW	0EC0CH	; PRESET	; E5
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  17
PL41XX  Z80

  320 AF12  EA3D        	DW	0EA3DH	; BLOAD		; E6
  321 AF14  C348        	DW	SNER	; Funktion VPEEK; E7
  322 AF16  EA6C        	DW	0EA6CH	; VPOKE		; E8
  323 AF18  EB49        	DW	0EB49H	; LOCATE	; E9
  324 AF1A  ECA8        	DW	0ECA8H	; KEYLIST	; EA
  325 AF1C  EC99        	DW	0EC99H	; BKEY		; EB
  326 AF1E  ECAC        	DW	0ECACH	; SWITCH	; EC
  327 AF20  C348        	DW	SNER	; Funktion PTEST; ED
  328 AF22  ECF8        	DW	0ECF8H	; CLOSE		; EE
  329 AF24  ED39        	DW	0ED39H	; OPEN		; EF
  330 AF26  ED33        	DW	0ED33H	; RANDOM	; F0
  331 AF28  C348        	DW	SNER	; Funktion VGET	; F1
  332 AF2A  ED6E        TOKF2:	DW	0ED6EH	; LINE		; F2	!!!
  333 AF2C  ED73        TOKF3:	DW	0ED73H	; CIRCLE	; F3	!!!
  334 AF2E  C348        	DW	SNER	; Funktion CSRLIN F4
  335                   ; neue Befehle mit SNER vorbelegt
  336 AF30  C348        	DW	SNER	; DEVICE/DRIVE	; F5
  337 AF32  C348        	DW	SNER	; FILES		; F6
  338 AF34  C348        	DW	SNER	; CHDIR		; F7
  339                   ; Sprungtabelle der Plotter-Funktionen mit Adressen wie beim KC87
  340 AF36  BF03        	DW	JZERO	; A7E8H		; F8
  341 AF38  BF06        	DW	JHOME	; A7EBH		; F9
  342 AF3A  BF0F        	DW	JSCRN	; A7F4H		; FA
  343 AF3C  BF00        	DW	JSIZE	; A7E5H		; FB
  344 AF3E  BEFD        	DW	JLABEL	; A7E2H		; FC
  345 AF40  BF0C        	DW	JSCALE	; A7F1H		; FD
  346 AF42  BF09        	DW	JGCLS	; A7EEH		; FE
  347 AF44              TOKJPE:
  348                   ; CAOS-Token fuer PSET, LINE und CIRCLE hier merken
  349 AF44  0000        TOKC:	DW	0	; PSET		; E4
  350 AF46  0000        	DW	0	; LINE		; F2
  351 AF48  0000        	DW	0	; CIRCLE	; F3
  352                   
  353                   ;	ds	9750h-$,0
  354 AF4A  0C          PBASIC:	DB	0CH		; CLS
  355 AF4B  0D 0A       	DB	CR,LF
  356 AF4D  50 6C 6F 74 	DB	'Plotter XY41xx BASIC 2.0'
  357 AF65  0D 0A 00    	DB	CR,LF,0
  358                   
  359                   ;	ds	9800h-$,0	; frei
  360                   
  361                   ;	Treiber laeuft auf Adresse 9800H
  362                   ;-----------------------------------------------------------------------------
  363                   ; Sprungverteiler fuer physischen Treiber
  364                   ; PE:	C	Nummer des UP (1-12)
  365                   ;	(WINJP)	Bit0=1 => Plotter, sonst Vollgrafik
  366                   ;-----------------------------------------------------------------------------
  367                   
  368 AF68  06 00       PLSV:	LD	B,0		; interner Sprungverteiler
  369 AF6A  0D          	DEC	C		; BC = 00 bis 11
  370 AF6B  E5          	PUSH	HL		; HL sichern
  371 AF6C  21 AF86     	LD	HL,plsv3	; Return-Adresse
  372 AF6F  E5          	PUSH	HL		; kellern
  373 AF70  3A 035A     	LD	A,(WINJP)
  374 AF73  CB 47       	BIT	0,A		; Plotter oder Grafikbildschirm?
  375 AF75  20 05       	JR	NZ,plsv1	; Plotter
  376 AF77  21 AF88     	LD	HL,SVTAB1	; Sprungtabelle 1
  377 AF7A  18 03       	JR	plsv2
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  18
PL41XX  Z80

  378                   	;
  379 AF7C  21 AFA0     plsv1:	LD	HL,SVTAB2	; Sprungtabelle 2
  380 AF7F  09          plsv2:	ADD	HL,BC
  381 AF80  09          	ADD	HL,BC
  382 AF81  7E          	LD	A,(HL)
  383 AF82  23          	INC	HL
  384 AF83  66          	LD	H,(HL)
  385 AF84  6F          	LD	L,A
  386 AF85  E9          	JP	(HL)		; UP ausfuehren, RET zu plsv3
  387                   	;
  388 AF86  E1          plsv3:	POP	HL		; HL restaurieren
  389 AF87  C9          	RET
  390                   ;
  391                   ; Sprungtabelle fuer SCREEN 0 (Vollgrafik KC87)
  392                   ;
  393 AF88  BA75        SVTAB1:	DW	MA32B	; 1	RET	PSET
  394 AF8A  BA75        	DW	MA32B	; 2	RET	LINE
  395 AF8C  BA75        	DW	MA32B	; 3	RET	CIRCLE
  396 AF8E  BA75        	DW	MA32B	; 4	RET
  397 AF90  BA75        	DW	MA32B	; 5	RET
  398 AF92  BA75        	DW	MA32B	; 6	RET
  399 AF94  BA75        	DW	MA32B	; 7	RET
  400 AF96  BA75        	DW	MA32B	; 8	RET
  401 AF98  BA75        	DW	MA32B	; 9	RET Bildschirm loeschen
  402 AF9A  BA75        	DW	MA32B	; 10	RET
  403 AF9C  BA75        	DW	MA32B	; 11	RET
  404 AF9E  BA75        	DW	MA32B	; 12	RET
  405                   ;
  406                   ; Sprungtabelle fuer SCREEN 1 (Plotter)
  407                   ;
  408 AFA0  AFB8        SVTAB2:	DW	PL_SET		; 1 Setzen eines Punktes
  409 AFA2  AFD9        	DW	PL_LINE		; 2 Zeichnen Linie oder Rechteck
  410 AFA4  B0D5        	DW	PL_CIRCLE	; 3 Circle
  411 AFA6  B0D4        	DW	PL_PAINT	; 4 (nicht implementiert)
  412 AFA8  B2C9        	DW	PL_LABEL	; 5 Ausgabe Zeichenkette
  413 AFAA  B2B8        	DW	PL_SIZE		; 6 Festlegung Schriftart
  414 AFAC  B0A1        	DW	PL_ZERO		; 7 Nullpunkt festlegen
  415 AFAE  B0CE        	DW	PL_HOME		; 8 Pointer auf Home setzen
  416 AFB0  B0C8        	DW	PL_GCLS		; 9 Pointer auf 0,0 setzen
  417 AFB2  B233        	DW	PL_POINT	; 10 Punkt abfragen
  418 AFB4  B21B        	DW	PL_XPOS		; 11 X-Position abfragen
  419 AFB6  B22A        	DW	PL_YPOS		; 12 Y-Position abfragen
  420                   
  421                   ;*****************************************************************************
  422                   ;	PLOTTER-TREIBER
  423                   ;*****************************************************************************
  424                   
  425                   ;-----------------------------------------------------------------------------
  426                   ; Funktion 1: Setzen eines Punktes
  427                   ; DE = PARAM
  428                   ;	PARAM+0: Offs-Mode
  429                   ;	PARAM+1: 2 Byte X
  430                   ;	PARAM+3: 2 Byte Y
  431                   ;	PARAM+5: Stift
  432                   ; Offs-Mode: 	-1 Step, 1 absolut
  433                   ; Stift: 	1 Vordergrundfarbe, 0 Hintergrundfarbe
  434                   ;-----------------------------------------------------------------------------
  435                   
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  19
PL41XX  Z80

  436 AFB8  EB          PL_SET:	EX	DE,HL
  437 AFB9  7E          	LD	A,(HL)		; Offs-Mode
  438 AFBA  3D          	DEC	A
  439 AFBB  23          	INC	HL
  440 AFBC  CD AFD0     	CALL	PLSET2		; 2 Werte nach DE und BC holen
  441 AFBF  7E          	LD	A,(HL)		; Stift
  442 AFC0  28 07       	JR	Z,PLSET1	; Offd.-Mode absolut
  443 AFC2  A7          	AND	A
  444 AFC3  CA B295     	JP	Z,M9B2D		; Stift heben
  445 AFC6  C3 B2AA     	JP	M9B49		; Stift senken
  446                   	;
  447 AFC9  A7          PLSET1:	AND	A
  448 AFCA  CA B237     	JP	Z,M9ACF		; Stift heben
  449 AFCD  C3 B290     	JP	M9B28		; Stift senken
  450                   
  451                   ; 2 Werte nach DE und BC holen
  452                   		
  453 AFD0  5E          PLSET2:	LD	E,(HL)
  454 AFD1  23          	INC	HL
  455 AFD2  56          	LD	D,(HL)
  456 AFD3  23          	INC	HL
  457 AFD4  4E          	LD	C,(HL)
  458 AFD5  23          	INC	HL
  459 AFD6  46          	LD	B,(HL)
  460 AFD7  23          	INC	HL
  461 AFD8  C9          	RET
  462                   
  463                   ;-----------------------------------------------------------------------------
  464                   ; Funktion 2: Zeichnen Linie oder Rechteck
  465                   ; DE = PARAM
  466                   ;	PARAM+0: Offs-Mode 1. Punkt
  467                   ;	PARAM+1: 2 Byte X 1. Punkt
  468                   ;	PARAM+3: 2 Byte Y 1. Punkt
  469                   ;	PARAM+5: Offs-Mode 2. Punkt
  470                   ;	PARAM+6: 2 Byte X 2. Punkt
  471                   ;	PARAM+8: 2 Byte Y 2. Punkt
  472                   ;	PARAM+10: Stift
  473                   ;	PARAM+11: Box
  474                   ; Offs-Mode: 	-1 Step, 1 absolut, 0 1. Punkt ist aktuelle Koord.
  475                   ; Stift: 	1 Vordergrundfarbe, 0 Hintergrundfarbe
  476                   ; Box:		0 Linie, 1 Rechteck, [2 ausgefuelltes Rechteck ?]
  477                   ;-----------------------------------------------------------------------------
  478                   
  479 AFD9              PL_LINE:
  480 AFD9  D5          	PUSH	DE
  481 AFDA  FD E1       	POP	IY
  482 AFDC  FD 7E 00    	LD	A,(IY+0)	; Offs-Mode 1. Punkt
  483 AFDF  A7          	AND	A
  484 AFE0  FD E5       	PUSH	IY
  485 AFE2  E1          	POP	HL
  486 AFE3  23          	INC	HL
  487 AFE4  28 09       	JR	Z,PLINE1	; Offs.Mode aktuelle Koord.
  488 AFE6  CD AFD0     	CALL	PLSET2		; 2 Werte nach DE und BC holen
  489 AFE9  3D          	DEC	A
  490 AFEA  28 25       	JR	Z,PLINE2	; Offs.Mode absolut
  491 AFEC  CD B295     	CALL	M9B2D		; Stift heben
  492                   ; STEP 1. Punkt
  493 AFEF  2A 0245     PLINE1:	LD	HL,(POSX)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  20
PL41XX  Z80

  494 AFF2  ED 5B 0241  	LD	DE,(XHOME)
  495 AFF6  A7          	AND	A
  496 AFF7  ED 52       	SBC	HL,DE
  497 AFF9  FD 75 01    	LD	(IY+1),L
  498 AFFC  FD 74 02    	LD	(IY+2),H
  499 AFFF  2A 0247     	LD	HL,(POSY)
  500 B002  ED 5B 0243  	LD	DE,(YHOME)
  501 B006  A7          	AND	A
  502 B007  ED 52       	SBC	HL,DE
  503 B009  FD 75 03    	LD	(IY+3),L
  504 B00C  FD 74 04    	LD	(IY+4),H
  505 B00F  18 03       	JR	PLINE3
  506                   	;
  507 B011  CD B237     PLINE2:	CALL	M9ACF
  508 B014  FD 7E 05    PLINE3:	LD	A,(IY+5)	; Offs-Mode 2. Punkt
  509 B017  3D          	DEC	A
  510 B018  28 2E       	JR	Z,PLINE4
  511                   ; STEP 2. Punkt
  512 B01A  2A 0245     	LD	HL,(POSX)
  513 B01D  ED 5B 0241  	LD	DE,(XHOME)
  514 B021  A7          	AND	A
  515 B022  ED 52       	SBC	HL,DE
  516 B024  FD 5E 06    	LD	E,(IY+6)
  517 B027  FD 56 07    	LD	D,(IY+7)
  518 B02A  19          	ADD	HL,DE
  519 B02B  FD 75 06    	LD	(IY+6),L	; X2 mit Offset
  520 B02E  FD 74 07    	LD	(IY+7),H
  521 B031  2A 0247     	LD	HL,(POSY)
  522 B034  ED 4B 0243  	LD	BC,(YHOME)
  523 B038  A7          	AND	A
  524 B039  ED 42       	SBC	HL,BC
  525 B03B  FD 4E 08    	LD	C,(IY+8)
  526 B03E  FD 46 09    	LD	B,(IY+9)
  527 B041  09          	ADD	HL,BC
  528 B042  FD 75 08    	LD	(IY+8),L	; Y2 mit Offset
  529 B045  FD 74 09    	LD	(IY+9),H
  530 B048  FD 7E 0B    PLINE4:	LD	A,(IY+11)	; Box
  531 B04B  A7          	AND	A
  532 B04C  FD 46 0A    	LD	B,(IY+10)	; Stift
  533 B04F  20 0A       	JR	NZ,PLINE5	; Rechteck zeichnen
  534 B051  78          	LD	A,B
  535 B052  A7          	AND	A
  536 B053  28 3A       	JR	Z,PLINE6
  537                   ; Linie zeichnen
  538 B055  CD B094     	CALL	PLINE7	; DE=X2, BC=Y2
  539 B058  C3 B28B     	JP	M9B23		; Linie zeichnen nach (X2,Y2)
  540                   ; Rechteck zeichnen:
  541 B05B  78          PLINE5:	LD	A,B
  542 B05C  A7          	AND	A
  543 B05D  28 30       	JR	Z,PLINE6
  544 B05F  FD 5E 06    	LD	E,(IY+6)	; DE=X2
  545 B062  FD 56 07    	LD	D,(IY+7)
  546 B065  D5          	PUSH	DE
  547 B066  FD 4E 03    	LD	C,(IY+3)	; BC=Y1
  548 B069  FD 46 04    	LD	B,(IY+4)
  549 B06C  CD B28B     	CALL	M9B23		; Linie zeichnen nach (X2,Y1)
  550 B06F  D1          	POP	DE		; DE=X2
  551 B070  FD 4E 08    	LD	C,(IY+8)	; BC=Y2
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  21
PL41XX  Z80

  552 B073  FD 46 09    	LD	B,(IY+9)
  553 B076  C5          	PUSH	BC
  554 B077  CD B28B     	CALL	M9B23		; Linie zeichnen nach (X2,Y2)
  555 B07A  C1          	POP	BC		; BC=Y2
  556 B07B  FD 5E 01    	LD	E,(IY+1)	; DE=X1
  557 B07E  FD 56 02    	LD	D,(IY+2)
  558 B081  D5          	PUSH	DE
  559 B082  CD B28B     	CALL	M9B23		; Linie zeichnen nach (X1,Y2)
  560 B085  D1          	POP	DE		; DE=X1
  561 B086  FD 4E 03    	LD	C,(IY+3)	; BC=Y1
  562 B089  FD 46 04    	LD	B,(IY+4)
  563 B08C  CD B28B     	CALL	M9B23		; Linie zeichnen nach (X1,Y1)
  564 B08F  CD B094     PLINE6:	CALL	PLINE7
  565 B092  18 3D       	JR	PLHOM1
  566                   	;
  567 B094  FD 5E 06    PLINE7:	LD	E,(IY+6)	; DE=X2, BC=Y2
  568 B097  FD 56 07    	LD	D,(IY+7)
  569 B09A  FD 4E 08    	LD	C,(IY+8)
  570 B09D  FD 46 09    	LD	B,(IY+9)
  571 B0A0  C9          	RET
  572                   
  573                   ;-----------------------------------------------------------------------------
  574                   ; Funktion 7: Nullpunkt festlegen
  575                   ; DE = PARAM
  576                   ;	PARAM+0: Offs-Mode
  577                   ;	PARAM+1: 2 Byte X
  578                   ;	PARAM+3: 2 Byte Y
  579                   ; Offs-Mode: 	-1 Step, 1 absolut
  580                   ;-----------------------------------------------------------------------------
  581                   
  582 B0A1              PL_ZERO:
  583 B0A1  EB          	EX	DE,HL
  584 B0A2  7E          	LD	A,(HL)		; STEP?
  585 B0A3  3D          	DEC	A
  586 B0A4  23          	INC	HL
  587 B0A5  CD AFD0     	CALL	PLSET2		; 2 Werte nach DE und BC holen
  588 B0A8  28 0F       	JR	Z,PL_ZERO1	; kein Step
  589 B0AA  2A 0241     	LD	HL,(XHOME)
  590 B0AD  19          	ADD	HL,DE		; sonst STEP-Offset X addieren
  591 B0AE  22 0241     	LD	(XHOME),HL
  592 B0B1  2A 0243     	LD	HL,(YHOME)
  593 B0B4  09          	ADD	HL,BC		; STEP-Offset Y addieren
  594 B0B5  22 0243     	LD	(YHOME),HL
  595 B0B8  C9          	RET
  596 B0B9              PL_ZERO1:
  597 B0B9  ED 53 0241  	LD	(XHOME),DE
  598 B0BD  ED 43 0243  	LD	(YHOME),BC
  599 B0C1  C9          	RET
  600                   
  601                   ;-----------------------------------------------------------------------------
  602                   ; Funktion 9: Bildschirm loeschen, Pointer auf (0,0) setzen
  603                   ;-----------------------------------------------------------------------------
  604                   
  605 B0C2              PL_GCLS1:
  606 B0C2  01 0000     	LD	BC,0
  607 B0C5  50          	LD	D,B
  608 B0C6  59          	LD	E,C
  609 B0C7  C9          	RET
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  22
PL41XX  Z80

  610                   
  611 B0C8              PL_GCLS:
  612 B0C8  CD B0C2     	CALL	PL_GCLS1	; BC=0, DE=0
  613 B0CB  CD B0B9     	CALL	PL_ZERO1
  614                   
  615                   ;-----------------------------------------------------------------------------
  616                   ; Funktion 9: Pointer auf Home setzen
  617                   ;-----------------------------------------------------------------------------
  618                   
  619 B0CE              PL_HOME:
  620 B0CE  CD B0C2     	CALL	PL_GCLS1	; Pointer auf 0 setzen
  621 B0D1  C3 B237     PLHOM1:	JP	M9ACF		; Stift in Home-Position
  622                   
  623                   ;-----------------------------------------------------------------------------
  624                   ; Funktion 4: Paint - nicht implementiert
  625                   ; DE = PARAM
  626                   ;	PARAM+0: Offs-Mode
  627                   ;	PARAM+1: 2 Byte X
  628                   ;	PARAM+3: 2 Byte Y
  629                   ;	PARAM+5: c
  630                   ;	PARAM+6: d
  631                   ; Offs-Mode: 	-1 Step, 1 absolut
  632                   ;-----------------------------------------------------------------------------
  633                   
  634 B0D4              PL_PAINT:
  635 B0D4  C9          	RET
  636                   
  637                   ;-----------------------------------------------------------------------------
  638                   ; Funktion 3: Circle
  639                   ; DE = PARAM
  640                   ;	PARAM+0: Offs-Mode
  641                   ;	PARAM+1: 2 Byte Integer X
  642                   ;	PARAM+3: 2 Byte Integer Y
  643                   ;	PARAM+5: 4 Byte Float radius
  644                   ;	PARAM+9: stift
  645                   ;	PARAM+10: 4 Byte Float anf-winkel
  646                   ;	PARAM+14: 4 Byte Float end-winkel
  647                   ;	PARAM+18: 4 Byte Float ellip
  648                   ; Offs-Mode: 	-1 Step, 1 absolut
  649                   ; Stift: 	1 Vordergrundfarbe, 0 Hintergrundfarbe
  650                   ;-----------------------------------------------------------------------------
  651                   
  652 B0D5              PL_CIRCLE:
  653 B0D5  EB          	EX	DE,HL
  654 B0D6  7E          	LD	A,(HL)
  655 B0D7  3D          	DEC	A
  656 B0D8  F5          	PUSH	AF
  657 B0D9  23          	INC	HL
  658 B0DA  CD AFD0     	CALL	PLSET2		; 2 Werte nach DE und BC holen
  659 B0DD  2A 0247     	LD	HL,(POSY)
  660 B0E0  20 03       	JR	NZ,PL_CIRCLE1
  661 B0E2  21 0000     	LD	HL,0
  662 B0E5              PL_CIRCLE1:
  663 B0E5  09          	ADD	HL,BC
  664 B0E6  22 0288     	LD	(PARAM+3),HL
  665 B0E9  F1          	POP	AF
  666 B0EA  E5          	PUSH	HL
  667 B0EB  2A 0245     	LD	HL,(POSX)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  23
PL41XX  Z80

  668 B0EE  20 03       	JR	NZ,PL_CIRCLE2
  669 B0F0  21 0000     	LD	HL,0
  670 B0F3              PL_CIRCLE2:
  671 B0F3  19          	ADD	HL,DE
  672 B0F4  22 0286     	LD	(PARAM+1),HL
  673 B0F7  EB          	EX	DE,HL
  674 B0F8  C1          	POP	BC
  675 B0F9  3A 028E     	LD	A,(PARAM+9)
  676 B0FC  B7          	OR	A
  677 B0FD  CA B237     	JP	Z,M9ACF
  678 B100  21 028A     	LD	HL,PARAM+5
  679 B103  CD D6DD     	CALL	OPKOP
  680 B106  CD D91F     	CALL	B_SQR
  681 B109  01 8240     	LD	BC,8240H
  682 B10C  11 0000     	LD	DE,0
  683 B10F  CD D5F5     	CALL	DIV1
  684 B112  21 029B     	LD	HL,UN029B
  685 B115  CD D6F7     	CALL	OPTRAN
  686 B118  AF          	XOR	A
  687 B119  32 0285     	LD	(PARAM),A
  688 B11C  3C          	INC	A
  689 B11D  4F          	LD	C,A
  690 B11E  21 028F     	LD	HL,PARAM+10
  691 B121  CD BA2C     	CALL	MA2E1
  692 B124  D5          	PUSH	DE
  693 B125  0E 80       	LD	C,80H
  694 B127  21 0293     	LD	HL,PARAM+14
  695 B12A  CD BA2C     	CALL	MA2E1
  696 B12D  E1          	POP	HL
  697 B12E  AF          	XOR	A
  698 B12F  EB          	EX	DE,HL
  699 B130  CD C689     	CALL	CPREG		; Vergleich Register DE mit HL
  700 B133  30 14       	JR	NC,PL_CIRCLE3
  701 B135  21 0293     	LD	HL,PARAM+14
  702 B138  E5          	PUSH	HL
  703 B139  CD D6DD     	CALL	OPKOP
  704 B13C  01 8349     	LD	BC,8349H
  705 B13F  11 0FDB     	LD	DE,0FDBH
  706 B142  CD D46F     	CALL	ADD5
  707 B145  E1          	POP	HL
  708 B146  CD D6F7     	CALL	OPTRAN
  709 B149              PL_CIRCLE3:
  710 B149  CD B1C2     	CALL	M9A5A
  711 B14C  C5          	PUSH	BC
  712 B14D  D5          	PUSH	DE
  713 B14E  3A 0285     	LD	A,(PARAM)
  714 B151  1F          	RRA
  715 B152  30 12       	JR	NC,PL_CIRCLE4
  716 B154  ED 4B 0288  	LD	BC,(PARAM+3)
  717 B158  ED 5B 0286  	LD	DE,(PARAM+1)
  718 B15C  CD B237     	CALL	M9ACF
  719 B15F  D1          	POP	DE
  720 B160  C1          	POP	BC
  721 B161  CD B28B     	CALL	M9B23		; Linie zeichnen
  722 B164  18 05       	JR	PL_CIRCLE5
  723 B166              PL_CIRCLE4:
  724 B166  D1          	POP	DE
  725 B167  C1          	POP	BC
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  24
PL41XX  Z80

  726 B168  CD B237     	CALL	M9ACF
  727 B16B              PL_CIRCLE5:
  728 B16B  21 028F     	LD	HL,PARAM+10
  729 B16E  CD D6DD     	CALL	OPKOP
  730 B171  21 029B     	LD	HL,UN029B
  731 B174  CD D6EE     	CALL	OPLAD
  732 B177  CD D46F     	CALL	ADD5
  733 B17A  21 0293     	LD	HL,PARAM+14
  734 B17D  CD D6EE     	CALL	OPLAD
  735 B180  21 03E8     	LD	HL,WRA1+3
  736 B183  78          	LD	A,B
  737 B184  BE          	CP	(HL)
  738 B185  20 0D       	JR	NZ,PL_CIRCLE6
  739 B187  2B          	DEC	HL
  740 B188  79          	LD	A,C
  741 B189  BE          	CP	(HL)
  742 B18A  20 08       	JR	NZ,PL_CIRCLE6
  743 B18C  2B          	DEC	HL
  744 B18D  7A          	LD	A,D
  745 B18E  BE          	CP	(HL)
  746 B18F  20 03       	JR	NZ,PL_CIRCLE6
  747 B191  2B          	DEC	HL
  748 B192  7B          	LD	A,E
  749 B193  BE          	CP	(HL)
  750 B194              PL_CIRCLE6:
  751 B194  F5          	PUSH	AF
  752 B195  30 03       	JR	NC,PL_CIRCLE7
  753 B197  CD D6E0     	CALL	OPKOP1
  754 B19A              PL_CIRCLE7:
  755 B19A  21 028F     	LD	HL,PARAM+10
  756 B19D  CD D6F7     	CALL	OPTRAN
  757 B1A0  CD B1C2     	CALL	M9A5A
  758 B1A3  CD B28B     	CALL	M9B23		; Linie zeichnen
  759 B1A6  F1          	POP	AF
  760 B1A7  28 02       	JR	Z,PL_CIRCLE8
  761 B1A9  30 C0       	JR	NC,PL_CIRCLE5
  762 B1AB              PL_CIRCLE8:
  763 B1AB  3A 0285     	LD	A,(PARAM)
  764 B1AE  17          	RLA
  765 B1AF  ED 4B 0288  	LD	BC,(PARAM+3)
  766 B1B3  ED 5B 0286  	LD	DE,(PARAM+1)
  767 B1B7  30 05       	JR	NC,PL_CIRCLE9
  768 B1B9  CD B28B     	CALL	M9B23		; Linie zeichnen
  769 B1BC  18 03       	JR	PL_CIRCLE10
  770 B1BE              PL_CIRCLE9:
  771 B1BE  CD B237     	CALL	M9ACF
  772 B1C1              PL_CIRCLE10:
  773 B1C1  C9          	RET
  774                   
  775 B1C2  21 028F     M9A5A:	LD	HL,PARAM+10
  776 B1C5  CD D6DD     	CALL	OPKOP
  777 B1C8  CD DA76     	CALL	B_SIN
  778 B1CB  21 028A     	LD	HL,PARAM+5
  779 B1CE  CD D6EE     	CALL	OPLAD
  780 B1D1  CD D59A     	CALL	MUL1
  781 B1D4  3A 029A     	LD	A,(UN029A)
  782 B1D7  FE 81       	CP	81H
  783 B1D9  F5          	PUSH	AF
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  25
PL41XX  Z80

  784 B1DA  30 09       	JR	NC,M9A7D
  785 B1DC  21 0297     	LD	HL,PARAM+18
  786 B1DF  CD D6EE     	CALL	OPLAD
  787 B1E2  CD D59A     	CALL	MUL1
  788 B1E5  CD C96F     M9A7D:	CALL	EPRVL3
  789 B1E8  2A 0288     	LD	HL,(PARAM+3)
  790 B1EB  19          	ADD	HL,DE
  791 B1EC  E3          	EX	(SP),HL
  792 B1ED  E5          	PUSH	HL
  793 B1EE  21 028F     	LD	HL,PARAM+10
  794 B1F1  CD D6DD     	CALL	OPKOP
  795 B1F4  CD DA70     	CALL	COS
  796 B1F7  21 028A     	LD	HL,PARAM+5
  797 B1FA  CD D6EE     	CALL	OPLAD
  798 B1FD  CD D59A     	CALL	MUL1
  799 B200  F1          	POP	AF
  800 B201  38 0E       	JR	C,M9AA9
  801 B203  CD D6C8     	CALL	OPARST
  802 B206  21 0297     	LD	HL,PARAM+18
  803 B209  CD D6DD     	CALL	OPKOP
  804 B20C  C1          	POP	BC
  805 B20D  D1          	POP	DE
  806 B20E  CD D5F5     	CALL	DIV1
  807 B211  CD C96F     M9AA9:	CALL	EPRVL3
  808 B214  2A 0286     	LD	HL,(PARAM+1)
  809 B217  19          	ADD	HL,DE
  810 B218  EB          	EX	DE,HL
  811 B219  C1          	POP	BC
  812 B21A  C9          	RET
  813                   
  814                   ;-----------------------------------------------------------------------------
  815                   ; Funktion 11: X-Position abfragen
  816                   ;-----------------------------------------------------------------------------
  817                   
  818 B21B              PL_XPOS:
  819 B21B  2A 0245     	LD	HL,(POSX)
  820 B21E  ED 5B 0241  	LD	DE,(XHOME)
  821 B222              PL_XPOS1:
  822 B222  A7          	AND	A
  823 B223  ED 52       	SBC	HL,DE
  824 B225  45          	LD	B,L
  825 B226  7C          	LD	A,H
  826 B227              PL_XPOS2:
  827 B227  C3 D0B1     	JP	FRE3
  828                   
  829                   ;-----------------------------------------------------------------------------
  830                   ; Funktion 12: Y-Position abfragen
  831                   ;-----------------------------------------------------------------------------
  832                   
  833 B22A              PL_YPOS:
  834 B22A  2A 0247     	LD	HL,(POSY)
  835 B22D  ED 5B 0243  	LD	DE,(YHOME)
  836 B231  18 EF       	JR	PL_XPOS1
  837                   
  838                   ;-----------------------------------------------------------------------------
  839                   ; Funktion 10: Punkt abfragen
  840                   ; DE = parambuf
  841                   ; 	parambuf+0: Offs-Mode
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  26
PL41XX  Z80

  842                   ; 	parambuf+1: 2 Byte X
  843                   ; 	parambuf+3: 2 Byte Y
  844                   ; Offs-Mode: 	-1 Step, 1 absolut
  845                   ;-----------------------------------------------------------------------------
  846                   
  847 B233              PL_POINT:
  848 B233  AF          	XOR	A
  849 B234  47          	LD	B,A
  850 B235  18 F0       	JR	PL_XPOS2
  851                   
  852                   ; PE:	BC, DE	neue Positionen
  853 B237  3E 00       M9ACF:	LD	A,0
  854 B239  6F          	LD	L,A
  855 B23A  67          	LD	H,A
  856 B23B  E5          M9AD3:	PUSH	HL
  857 B23C  CD B656     	CALL	M9F01		; Plotter bereit? sonst ?PO-ERROR
  858 B23F  E1          	POP	HL		; HL=0
  859 B240  22 024C     	LD	(UN024C),HL	; (024C)=0000H
  860 B243  2A 0241     	LD	HL,(XHOME)	; aktuelle Position
  861 B246  19          	ADD	HL,DE		; + neue Position
  862 B247  22 0250     	LD	(UN0250),HL	; (0250)=(0241)+DE
  863 B24A  2A 0243     	LD	HL,(YHOME)	; aktuelle Position
  864 B24D  09          M9AE5:	ADD	HL,BC
  865 B24E  22 0252     	LD	(UN0252),HL	; (0252)=(0243)+BC
  866 B251  AF          	XOR	A
  867 B252  32 0254     	LD	(UN0254),A	; (0254)=00H
  868 B255  21 0250     	LD	HL,UN0250
  869 B258  CD B451     	CALL	M9CF6
  870 B25B  3A 0254     M9AF3:	LD	A,(UN0254)	; ausserhalb?
  871 B25E  A7          	AND	A
  872 B25F  20 0C       	JR	NZ,M9B05	; out of range
  873 B261  3A 024C     	LD	A,(UN024C)
  874 B264  A7          	AND	A	; Stift runter?
  875 B265  C8          	RET	Z	; nein, Stift bleibt oben
  876 B266  CD B63E     	CALL	M9EE7	; Ausgabe A zu Plotter (Stift runter)
  877 B269  AF          	XOR	A	; Stift oben
  878 B26A  C3 B63E     	JP	M9EE7	; Ausgabe A zu Plotter (Stift wieder hoch)
  879                   
  880                   ; [X][Y] OUT OF RANGE
  881 B26D              M9B05:
  882 B26D  11 5958     	LD	DE,'YX'
  883 B270  FE 03       	CP	3	; X und Y ?
  884 B272  28 06       	JR	Z,M9B12	; ja
  885 B274  1E 20       	LD	E,' '	; X loaschen
  886 B276  0F          	RRCA		; X?
  887 B277  30 01       	JR	NC,M9B12	; nur Y anzeigen
  888 B279  15          	DEC	D	; nur X anzeigen
  889 B27A              M9B12:
  890 B27A  ED 53 0234  	LD	(UN0234),DE ; Koordinate eintragen
  891 B27E  21 0234     	LD	HL,UN0234 ; "XY"
  892 B281  CD D1C9     	CALL	TEXTO	; Text in (HL) ausgeben
  893 B284  21 B746     	LD	HL,M9FFB	; Text "OUT OF RANGE"
  894 B287  CD D1C9     	CALL	TEXTO	; Text in (HL) ausgeben
  895 B28A  C9          	RET
  896                   
  897                   ; Linie zeichnen nach (DE,BC)
  898 B28B  CD B2AF     M9B23:	CALL	M9B4E
  899 B28E  18 AB       	JR	M9AD3
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  27
PL41XX  Z80

  900                   
  901 B290  21 0080     M9B28:	LD	HL,80H
  902 B293  18 A6       	JR	M9AD3
  903                   
  904                   ; Stift heben
  905 B295  21 0000     M9B2D:	LD	HL,0		; Bit 7=0 hebt Stift
  906 B298  22 024C     M9B30:	LD	(UN024C),HL	; Bit 7 = heben oder senken
  907 B29B  CD B656     	CALL	M9F01		; Plotter bereit? sonst ?PO-ERROR
  908 B29E  2A 0245     	LD	HL,(POSX)
  909 B2A1  19          	ADD	HL,DE
  910 B2A2  22 0250     	LD	(UN0250),HL
  911 B2A5  2A 0247     	LD	HL,(POSY)
  912 B2A8  18 A3       	JR	M9AE5
  913                   
  914                   ; unbenutzt ???
  915                   ;	CALL	M9B4E
  916                   ;	JR	M9B30
  917                   
  918                   ; Stift senken
  919 B2AA  21 0080     M9B49:	LD	HL,80H		; Bit 7=1 senkt Stift ab
  920 B2AD  18 E9       	JR	M9B30
  921                   
  922 B2AF  CD B656     M9B4E:	CALL	M9F01		; Plotter bereit? sonst ?PO-ERROR
  923 B2B2  2A 024A     	LD	HL,(UN024A)
  924 B2B5  2E 00       	LD	L,0
  925 B2B7  C9          	RET
  926                   
  927                   ;-----------------------------------------------------------------------------
  928                   ; Funktion 6: Size, Festlegung der Schriftart
  929                   ; DE = parambuf
  930                   ;	parambuf+8: a
  931                   ; 	parambuf+9: 4 Byte Float b
  932                   ; 	parambuf+13: 4 Byte Float l
  933                   ; 	parambuf+17: 4 Byte Float r
  934                   ; a: Abstand 0 - gleichabstaendig, 80h - proportional
  935                   ;-----------------------------------------------------------------------------
  936                   
  937 B2B8              PL_SIZE:
  938 B2B8  CD B656     	CALL	M9F01		; Plotter bereit? sonst ?PO-ERROR
  939 B2BB  EB          	EX	DE,HL
  940 B2BC  01 0008     	LD	BC,8
  941 B2BF  11 0239     	LD	DE,UN0239
  942 B2C2  ED B0       	LDIR
  943 B2C4  7E          	LD	A,(HL)
  944 B2C5  32 0249     	LD	(UN0249),A
  945 B2C8  C9          	RET
  946                   
  947                   ;-----------------------------------------------------------------------------
  948                   ; Funktion 5: Ausgabe einer Zeichenkette
  949                   ; DE = parambuf
  950                   ; 	parambuf+0: 2 Byte Laenge Zeichenkette (max. 255!)
  951                   ; 	parambuf+2: 2 Byte Adr. Zeichenkette
  952                   ; 	parambuf+4: Stift
  953                   ; Stift: 	1 Vordergrundfarbe, 0 Hintergrundfarbe
  954                   ;-----------------------------------------------------------------------------
  955                   
  956 B2C9              PL_LABEL:
  957 B2C9  EB          	EX	DE,HL
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  28
PL41XX  Z80

  958 B2CA  7E          	LD	A,(HL)
  959 B2CB  23          	INC	HL
  960 B2CC  23          	INC	HL
  961 B2CD  5E          	LD	E,(HL)
  962 B2CE  23          	INC	HL
  963 B2CF  56          	LD	D,(HL)
  964 B2D0  3C          	INC	A
  965 B2D1  F5          	PUSH	AF
  966 B2D2  D5          	PUSH	DE
  967 B2D3  CD B656     	CALL	M9F01		; Plotter bereit? sonst ?PO-ERROR
  968 B2D6  21 0000     	LD	HL,0
  969 B2D9  22 024C     	LD	(UN024C),HL	; Stift anheben
  970 B2DC  2A 0245     	LD	HL,(POSX)
  971 B2DF  22 0256     	LD	(UN0256),HL
  972 B2E2  22 025A     	LD	(UN025A),HL
  973 B2E5  2A 0247     	LD	HL,(POSY)
  974 B2E8  22 0258     	LD	(UN0258),HL
  975 B2EB  22 025C     	LD	(UN025C),HL
  976 B2EE  E1          LABL1:	POP	HL
  977 B2EF  D1          	POP	DE
  978 B2F0  15          	DEC	D
  979 B2F1  CA B448     	JP	Z,M9CED
  980 B2F4  7E          	LD	A,(HL)	; naechstes auszugebendes Zeichen
  981 B2F5  D5          	PUSH	DE
  982 B2F6  E5          	PUSH	HL
  983 B2F7  FE 0D       	CP	0DH	; Zeilenwechsel speziell behandeln
  984 B2F9  CA B3ED     	JP	Z,LABL17
  985 B2FC  FE 18       	CP	18H
  986 B2FE  38 04       	JR	C,LABL2	; Steuercode kleiner als 18H
  987 B300  FE 80       	CP	80H
  988 B302  38 02       	JR	C,LABL3	; Zeichencodes 18H bis 7FH
  989 B304  3E 20       LABL2:	LD	A,' '	; Ersatz fuer Steuerzeichen
  990 B306  D6 10       LABL3:	SUB	10H
  991 B308  21 B75D     	LD	HL,LBLTAB		; Tabelle
  992 B30B  06 00       	LD	B,0
  993 B30D  57          	LD	D,A	; Zeichencode - 16
  994 B30E  7E          LABL4:	LD	A,(HL)
  995 B30F  E6 8F       	AND	8FH
  996 B311  3C          	INC	A
  997 B312  07          	RLCA			; Bit7 nach Cy kopieren
  998 B313  CB 2F       	SRA	A		; A enthaelt jetzt wieder die unteren 4 Bit
  999 B315  15          	DEC	D		; naechste Zeichenposition
 1000 B316  28 07       	JR	Z,LABL6		; gesuchte Zeichenposition erreicht
 1001 B318  30 01       	JR	NC,LABL5	; wenn Bit7 nicht gesetzt war, dann kein Byte weiter in Liste
 1002 B31A  23          	INC	HL		; sonst ein Byte weiter in Liste
 1003 B31B  4F          LABL5:	LD	C,A		; Anzahl genutzter Bytes fuer Zeichen
 1004 B31C  09          	ADD	HL,BC		; ueberspringen
 1005 B31D  18 EF       	JR	LABL4		; Adr. des naechsten Zeichens
 1006 B31F              LABL6:
 1007 B31F  58          	LD	E,B		; B ist 0
 1008 B320  30 01       	JR	NC,LABL7
 1009 B322  1C          	INC	E
 1010 B323  57          LABL7:	LD	D,A
 1011 B324  EB          	EX	DE,HL
 1012 B325  22 0265     	LD	(UN0265),HL
 1013 B328  E1          	POP	HL
 1014 B329  E5          	PUSH	HL
 1015 B32A  7E          	LD	A,(HL)
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  29
PL41XX  Z80

 1016 B32B  FE 18       	CP	18H		; Umlaut-Code
 1017 B32D  20 09       	JR	NZ,LABL8
 1018 B32F  23          	INC	HL
 1019 B330  7E          	LD	A,(HL)		; naechstes Zeichen holen
 1020 B331  0E 03       	LD	C,3
 1021 B333  21 B75A     	LD	HL,UMLTAB	; Umlaut-Tabelle
 1022 B336  ED B1       	CPIR			; zulaessig als Umlaut?
 1023 B338  1A          LABL8:	LD	A,(DE)
 1024 B339  D5          	PUSH	DE
 1025 B33A  20 02       	JR	NZ,LABL9
 1026 B33C  F6 50       	OR	50H
 1027 B33E  50          LABL9:	LD	D,B
 1028 B33F  58          	LD	E,B
 1029 B340  07          	RLCA
 1030 B341  07          	RLCA
 1031 B342  30 02       	JR	NC,LABL10
 1032 B344  16 FC       	LD	D,0FCH
 1033 B346  07          LABL10:	RLCA
 1034 B347  30 02       	JR	NC,LABL11
 1035 B349  1E FD       	LD	E,0FDH
 1036 B34B  21 0249     LABL11:	LD	HL,UN0249
 1037 B34E  A6          	AND	(HL)
 1038 B34F  07          	RLCA
 1039 B350  30 01       	JR	NC,LABL12
 1040 B352  1D          	DEC	E
 1041 B353  EB          LABL12:	EX	DE,HL
 1042 B354  22 0263     	LD	(UN0263),HL
 1043 B357  21 0266     LABL13:	LD	HL,UN0265+1
 1044 B35A  35          	DEC	(HL)
 1045 B35B  E1          	POP	HL
 1046 B35C  23          	INC	HL
 1047 B35D  28 46       	JR	Z,LABL14
 1048 B35F  E5          	PUSH	HL
 1049 B360  7E          	LD	A,(HL)
 1050 B361  F5          	PUSH	AF
 1051 B362  07          	RLCA
 1052 B363  07          	RLCA
 1053 B364  07          	RLCA
 1054 B365  07          	RLCA
 1055 B366  E6 07       	AND	7
 1056 B368  21 0263     	LD	HL,UN0263
 1057 B36B  86          	ADD	A,(HL)
 1058 B36C  CD B40F     	CALL	M9CB4
 1059 B36F  F1          	POP	AF
 1060 B370  F5          	PUSH	AF
 1061 B371  E6 0F       	AND	0FH
 1062 B373  21 0264     	LD	HL,UN0263+1
 1063 B376  86          	ADD	A,(HL)
 1064 B377  CD B42B     	CALL	M9CD0
 1065 B37A  2A 0258     	LD	HL,(UN0258)
 1066 B37D  19          	ADD	HL,DE
 1067 B37E  22 0252     	LD	(UN0252),HL
 1068 B381  2A 0256     	LD	HL,(UN0256)
 1069 B384  D1          	POP	DE
 1070 B385  19          	ADD	HL,DE
 1071 B386  22 0250     	LD	(UN0250),HL
 1072 B389  F1          	POP	AF
 1073 B38A  21 024C     	LD	HL,UN024C
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  30
PL41XX  Z80

 1074 B38D  B6          	OR	(HL)
 1075 B38E  2B          	DEC	HL
 1076 B38F  A6          	AND	(HL)
 1077 B390  32 024D     	LD	(UN024D),A
 1078 B393  21 0250     	LD	HL,UN0250
 1079 B396  CD B451     	CALL	M9CF6
 1080 B399  3A 024B     	LD	A,(UN024B)
 1081 B39C  CD B63E     	CALL	M9EE7	; Ausgabe A zu Plotter
 1082 B39F  AF          	XOR	A
 1083 B3A0  32 024C     	LD	(UN024C),A	; Stift anheben
 1084 B3A3  18 B2       	JR	LABL13
 1085                   
 1086 B3A5  3A 0265     LABL14:	LD	A,(UN0265)
 1087 B3A8  A7          	AND	A
 1088 B3A9  28 0C       	JR	Z,LABL15
 1089 B3AB  7E          	LD	A,(HL)
 1090 B3AC  E6 80       	AND	80H		; Stift senken
 1091 B3AE  32 024C     	LD	(UN024C),A
 1092 B3B1  7E          	LD	A,(HL)
 1093 B3B2  E6 7F       	AND	7FH
 1094 B3B4  C3 B306     	JP	LABL3
 1095                   	;
 1096 B3B7  AF          LABL15:	XOR	A	; Stift oben
 1097 B3B8  CD B63E     	CALL	M9EE7	; Ausgabe A zu Plotter
 1098 B3BB  E1          	POP	HL
 1099 B3BC  E5          	PUSH	HL
 1100 B3BD  7E          	LD	A,(HL)
 1101 B3BE  FE 20       	CP	' '
 1102 B3C0  38 17       	JR	C,LABL16
 1103 B3C2  3A 0263     	LD	A,(UN0263)
 1104 B3C5  87          	ADD	A,A
 1105 B3C6  C6 08       	ADD	A,8
 1106 B3C8  CD B40F     	CALL	M9CB4
 1107 B3CB  2A 0256     	LD	HL,(UN0256)
 1108 B3CE  09          	ADD	HL,BC
 1109 B3CF  22 0256     	LD	(UN0256),HL
 1110 B3D2  2A 0258     	LD	HL,(UN0258)
 1111 B3D5  19          	ADD	HL,DE
 1112 B3D6  22 0258     	LD	(UN0258),HL
 1113 B3D9  E1          LABL16:	POP	HL
 1114 B3DA  23          	INC	HL
 1115 B3DB  E5          	PUSH	HL
 1116                   ;	LD	C,0BH	; KC87: UP-Nr.
 1117                   ;	CALL	SYS	; KC87: Abfrage CONSTAT
 1118 B3DC  CD C8F9     	CALL	TESC	; Unterbrechungsanforderung?
 1119 B3DF  FE 03       	CP	3	; BRK?
 1120 B3E1  C2 B2EE     	JP	NZ,LABL1
 1121 B3E4  21 0256     	LD	HL,UN0256
 1122 B3E7  CD B451     	CALL	M9CF6
 1123                   ;	LD	A,0E2H		; RAND: cyan auf gruen, Grafik aus
 1124                   ;	OUT	(0B8H),A	; KC87 Grafikzusatz
 1125                   ;	JP	0C806H		; BASIC-ROM: mitten in FOR-Schleife ???
 1126 B3EA  C3 C91B     	JP	END0		; BASIC-ROM: Programmabbruch koennte es eher sein
 1127                   
 1128 B3ED              LABL17:	; Zeichencode 0DH plotten (Zeilenwechsel)
 1129 B3ED  3A 024F     	LD	A,(UN024F)
 1130 B3F0  11 0000     	LD	DE,0
 1131 B3F3  42          	LD	B,D
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  31
PL41XX  Z80

 1132 B3F4  4A          	LD	C,D
 1133 B3F5  CD B42B     	CALL	M9CD0
 1134 B3F8  2A 025C     	LD	HL,(UN025C)
 1135 B3FB  19          	ADD	HL,DE
 1136 B3FC  22 0258     	LD	(UN0258),HL
 1137 B3FF  22 025C     	LD	(UN025C),HL
 1138 B402  D1          	POP	DE
 1139 B403  2A 025A     	LD	HL,(UN025A)
 1140 B406  19          	ADD	HL,DE
 1141 B407  22 0256     	LD	(UN0256),HL
 1142 B40A  22 025A     	LD	(UN025A),HL
 1143 B40D  18 CA       	JR	LABL16
 1144                   
 1145 B40F  F5          M9CB4:	PUSH	AF
 1146 B410  2A 0239     	LD	HL,(UN0239)
 1147 B413  CD B5EC     	CALL	M9E95
 1148 B416  3E 06       	LD	A,6
 1149 B418  CD B5C1     	CALL	M9E6A
 1150 B41B  44          	LD	B,H
 1151 B41C  4D          	LD	C,L
 1152 B41D  F1          	POP	AF
 1153 B41E  2A 023B     	LD	HL,(UN023B)
 1154 B421  CD B5EC     	CALL	M9E95
 1155 B424  3E 06       	LD	A,6
 1156 B426  CD B5C1     	CALL	M9E6A
 1157 B429  EB          	EX	DE,HL
 1158 B42A  C9          	RET
 1159                   
 1160 B42B  F5          M9CD0:	PUSH	AF
 1161 B42C  2A 023F     	LD	HL,(UN023F)
 1162 B42F  CD B5EC     	CALL	M9E95
 1163 B432  3E 0A       	LD	A,0AH
 1164 B434  CD B5C1     	CALL	M9E6A
 1165 B437  19          	ADD	HL,DE
 1166 B438  EB          	EX	DE,HL
 1167 B439  F1          	POP	AF
 1168 B43A  2A 023D     	LD	HL,(UN023D)
 1169 B43D  CD B5EC     	CALL	M9E95
 1170 B440  3E 0A       	LD	A,0AH
 1171 B442  CD B5C1     	CALL	M9E6A
 1172 B445  09          	ADD	HL,BC
 1173 B446  E3          	EX	(SP),HL
 1174 B447  E9          	JP	(HL)
 1175                   
 1176 B448  21 0256     M9CED:	LD	HL,UN0256
 1177 B44B  CD B451     	CALL	M9CF6
 1178 B44E  C3 B25B     	JP	M9AF3		; Test "Out of range?"
 1179                   
 1180 B451  E5          M9CF6:	PUSH	HL		; UN0250 oder UN0256
 1181 B452  CD B656     	CALL	M9F01		; Plotter bereit?
 1182 B455  11 026A     	LD	DE,UN026A
 1183 B458  21 B6D0     	LD	HL,M9F85	; zwei Unterprogramme
 1184 B45B  01 0011     	LD	BC,11H
 1185 B45E  ED B0       	LDIR			; kopieren nach UN026A-027AH
 1186 B460  3E 3D       	LD	A,3DH		; DEC A
 1187 B462  32 027B     	LD	(UN027B),A	; nach UN027B
 1188 B465  ED 5B 0245  	LD	DE,(POSX)
 1189 B469  E1          	POP	HL
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  32
PL41XX  Z80

 1190 B46A  E5          	PUSH	HL		; UN0250 oder UN0256
 1191 B46B  01 F60A     	LD	BC,-2550	; Grenzwert X-Koordinate
 1192 B46E  CD B57D     	CALL	M9E26
 1193 B471  22 0268     	LD	(UN0268),HL	; FFFFH bei HOME
 1194 B474  EB          	EX	DE,HL
 1195 B475  E3          	EX	(SP),HL
 1196 B476  E5          	PUSH	HL
 1197 B477  21 0254     	LD	HL,UN0254
 1198 B47A  B6          	OR	(HL)		; ausserhalb?
 1199 B47B  77          	LD	(HL),A		; neu eintragen
 1200 B47C  60          	LD	H,B
 1201 B47D  79          	LD	A,C
 1202 B47E  EE 02       	XOR	2		; 1301H -> 1303H oder 1B00H -> 1B02H
 1203 B480  6F          	LD	L,A
 1204 B481  22 026D     	LD	(UN026D),HL	; 1303H
 1205 B484  ED 5B 0247  	LD	DE,(POSY)
 1206 B488  E1          	POP	HL
 1207 B489  23          	INC	HL
 1208 B48A  23          	INC	HL
 1209 B48B  01 F8F8     	LD	BC,-1800	; Grenzwert Y-Koordinate
 1210 B48E  CD B57D     	CALL	M9E26
 1211 B491  22 0273     	LD	(UN0273),HL
 1212 B494  07          	RLCA			; A=2, bei Fehler Y-Achse
 1213 B495  21 0254     	LD	HL,UN0254
 1214 B498  B6          	OR	(HL)		; ausserhalb?
 1215 B499  77          	LD	(HL),A		; neu eintragen
 1216 B49A  ED 43 0278  	LD	(UN0278),BC	; 1301H
 1217 B49E  CD B61C     	CALL	M9EC5
 1218 B4A1  01 024D     	LD	BC,UN024D
 1219 B4A4  21 026D     	LD	HL,UN026D
 1220 B4A7  0A          	LD	A,(BC)	; 00
 1221 B4A8  B6          	OR	(HL)	; 03	
 1222 B4A9  77          	LD	(HL),A
 1223 B4AA  0A          	LD	A,(BC)	; 00
 1224 B4AB  21 0278     	LD	HL,UN0278
 1225 B4AE  B6          	OR	(HL)	; 01
 1226 B4AF  77          	LD	(HL),A
 1227 B4B0  E1          	POP	HL
 1228 B4B1  E5          	PUSH	HL
 1229 B4B2  B7          	OR	A	; CY=0
 1230 B4B3  ED 52       	SBC	HL,DE		; Richtung steil oder flach?
 1231 B4B5  E1          	POP	HL
 1232 B4B6  F2 B4BA     	JP	P,M9D5F
 1233 B4B9  EB          	EX	DE,HL
 1234 B4BA  E5          M9D5F:	PUSH	HL
 1235 B4BB  D5          	PUSH	DE
 1236 B4BC  21 0273     	LD	HL,UN0273	; Y-Steps
 1237 B4BF  11 0268     	LD	DE,UN0268	; X-Steps
 1238 B4C2  06 07       	LD	B,7		; 7 Bytes der Werte
 1239 B4C4  FC B612     	CALL	M,M9EBB		; X/Y bei Bedarf tauschen
 1240 B4C7  2A 0268     	LD	HL,(UN0268)
 1241 B4CA  EB          	EX	DE,HL
 1242 B4CB  2A 0262     	LD	HL,(UN0262)
 1243 B4CE  26 00       	LD	H,0
 1244 B4D0  29          	ADD	HL,HL	; *2
 1245 B4D1  29          	ADD	HL,HL	; *4
 1246 B4D2  E5          	PUSH	HL
 1247 B4D3  29          	ADD	HL,HL	; *8
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  33
PL41XX  Z80

 1248 B4D4  E1          	POP	HL
 1249 B4D5  38 4F       	JR	C,M9DCB
 1250 B4D7  19          	ADD	HL,DE
 1251 B4D8  22 025E     M9D7D:	LD	(UN025E),HL
 1252 B4DB  E1          	POP	HL
 1253 B4DC  CD B5B8     	CALL	M9E61		; HL negieren
 1254 B4DF  EB          	EX	DE,HL
 1255 B4E0  C1          	POP	BC
 1256 B4E1  21 0000     	LD	HL,0
 1257 B4E4  E5          	PUSH	HL
 1258 B4E5  F3          	DI
 1259 B4E6  21 0268     M9D8B:	LD	HL,UN0268	; X-Steps
 1260 B4E9  CD B52E     	CALL	M9DD3
 1261 B4EC  AF          	XOR	A
 1262 B4ED  E1          	POP	HL
 1263 B4EE  19          	ADD	HL,DE
 1264 B4EF  B4          	OR	H
 1265 B4F0  3A 0261     	LD	A,(UN0261)	; Schreibgeschwindigkeit
 1266 B4F3  E5          	PUSH	HL
 1267 B4F4  F2 B502     	JP	P,M9DA7
 1268 B4F7  09          	ADD	HL,BC
 1269 B4F8  E3          	EX	(SP),HL
 1270 B4F9  21 0273     	LD	HL,UN0273	; Y-Steps
 1271 B4FC  CD B52E     	CALL	M9DD3
 1272 B4FF  3A 0260     	LD	A,(UN0260)	; Zeitkonstante Schreibgeschwindigkeit lesen
 1273 B502  3D          M9DA7:	DEC	A		; rueckwaerts zaehlen
 1274 B503  20 FD       	JR	NZ,M9DA7	; bis A=0
 1275 B505  21 025E     	LD	HL,UN025E
 1276 B508  34          	INC	(HL)
 1277 B509  20 09       	JR	NZ,M9DB9
 1278 B50B  23          	INC	HL
 1279 B50C  34          	INC	(HL)
 1280 B50D  20 05       	JR	NZ,M9DB9
 1281 B50F  3E 3C       	LD	A,3CH		; INC A
 1282 B511  32 027B     	LD	(UN027B),A
 1283 B514  C5          M9DB9:	PUSH	BC
 1284 B515  21 B70F     	LD	HL,M9FC5-1	; Tabelle mit Werten 1,2,3...
 1285 B518  3A 0262     	LD	A,(UN0262)
 1286 B51B  06 00       	LD	B,0
 1287 B51D  4F          	LD	C,A
 1288 B51E  09          	ADD	HL,BC
 1289 B51F  C1          	POP	BC
 1290 B520  7E          	LD	A,(HL)
 1291 B521  3D          M9DC6:	DEC	A
 1292 B522  20 FD       	JR	NZ,M9DC6
 1293 B524  18 C0       	JR	M9D8B
 1294                   
 1295 B526  EB          M9DCB:	EX	DE,HL
 1296 B527  3E 02       	LD	A,2
 1297 B529  CD B5C1     	CALL	M9E6A
 1298 B52C  18 AA       	JR	M9D7D
 1299                   
 1300 B52E              M9DD3:	; HL = 0268 oder 0273
 1301 B52E  34          	INC	(HL)		; Low+1
 1302 B52F  7E          	LD	A,(HL)		; vorbereitete Ausgabedaten zu Port
 1303 B530  23          	INC	HL
 1304 B531  20 03       	JR	NZ,M9DDB
 1305 B533  34          	INC	(HL)		; High+1
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  34
PL41XX  Z80

 1306 B534  28 25       	JR	Z,M9E04		; 0000H erreicht
 1307 B536  0F          M9DDB:	RRCA		; 7 -> 0
 1308 B537  D0          	RET	NC	;	Bit 0 = 0
 1309 B538  0F          	RRCA		; 7 -> 0
 1310 B539  D0          	RET	NC	;	Bit 1 = 0
 1311 B53A  23          	INC	HL
 1312 B53B  D5          	PUSH	DE
 1313 B53C  5E          	LD	E,(HL)
 1314 B53D  23          	INC	HL
 1315 B53E  56          	LD	D,(HL)
 1316 B53F  23          	INC	HL
 1317 B540  D5          	PUSH	DE
 1318 B541  E5          	PUSH	HL
 1319 B542  EB          	EX	DE,HL
 1320 B543  5E          	LD	E,(HL)
 1321 B544  23          	INC	HL
 1322 B545  56          	LD	D,(HL)
 1323 B546  21 B54B     	LD	HL,M9DF0	; danach hier weiter
 1324 B549  E3          	EX	(SP),HL		; als RET-Adresse auf den Stack legen
 1325 B54A  E9          	JP	(HL)		; und HL anspringen
 1326                   
 1327 B54B              M9DF0:	; Ausgabedaten in A
 1328 B54B  E1          	POP	HL
 1329 B54C  73          	LD	(HL),E
 1330 B54D  23          	INC	HL
 1331 B54E  72          	LD	(HL),D
 1332 B54F  D1          	POP	DE
 1333 B550              M9DF5:	; Ausgabedaten in A
 1334 B550  C5          	PUSH	BC
 1335                   ;	LD	B,A	; auszugebender Wert
 1336                   ;	LD	A,(PL_PORT)	; Port fuer Plotteranschluss
 1337                   ;	LD	C,A
 1338                   ;	LD	A,B	; auszugebender Wert mit (/STEP=0)
 1339 B551  0E 05       	LD	C,PIOB		; Datenport M001-PIO B
 1340 B553  ED 79       	OUT	(C),A	; -> Plotter
 1341                   ;	OR	4	; Bit 2 setzen (/STEP=1)	KC87
 1342 B555  F6 01       	OR	1	; Bit 0 setzen (/STEP=1)	KC85
 1343 B557  ED 79       	OUT	(C),A	; -> Plotter
 1344 B559  C1          	POP	BC
 1345 B55A  C9          	RET
 1346                   
 1347 B55B              M9E04:	; 0000H erreicht, z.B. bei GCLS oder HOME
 1348 B55B  D1          	POP	DE
 1349 B55C  D1          	POP	DE
 1350 B55D  FB          	EI
 1351 B55E  3A 0254     	LD	A,(UN0254)
 1352 B561  A7          	AND	A	; out of range?
 1353 B562  3E 80       	LD	A,80H
 1354 B564  28 01       	JR	Z,M9E10
 1355 B566  AF          	XOR	A
 1356 B567  32 024B     M9E10:	LD	(UN024B),A
 1357 B56A  21 0300     	LD	HL,768	; Zeitkonstante zum Warten, wenn Position erreicht ist
 1358 B56D  C3 B650     	JP	WARTE	; warten
 1359                   
 1360 B570  21 0262     M9E19:	LD	HL,UN0262
 1361 B573  F5          	PUSH	AF
 1362 B574  7E          	LD	A,(HL)
 1363 B575  CD 027B     	CALL	UN027B	; DEC A oder INC A
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  35
PL41XX  Z80

 1364 B578  28 01       	JR	Z,M9E24
 1365 B57A  77          	LD	(HL),A
 1366 B57B  F1          M9E24:	POP	AF
 1367 B57C  C9          	RET
 1368                   
 1369                   ; PE:	HL	neue relative Position
 1370                   ;	DE	aktuelle Position
 1371                   ;	BC	- Grenzwert Schritte
 1372                   ; PA:	A=0	OK
 1373                   ;	A=1	out of range
 1374 B57D  D5          M9E26:	PUSH	DE
 1375 B57E  5E          	LD	E,(HL)	; Wert der Koordinate lesen
 1376 B57F  23          	INC	HL
 1377 B580  56          	LD	D,(HL)
 1378 B581  E1          	POP	HL
 1379 B582  CD B5B8     	CALL	M9E61	; HL negieren
 1380 B585  19          	ADD	HL,DE
 1381 B586  CD B5B5     	CALL	M9E5E
 1382 B589  E5          	PUSH	HL
 1383                   ;	LD	HL,1301H	; 13H = INC DE / 01 = V/R=1	KC87
 1384 B58A  21 1304     	LD	HL,1304H	; 13H = INC DE / 01 = V/R=1	KC85
 1385 B58D  F2 B593     	JP	P,M9E3C
 1386 B590  21 1B00     	LD	HL,1B00H	; 1BH = DEC DE / 00 = V/R=0
 1387 B593  E3          M9E3C:	EX	(SP),HL
 1388 B594  7A          	LD	A,D
 1389 B595  A7          	AND	A
 1390 B596  EB          	EX	DE,HL
 1391 B597  FA B5A0     	JP	M,M9E49
 1392 B59A  09          	ADD	HL,BC
 1393 B59B  30 14       	JR	NC,M9E5A
 1394 B59D  CD B5B8     	CALL	M9E61	; HL negieren
 1395 B5A0  19          M9E49:	ADD	HL,DE
 1396 B5A1  CD B5B8     M9E4A:	CALL	M9E61	; HL negieren
 1397 B5A4  E5          	PUSH	HL
 1398 B5A5  19          	ADD	HL,DE
 1399 B5A6  7D          	LD	A,L
 1400 B5A7  B4          	OR	H
 1401 B5A8  E1          	POP	HL
 1402 B5A9  29          	ADD	HL,HL
 1403 B5AA  29          	ADD	HL,HL
 1404 B5AB  2B          	DEC	HL
 1405 B5AC  C1          	POP	BC
 1406 B5AD  C8          	RET	Z	; A=0 OK
 1407 B5AE  3E 01       	LD	A,1	; A=1 ausserhalb
 1408 B5B0  C9          	RET
 1409                   		
 1410 B5B1  62          M9E5A:	LD	H,D
 1411 B5B2  6B          	LD	L,E
 1412 B5B3  18 EC       	JR	M9E4A
 1413                   
 1414 B5B5  7C          M9E5E:	LD	A,H
 1415 B5B6  A7          	AND	A
 1416 B5B7  F0          	RET	P
 1417 B5B8              M9E61:	; HL = -HL
 1418 B5B8  F5          	PUSH	AF
 1419 B5B9  AF          	XOR	A	; 0
 1420 B5BA  95          	SUB	L	; 0 - L
 1421 B5BB  6F          	LD	L,A	; L = 0 - L
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  36
PL41XX  Z80

 1422 B5BC  9F          	SBC	A,A	; A = -1 bei Uebertrag, sonst 0
 1423 B5BD  94          	SUB	H	; A - H
 1424 B5BE  67          	LD	H,A
 1425 B5BF  F1          	POP	AF
 1426 B5C0  C9          	RET
 1427                   
 1428                   ; PE:	A	2, 5, 6, 10
 1429                   ;	H
 1430 B5C1  C5          M9E6A:	PUSH	BC
 1431 B5C2  D5          	PUSH	DE
 1432 B5C3  4F          	LD	C,A
 1433 B5C4  CD B5B5     	CALL	M9E5E
 1434 B5C7  79          	LD	A,C
 1435 B5C8  F5          	PUSH	AF
 1436 B5C9  11 0000     	LD	DE,0
 1437 B5CC  06 08       	LD	B,8
 1438 B5CE  7C          M9E77:	LD	A,H
 1439 B5CF  91          	SUB	C
 1440 B5D0  38 04       	JR	C,M9E7F
 1441 B5D2  13          	INC	DE
 1442 B5D3  67          	LD	H,A
 1443 B5D4  18 F8       	JR	M9E77
 1444                   	;
 1445 B5D6  29          M9E7F:	ADD	HL,HL
 1446 B5D7  EB          	EX	DE,HL
 1447 B5D8  29          	ADD	HL,HL
 1448 B5D9  EB          	EX	DE,HL
 1449 B5DA  05          	DEC	B
 1450 B5DB  20 F1       	JR	NZ,M9E77
 1451 B5DD  7C          	LD	A,H
 1452 B5DE  91          	SUB	C
 1453 B5DF  38 02       	JR	C,M9E8C
 1454 B5E1  13          	INC	DE
 1455 B5E2  67          	LD	H,A
 1456 B5E3  7C          M9E8C:	LD	A,H
 1457 B5E4  87          	ADD	A,A
 1458 B5E5  91          	SUB	C
 1459 B5E6  38 01       	JR	C,M9E92
 1460 B5E8  13          	INC	DE
 1461 B5E9  EB          M9E92:	EX	DE,HL
 1462 B5EA  18 1F       	JR	M9EB4
 1463                   
 1464 B5EC  C5          M9E95:	PUSH	BC
 1465 B5ED  D5          	PUSH	DE
 1466 B5EE  57          	LD	D,A
 1467 B5EF  AC          	XOR	H
 1468 B5F0  7A          	LD	A,D
 1469 B5F1  F5          	PUSH	AF
 1470 B5F2  CD B5B5     	CALL	M9E5E
 1471 B5F5  1E 00       	LD	E,0
 1472 B5F7  06 07       	LD	B,7
 1473 B5F9  EB          	EX	DE,HL
 1474 B5FA  CD B5B5     	CALL	M9E5E
 1475 B5FD  7C          	LD	A,H
 1476 B5FE  65          	LD	H,L
 1477 B5FF  87          M9EA8:	ADD	A,A
 1478 B600  30 01       	JR	NC,M9EAC
 1479 B602  19          	ADD	HL,DE
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  37
PL41XX  Z80

 1480 B603  29          M9EAC:	ADD	HL,HL
 1481 B604  05          	DEC	B
 1482 B605  20 F8       	JR	NZ,M9EA8
 1483 B607  87          	ADD	A,A
 1484 B608  30 01       	JR	NC,M9EB4
 1485 B60A  19          	ADD	HL,DE
 1486 B60B  F1          M9EB4:	POP	AF
 1487 B60C  FC B5B8     	CALL	M,M9E61	; HL negieren
 1488 B60F  D1          	POP	DE
 1489 B610  C1          	POP	BC
 1490 B611  C9          	RET
 1491                   
 1492 B612  1A          M9EBB:	LD	A,(DE)
 1493 B613  4E          	LD	C,(HL)
 1494 B614  EB          	EX	DE,HL
 1495 B615  71          	LD	(HL),C
 1496 B616  12          	LD	(DE),A
 1497 B617  23          	INC	HL
 1498 B618  13          	INC	DE
 1499 B619  10 F7       	DJNZ	M9EBB
 1500 B61B  C9          	RET
 1501                   
 1502 B61C  3A 024D     M9EC5:	LD	A,(UN024D)
 1503 B61F  21 3508     	LD	HL,3508H	; L=Schreibgeschwindigkeit 1CH -> 0AH
 1504 B622  F5          	PUSH	AF
 1505 B623  3A 0254     	LD	A,(UN0254)
 1506 B626  A7          	AND	A	; out of range?
 1507 B627  28 03       	JR	Z,M9ED5
 1508 B629  21 018F     	LD	HL,018FH
 1509 B62C  22 0261     M9ED5:	LD	(UN0261),HL
 1510 B62F  4D          	LD	C,L
 1511 B630  26 00       	LD	H,0
 1512 B632  29          	ADD	HL,HL
 1513 B633  3E 05       	LD	A,5
 1514 B635  CD B5C1     	CALL	M9E6A
 1515 B638  09          	ADD	HL,BC		; 0BH+1CH=27H (Original)
 1516 B639  7D          	LD	A,L
 1517 B63A  32 0260     	LD	(UN0260),A	; Zeitkonstante fuer Schreibgeschwindigkeit
 1518 B63D  F1          	POP	AF
 1519                   
 1520                   ; Ausgabe des Datenbytes zum Plotter
 1521                   ; PE:	A	Datenbyte
 1522                   ;	0=Stift oben / 80H = Stift unten
 1523 B63E  C5          M9EE7:	PUSH	BC
 1524                   ;	LD	BC,(PL_PORT)	; C=Port fuer Plotteranschluss
 1525 B63F  21 024E     	LD	HL,UN024E	; letztes Datenbyte
 1526 B642  46          	LD	B,(HL)		; B=letztes Datenbyte
 1527 B643  77          	LD	(HL),A		; neues Datenbyte eintragen
 1528 B644  2B          	DEC	HL		; HL=UN024D
 1529 B645  77          	LD	(HL),A		; Kopie?
 1530 B646  0E 05       	LD	C,PIOB		; Datenport M001-PIO B
 1531 B648  ED 79       	OUT	(C),A		; Datenbyte -> Plotter
 1532 B64A  A8          	XOR	B		; Vergleich alt / neu (Stift Heben/Senken?)
 1533 B64B  C1          	POP	BC
 1534 B64C  C8          	RET	Z		; gleicher Inhalt, nicht warten
 1535 B64D  21 2EE0     	LD	HL,12000	; Zeitkonstante nach Stift heben/senken (Original 2048)
 1536 B650  2B          WARTE:	DEC	HL		; Zeitschleife
 1537 B651  7C          	LD	A,H
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  38
PL41XX  Z80

 1538 B652  B5          	OR	L
 1539 B653  20 FB       	JR	NZ,WARTE	; warten
 1540 B655  C9          	RET
 1541                   
 1542 B656              M9F01:	; Test, ob Plotter bereit ist, sonst ?PO ERROR
 1543 B656  C5          	PUSH	BC
 1544 B657  D5          	PUSH	DE
 1545 B658  CD B675     	CALL	M9F24		; PIO Initialisieren
 1546 B65B  28 15       	JR	Z,M9F21		; Plotter bereit
 1547 B65D  CD B69C     	CALL	M9F51		; mit TimeOut warten
 1548 B660  28 10       	JR	Z,M9F21		; Plotter jetzt bereit
 1549 B662  21 B756     	LD	HL,MA00B	; "?PO"
 1550 B665  CD D1C9     	CALL	TEXTO	; Text in (HL) ausgeben
 1551                   ;	LD	A,0E2H	; RAND, cyan auf gruen, Grafik aus
 1552                   ;	OUT	(0B8H),A	; KC87 Grafikzusatz
 1553 B668  AF          	XOR	A
 1554 B669  32 035A     	LD	(WINJP),A
 1555 B66C  32 0267     	LD	(INITM),A	; INIT-Merker zuruecksetzen
 1556 B66F  C3 C69C     	JP	IOTEST1		; ERROR anzeigen, dann zu BASIC
 1557                   			;
 1558 B672  D1          M9F21:	POP	DE
 1559 B673  C1          	POP	BC
 1560 B674  C9          	RET
 1561                   
 1562 B675              M9F24:	; PIO initialisieren, Ready abfragen
 1563 B675  3A 0267     	LD	A,(INITM)	; INIT-Merker?
 1564 B678  FE CF       	CP	0CFH		; PIO bereits initialisiert?
 1565 B67A  28 10       	JR	Z,M9F3F		; ja, nicht noch einmal
 1566 B67C  CD B6E3     	CALL	M9F98		; UN0234 bis UN027C vorbelegen 
 1567                   ;	LD	A,(PL_PORT)	; Portadresse Daten
 1568                   ;	INC	A
 1569                   ;	INC	A		; Steuerwort
 1570                   ;	LD	C,A
 1571 B67F  0E 07       	LD	C,PIOB+2	; Steuerport M001-PIO B
 1572 B681  3E CF       	LD	A,0CFH		; PIO Bitbetrieb
 1573 B683  ED 79       	OUT	(C),A		; PIO initialisieren
 1574 B685  32 0267     	LD	(INITM),A	; PIO-Betriebsart merken
 1575 B688  3E 20       	LD	A,20H		; Bit 5=Eingang
 1576 B68A  ED 79       	OUT	(C),A		; I/O festlegen
 1577 B68C              M9F3F:	;LD	A,(PL_PORT)	; Port fuer Plotteranschluss
 1578                   ;	LD	C,A
 1579 B68C  3A 024E     	LD	A,(UN024E)	; 00H
 1580 B68F  0E 05       	LD	C,PIOB		; Datenport M001-PIO B
 1581 B691  ED 79       	OUT	(C),A		; Ready ruecksetzen
 1582 B693  F6 40       	OR	40H		; Bit 6 setzen (/READY=1)
 1583 B695  ED 79       	OUT	(C),A		; wieder normal
 1584 B697  ED 78       	IN	A,(C)
 1585 B699  E6 20       	AND	20H		; Ready?
 1586 B69B  C9          	RET
 1587                   
 1588 B69C  21 07D0     M9F51:	LD	HL,2000		; Zeitkonstante TiemeOut
 1589 B69F  AF          	XOR	A
 1590 B6A0  32 024E     	LD	(UN024E),A	; Datenwert initialisieren mit 0
 1591 B6A3  3E 00       M9F58:	LD	A,0		; V/R=0, X/Y=0, STEP=0, PEN=0
 1592 B6A5  CD B6C8     	CALL	M9F7D		; zu Plotter
 1593 B6A8  CD B675     	CALL	M9F24		; PIO initialisieren
 1594 B6AB  28 07       	JR	Z,M9F69		; Plotter bereit
 1595 B6AD  2B          	DEC	HL		; Zaehler
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  39
PL41XX  Z80

 1596 B6AE  7C          	LD	A,H
 1597 B6AF  B5          	OR	L
 1598 B6B0  20 F1       	JR	NZ,M9F58	; abwarten
 1599 B6B2  3C          	INC	A		; Z=0
 1600 B6B3  C9          	RET
 1601                   
 1602 B6B4  21 0000     M9F69:	LD	HL,0
 1603 B6B7  22 0245     	LD	(POSX),HL
 1604 B6BA  22 0247     	LD	(POSY),HL
 1605 B6BD  0E 0F       	LD	C,15		; 15x V/R=1 setzen
 1606                   ;M9F74:	LD	A,1		; V/R=1, X/Y=0, STEP=0, PEN=0	KC87
 1607 B6BF  3E 04       M9F74:	LD	A,4		; V/R=1, X/Y=0, STEP=0, PEN=0	KC85
 1608 B6C1  CD B6C8     	CALL	M9F7D		; zu Plotter
 1609 B6C4  0D          	DEC	C
 1610 B6C5  20 F8       	JR	NZ,M9F74
 1611 B6C7  C9          	RET
 1612                   
 1613 B6C8              M9F7D:	; Ausgabedaten in A
 1614 B6C8  06 FF       	LD	B,255		; Zeitkonstante fuer Wartezeit
 1615 B6CA  CD B550     	CALL	M9DF5		; Wert (A) zu Plotter
 1616 B6CD  10 FE       M9F82:	DJNZ	M9F82		; kurz warten
 1617 B6CF  C9          	RET
 1618                   
 1619 B6D0              M9F85:	; wird nach UN026A kopiert und dort abgearbeitet
 1620 B6D0  45          	LD	B,L
 1621 B6D1  02          	LD	(BC),A
 1622 B6D2  3E 03       	LD	A,3		; X/Y=1, V/R=1
 1623 B6D4  13          	INC	DE
 1624 B6D5  CD B570     	CALL	M9E19
 1625 B6D8  C9          	RET
 1626                   	; 0273H
 1627 B6D9  00          	NOP
 1628 B6DA  00          	NOP
 1629                   	; wird nach 0275H kopiert und dort abgearbeitet
 1630 B6DB  47          	LD	B,A
 1631 B6DC  02          	LD	(BC),A
 1632 B6DD  3E 01       	LD	A,1		; X/Y=0, V/R=1
 1633 B6DF  13          	INC	DE
 1634 B6E0  C9          	RET
 1635                   	; 027BH
 1636 B6E1  3D          	DEC	A
 1637 B6E2  C9          	RET
 1638                   
 1639                   	; UP zu Initialisierung E/A-Modul
 1640 B6E3  21 0234     M9F98:	LD	HL,UN0234
 1641 B6E6  36 00       	LD	(HL),0
 1642 B6E8  54          	LD	D,H
 1643 B6E9  5D          	LD	E,L
 1644 B6EA  13          	INC	DE
 1645 B6EB  01 0034     	LD	BC,34H
 1646 B6EE  ED B0       	LDIR		; UN0234-UN0268 loeschen
 1647 B6F0  21 5859     	LD	HL,'XY'
 1648 B6F3  22 0234     	LD	(UN0234),HL
 1649 B6F6  3E 18       	LD	A,18H
 1650 B6F8  32 0239     	LD	(UN0239),A
 1651 B6FB  3E 28       	LD	A,28H
 1652 B6FD  32 023F     	LD	(UN023F),A
 1653 B700  3E 80       	LD	A,80H
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  40
PL41XX  Z80

 1654 B702  32 024B     	LD	(UN024B),A
 1655 B705  3E EE       	LD	A,0EEH
 1656 B707  32 024F     	LD	(UN024F),A
 1657 B70A  3E C9       	LD	A,0C9H		; RET
 1658 B70C  32 027C     	LD	(UN027C),A
 1659                   ;	LD	A,(0200H)
 1660                   ;	LD	(UN0260),A	; Schreibgeschwindigkeit
 1661 B70F  C9          	RET
 1662                   
 1663                   	; Tabelle, Bedeutung noch unklar, 54 Byte
 1664 B710  01          M9FC5:	db	1	;
 1665 B711  02          	db	2	;
 1666 B712  02          	db	2	;
 1667 B713  03          	db	3	;
 1668 B714  03          	db	3	;
 1669 B715  04          	db	4	;
 1670 B716  04          	db	4	;
 1671 B717  05          	db	5	;
 1672 B718  05          	db	5	;
 1673 B719  06          	db	6	;
 1674 B71A  07          	db	7	;
 1675 B71B  08          	db	8	;
 1676 B71C  09          	db	9	;
 1677 B71D  0A          	db	0Ah	;
 1678 B71E  0B          	db	0Bh	;
 1679 B71F  0C          	db	0Ch	;
 1680 B720  0D          	db	0Dh	;
 1681 B721  0E          	db	0Eh	;
 1682 B722  0F          	db	0Fh	;
 1683 B723  10          	db	10h	;
 1684 B724  11          	db	11h	;
 1685 B725  12          	db	12h	;
 1686 B726  13          	db	13h	;
 1687 B727  14          	db	14h	;
 1688 B728  15          	db	15h	;
 1689 B729  16          	db	16h	;
 1690 B72A  18          	db	18h	;
 1691 B72B  1A          	db	1Ah	;
 1692 B72C  1C          	db	1Ch	;
 1693 B72D  1E          	db	1Eh	;
 1694 B72E  20          	db	20h	;
 1695 B72F  22          	db	22h	; "
 1696 B730  24          	db	24h	; $
 1697 B731  26          	db	26h	; &
 1698 B732  28          	db	28h	; (
 1699 B733  2A          	db	2Ah	; *
 1700 B734  2C          	db	2Ch	; ,
 1701 B735  30          	db	30h	; 0
 1702 B736  32          	db	32h	; 2
 1703 B737  34          	db	34h	; 4
 1704 B738  38          	db	38h	; 8
 1705 B739  3C          	db	3Ch	; <
 1706 B73A  40          	db	40h	; @
 1707 B73B  44          	db	44h	; D
 1708 B73C  48          	db	48h	; H
 1709 B73D  4C          	db	4Ch	; L
 1710 B73E  50          	db	50h	; P
 1711 B73F  54          	db	54h	; T
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  41
PL41XX  Z80

 1712 B740  58          	db	58h	; X
 1713 B741  5C          	db	5Ch
 1714 B742  60          	db	60h	; `
 1715 B743  64          	db	64h	; d
 1716 B744  6A          	db	6Ah	; j
 1717 B745  70          	db	70h	; p
 1718                   
 1719 B746  20 4F 55 54 M9FFB:	DB	' OUT OF RANGE',0DH,0AH,0
 1720                   
 1721 B756  3F 50 4F 00 MA00B:	DB	'?PO',0
 1722                   
 1723 B75A  61 6F 75    UMLTAB:	DB	'aou'	; Tabelle der Umlaute
 1724                   
 1725                   ; 104 Zeichen (18h-7Fh)
 1726                   ; speziell: 7Fh => n
 1727                   ;	0Dh => neue Zeile
 1728                   ;	18h + naechstes Zeichen => Umlaut
 1729                   ;	19h..1Fh Polygonzug-Sonderzeichen
 1730                   
 1731 B75D              LBLTAB:
 1732                   ; Zeichen
 1733 B75D  09          	db 00001001b		; hintere 4 Bit = Laenge des Zeichens
 1734 B75E  25          	db 00100101b
 1735 B75F  C5          	db 11000101b
 1736 B760  E6          	db 11100110b
 1737 B761  E8          	db 11101000b
 1738 B762  CA          	db 11001010b
 1739 B763  AA          	db 10101010b
 1740 B764  88          	db 10001000b
 1741 B765  86          	db 10000110b
 1742 B766  A5          	db 10100101b
 1743                   ; Zeichen
 1744 B767  09          	db 00001001b
 1745 B768  65          	db 01100101b
 1746 B769  E9          	db 11101001b
 1747 B76A  CA          	db 11001010b
 1748 B76B  AA          	db 10101010b
 1749 B76C  89          	db 10001001b
 1750 B76D  81          	db 10000001b
 1751 B76E  A0          	db 10100000b
 1752 B76F  C0          	db 11000000b
 1753 B770  E1          	db 11100001b
 1754                   ; Zeichen
 1755 B771  15          	db 00010101b
 1756 B772  15          	db 00010101b
 1757 B773  A6          	db 10100110b
 1758 B774  C6          	db 11000110b
 1759 B775  D5          	db 11010101b
 1760 B776  D0          	db 11010000b
 1761                   ; Zeichen
 1762 B777  17          	db 00010111b
 1763 B778  10          	db 00010000b
 1764 B779  C0          	db 11000000b
 1765 B77A  D1          	db 11010001b
 1766 B77B  D5          	db 11010101b
 1767 B77C  C6          	db 11000110b
 1768 B77D  A6          	db 10100110b
 1769 B77E  95          	db 10010101b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  42
PL41XX  Z80

 1770                   ; Zeichen
 1771 B77F  0B          	db 00001011b
 1772 B780  17          	db 00010111b
 1773 B781  88          	db 10001000b
 1774 B782  89          	db 10001001b
 1775 B783  9A          	db 10011010b
 1776 B784  AA          	db 10101010b
 1777 B785  B9          	db 10111001b
 1778 B786  B8          	db 10111000b
 1779 B787  A7          	db 10100111b
 1780 B788  97          	db 10010111b
 1781 B789  00          	db 00000000b
 1782 B78A  EA          	db 11101010b
 1783                   ; Zeichen
 1784 B78B  04          	db 00000100b
 1785 B78C  20          	db 00100000b
 1786 B78D  AA          	db 10101010b
 1787 B78E  4A          	db 01001010b
 1788 B78F  C0          	db 11000000b
 1789                   ; Zeichen
 1790 B790  12          	db 00010010b
 1791 B791  3A          	db 00111010b
 1792 B792  B0          	db 10110000b
 1793                   ; Zeichen
 1794 B793  04          	db 00000100b
 1795 B794  2C          	db 00101100b
 1796 B795  AD          	db 10101101b
 1797 B796  4D          	db 01001101b
 1798 B797  CC          	db 11001100b
 1799                   ; Zeichen
 1800 B798  65          	db 01100101b
 1801 B799  01          	db 00000001b
 1802 B79A  E1          	db 11100001b
 1803 B79B  E7          	db 11100111b
 1804 B79C  87          	db 10000111b
 1805 B79D  81          	db 10000001b
 1806                   ; Zeichen
 1807 B79E  65          	db 01100101b
 1808 B79F  31          	db 00110001b
 1809 B7A0  E4          	db 11100100b
 1810 B7A1  B7          	db 10110111b
 1811 B7A2  84          	db 10000100b
 1812 B7A3  B1          	db 10110001b
 1813                   ; Zeichen
 1814 B7A4  64          	db 01100100b
 1815 B7A5  02          	db 00000010b
 1816 B7A6  E2          	db 11100010b
 1817 B7A7  B7          	db 10110111b
 1818 B7A8  82          	db 10000010b
 1819                   ; Zeichen
 1820 B7A9  64          	db 01100100b
 1821 B7AA  06          	db 00000110b
 1822 B7AB  B1          	db 10110001b
 1823 B7AC  E6          	db 11100110b
 1824 B7AD  86          	db 10000110b
 1825                   ; Zeichen
 1826 B7AE  64          	db 01100100b
 1827 B7AF  04          	db 00000100b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  43
PL41XX  Z80

 1828 B7B0  E4          	db 11100100b
 1829 B7B1  37          	db 00110111b
 1830 B7B2  B1          	db 10110001b
 1831                   ; Zeichen
 1832 B7B3  64          	db 01100100b
 1833 B7B4  01          	db 00000001b
 1834 B7B5  E7          	db 11100111b
 1835 B7B6  07          	db 00000111b
 1836 B7B7  E1          	db 11100001b
 1837                   ; Zeichen
 1838 B7B8  66          	db 01100110b
 1839 B7B9  31          	db 00110001b
 1840 B7BA  B7          	db 10110111b
 1841 B7BB  66          	db 01100110b
 1842 B7BC  82          	db 10000010b
 1843 B7BD  06          	db 00000110b
 1844 B7BE  E2          	db 11100010b
 1845                   ; Zeichen
 1846 B7BF  00          	db 00000000b
 1847                   ; Zeichen
 1848 B7C0  14          	db 00010100b
 1849 B7C1  3A          	db 00111010b
 1850 B7C2  B3          	db 10110011b
 1851 B7C3  31          	db 00110001b
 1852 B7C4  B0          	db 10110000b
 1853                   ; Zeichen
 1854 B7C5  04          	db 00000100b
 1855 B7C6  27          	db 00100111b
 1856 B7C7  AA          	db 10101010b
 1857 B7C8  4A          	db 01001010b
 1858 B7C9  C7          	db 11000111b
 1859 B7CA  84          	db 10000100b
 1860 B7CB  17          	db 00010111b
 1861 B7CC  D7          	db 11010111b
 1862 B7CD  53          	db 01010011b
 1863 B7CE  93          	db 10010011b
 1864 B7CF  16          	db 00010110b
 1865 B7D0  8A          	db 10001010b
 1866 B7D1  67          	db 01100111b
 1867 B7D2  D9          	db 11011001b
 1868 B7D3  A9          	db 10101001b
 1869 B7D4  87          	db 10000111b
 1870 B7D5  86          	db 10000110b
 1871 B7D6  E4          	db 11100100b
 1872 B7D7  E3          	db 11100011b
 1873 B7D8  C1          	db 11000001b
 1874 B7D9  91          	db 10010001b
 1875 B7DA  83          	db 10000011b
 1876 B7DB  16          	db 00010110b
 1877 B7DC  89          	db 10001001b
 1878 B7DD  40          	db 01000000b
 1879 B7DE  B1          	db 10110001b
 1880 B7DF  B2          	db 10110010b
 1881 B7E0  C3          	db 11000011b
 1882 B7E1  D3          	db 11010011b
 1883 B7E2  E2          	db 11100010b
 1884 B7E3  E1          	db 11100001b
 1885 B7E4  D0          	db 11010000b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  44
PL41XX  Z80

 1886 B7E5  C0          	db 11000000b
 1887 B7E6  15          	db 00010101b
 1888 B7E7  0B          	db 00001011b
 1889 B7E8  60          	db 01100000b
 1890 B7E9  98          	db 10011000b
 1891 B7EA  AA          	db 10101010b
 1892 B7EB  CA          	db 11001010b
 1893 B7EC  D8          	db 11011000b
 1894 B7ED  94          	db 10010100b
 1895 B7EE  91          	db 10010001b
 1896 B7EF  A0          	db 10100000b
 1897 B7F0  C0          	db 11000000b
 1898 B7F1  D4          	db 11010100b
 1899 B7F2  E4          	db 11100100b
 1900 B7F3  12          	db 00010010b
 1901 B7F4  3A          	db 00111010b
 1902 B7F5  B8          	db 10111000b
 1903 B7F6  08          	db 00001000b
 1904 B7F7  4A          	db 01001010b
 1905 B7F8  BA          	db 10111010b
 1906 B7F9  A9          	db 10101001b
 1907 B7FA  97          	db 10010111b
 1908 B7FB  93          	db 10010011b
 1909 B7FC  A1          	db 10100001b
 1910 B7FD  B0          	db 10110000b
 1911 B7FE  C0          	db 11000000b
 1912 B7FF  08          	db 00001000b
 1913 B800  2A          	db 00101010b
 1914 B801  BA          	db 10111010b
 1915 B802  C9          	db 11001001b
 1916 B803  D7          	db 11010111b
 1917 B804  D3          	db 11010011b
 1918 B805  C1          	db 11000001b
 1919 B806  B0          	db 10110000b
 1920 B807  A0          	db 10100000b
 1921 B808  84          	db 10000100b
 1922 B809  11          	db 00010001b
 1923 B80A  D7          	db 11010111b
 1924 B80B  17          	db 00010111b
 1925 B80C  D1          	db 11010001b
 1926 B80D  2D          	db 00101101b
 1927 B80E  82          	db 10000010b
 1928 B80F  31          	db 00110001b
 1929 B810  B7          	db 10110111b
 1930 B811  2D          	db 00101101b
 1931 B812  53          	db 01010011b
 1932 B813  36          	db 00110110b
 1933 B814  B4          	db 10110100b
 1934 B815  A3          	db 10100011b
 1935 B816  02          	db 00000010b
 1936 B817  04          	db 00000100b
 1937 B818  E4          	db 11100100b
 1938 B819  11          	db 00010001b
 1939 B81A  30          	db 00110000b
 1940 B81B  02          	db 00000010b
 1941 B81C  00          	db 00000000b
 1942 B81D  EA          	db 11101010b
 1943 B81E  82          	db 10000010b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  45
PL41XX  Z80

 1944 B81F  11          	db 00010001b
 1945 B820  D9          	db 11011001b
 1946 B821  4F          	db 01001111b
 1947 B822  03          	db 00000011b
 1948 B823  19          	db 00011001b
 1949 B824  DA          	db 11011010b
 1950 B825  D0          	db 11010000b
 1951 B826  08          	db 00001000b
 1952 B827  08          	db 00001000b
 1953 B828  9A          	db 10011010b
 1954 B829  CA          	db 11001010b
 1955 B82A  E8          	db 11101000b
 1956 B82B  E6          	db 11100110b
 1957 B82C  82          	db 10000010b
 1958 B82D  80          	db 10000000b
 1959 B82E  E0          	db 11100000b
 1960 B82F  0D          	db 00001101b
 1961 B830  02          	db 00000010b
 1962 B831  90          	db 10010000b
 1963 B832  C0          	db 11000000b
 1964 B833  E2          	db 11100010b
 1965 B834  E4          	db 11100100b
 1966 B835  C5          	db 11000101b
 1967 B836  A5          	db 10100101b
 1968 B837  C5          	db 11000101b
 1969 B838  E6          	db 11100110b
 1970 B839  E8          	db 11101000b
 1971 B83A  CA          	db 11001010b
 1972 B83B  9A          	db 10011010b
 1973 B83C  88          	db 10001000b
 1974 B83D  05          	db 00000101b
 1975 B83E  3A          	db 00111010b
 1976 B83F  83          	db 10000011b
 1977 B840  E3          	db 11100011b
 1978 B841  5A          	db 01011010b
 1979 B842  D0          	db 11010000b
 1980 B843  0A          	db 00001010b
 1981 B844  6A          	db 01101010b
 1982 B845  9A          	db 10011010b
 1983 B846  85          	db 10000101b
 1984 B847  B6          	db 10110110b
 1985 B848  D6          	db 11010110b
 1986 B849  E4          	db 11100100b
 1987 B84A  E2          	db 11100010b
 1988 B84B  C0          	db 11000000b
 1989 B84C  90          	db 10010000b
 1990 B84D  82          	db 10000010b
 1991 B84E  0C          	db 00001100b
 1992 B84F  68          	db 01101000b
 1993 B850  DA          	db 11011010b
 1994 B851  AA          	db 10101010b
 1995 B852  88          	db 10001000b
 1996 B853  82          	db 10000010b
 1997 B854  A0          	db 10100000b
 1998 B855  D0          	db 11010000b
 1999 B856  E2          	db 11100010b
 2000 B857  E4          	db 11100100b
 2001 B858  D6          	db 11010110b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  46
PL41XX  Z80

 2002 B859  A6          	db 10100110b
 2003 B85A  84          	db 10000100b
 2004 B85B  03          	db 00000011b
 2005 B85C  0A          	db 00001010b
 2006 B85D  EA          	db 11101010b
 2007 B85E  90          	db 10010000b
 2008 B85F  87          	db 10000111b
 2009 B860  45          	db 01000101b
 2010 B861  E4          	db 11100100b
 2011 B862  E2          	db 11100010b
 2012 B863  C0          	db 11000000b
 2013 B864  A0          	db 10100000b
 2014 B865  82          	db 10000010b
 2015 B866  84          	db 10000100b
 2016 B867  91          	db 10010001b
 2017 B868  0C          	db 00001100b
 2018 B869  02          	db 00000010b
 2019 B86A  90          	db 10010000b
 2020 B86B  C0          	db 11000000b
 2021 B86C  E2          	db 11100010b
 2022 B86D  E8          	db 11101000b
 2023 B86E  CA          	db 11001010b
 2024 B86F  9A          	db 10011010b
 2025 B870  88          	db 10001000b
 2026 B871  86          	db 10000110b
 2027 B872  94          	db 10010100b
 2028 B873  C4          	db 11000100b
 2029 B874  E6          	db 11100110b
 2030 B875  12          	db 00010010b
 2031 B876  35          	db 00110101b
 2032 B877  32          	db 00110010b
 2033 B878  91          	db 10010001b
 2034 B879  34          	db 00110100b
 2035 B87A  2C          	db 00101100b
 2036 B87B  03          	db 00000011b
 2037 B87C  57          	db 01010111b
 2038 B87D  94          	db 10010100b
 2039 B87E  D1          	db 11010001b
 2040 B87F  04          	db 00000100b
 2041 B880  15          	db 00010101b
 2042 B881  D5          	db 11010101b
 2043 B882  53          	db 01010011b
 2044 B883  93          	db 10010011b
 2045 B884  03          	db 00000011b
 2046 B885  17          	db 00010111b
 2047 B886  D4          	db 11010100b
 2048 B887  91          	db 10010001b
 2049 B888  0A          	db 00001010b
 2050 B889  18          	db 00011000b
 2051 B88A  99          	db 10011001b
 2052 B88B  AA          	db 10101010b
 2053 B88C  CA          	db 11001010b
 2054 B88D  D9          	db 11011001b
 2055 B88E  D7          	db 11010111b
 2056 B88F  B5          	db 10110101b
 2057 B890  B3          	db 10110011b
 2058 B891  31          	db 00110001b
 2059 B892  B0          	db 10110000b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  47
PL41XX  Z80

 2060 B893  87          	db 10000111b
 2061 B894  43          	db 01000011b
 2062 B895  C7          	db 11000111b
 2063 B896  B7          	db 10110111b
 2064 B897  A6          	db 10100110b
 2065 B898  A4          	db 10100100b
 2066 B899  B3          	db 10110011b
 2067 B89A  D3          	db 11010011b
 2068 B89B  92          	db 10010010b
 2069 B89C  05          	db 00000101b
 2070 B89D  00          	db 00000000b
 2071 B89E  BA          	db 10111010b
 2072 B89F  E0          	db 11100000b
 2073 B8A0  13          	db 00010011b
 2074 B8A1  D3          	db 11010011b
 2075 B8A2  0C          	db 00001100b
 2076 B8A3  00          	db 00000000b
 2077 B8A4  8A          	db 10001010b
 2078 B8A5  CA          	db 11001010b
 2079 B8A6  E8          	db 11101000b
 2080 B8A7  E7          	db 11100111b
 2081 B8A8  C5          	db 11000101b
 2082 B8A9  85          	db 10000101b
 2083 B8AA  C5          	db 11000101b
 2084 B8AB  E4          	db 11100100b
 2085 B8AC  E2          	db 11100010b
 2086 B8AD  C0          	db 11000000b
 2087 B8AE  80          	db 10000000b
 2088 B8AF  08          	db 00001000b
 2089 B8B0  61          	db 01100001b
 2090 B8B1  C0          	db 11000000b
 2091 B8B2  A0          	db 10100000b
 2092 B8B3  82          	db 10000010b
 2093 B8B4  88          	db 10001000b
 2094 B8B5  AA          	db 10101010b
 2095 B8B6  CA          	db 11001010b
 2096 B8B7  E9          	db 11101001b
 2097 B8B8  07          	db 00000111b
 2098 B8B9  00          	db 00000000b
 2099 B8BA  8A          	db 10001010b
 2100 B8BB  CA          	db 11001010b
 2101 B8BC  E8          	db 11101000b
 2102 B8BD  E2          	db 11100010b
 2103 B8BE  C0          	db 11000000b
 2104 B8BF  80          	db 10000000b
 2105 B8C0  81          	db 10000001b
 2106 B8C1  60          	db 01100000b
 2107 B8C2  C6          	db 11000110b
 2108 B8C3  05          	db 00000101b
 2109 B8C4  00          	db 00000000b
 2110 B8C5  8A          	db 10001010b
 2111 B8C6  DA          	db 11011010b
 2112 B8C7  05          	db 00000101b
 2113 B8C8  D5          	db 11010101b
 2114 B8C9  09          	db 00001001b
 2115 B8CA  35          	db 00110101b
 2116 B8CB  E5          	db 11100101b
 2117 B8CC  E0          	db 11100000b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  48
PL41XX  Z80

 2118 B8CD  A0          	db 10100000b
 2119 B8CE  82          	db 10000010b
 2120 B8CF  88          	db 10001000b
 2121 B8D0  AA          	db 10101010b
 2122 B8D1  CA          	db 11001010b
 2123 B8D2  E9          	db 11101001b
 2124 B8D3  06          	db 00000110b
 2125 B8D4  00          	db 00000000b
 2126 B8D5  8A          	db 10001010b
 2127 B8D6  05          	db 00000101b
 2128 B8D7  E5          	db 11100101b
 2129 B8D8  6A          	db 01101010b
 2130 B8D9  E0          	db 11100000b
 2131 B8DA  94          	db 10010100b
 2132 B8DB  20          	db 00100000b
 2133 B8DC  C0          	db 11000000b
 2134 B8DD  2A          	db 00101010b
 2135 B8DE  CA          	db 11001010b
 2136 B8DF  17          	db 00010111b
 2137 B8E0  05          	db 00000101b
 2138 B8E1  02          	db 00000010b
 2139 B8E2  90          	db 10010000b
 2140 B8E3  C0          	db 11000000b
 2141 B8E4  E2          	db 11100010b
 2142 B8E5  EA          	db 11101010b
 2143 B8E6  05          	db 00000101b
 2144 B8E7  00          	db 00000000b
 2145 B8E8  8A          	db 10001010b
 2146 B8E9  5A          	db 01011010b
 2147 B8EA  85          	db 10000101b
 2148 B8EB  E0          	db 11100000b
 2149 B8EC  03          	db 00000011b
 2150 B8ED  0A          	db 00001010b
 2151 B8EE  80          	db 10000000b
 2152 B8EF  E0          	db 11100000b
 2153 B8F0  05          	db 00000101b
 2154 B8F1  00          	db 00000000b
 2155 B8F2  8A          	db 10001010b
 2156 B8F3  B5          	db 10110101b
 2157 B8F4  EA          	db 11101010b
 2158 B8F5  E0          	db 11100000b
 2159 B8F6  04          	db 00000100b
 2160 B8F7  00          	db 00000000b
 2161 B8F8  8A          	db 10001010b
 2162 B8F9  E0          	db 11100000b
 2163 B8FA  EA          	db 11101010b
 2164 B8FB  09          	db 00001001b
 2165 B8FC  40          	db 01000000b
 2166 B8FD  A0          	db 10100000b
 2167 B8FE  82          	db 10000010b
 2168 B8FF  88          	db 10001000b
 2169 B900  AA          	db 10101010b
 2170 B901  CA          	db 11001010b
 2171 B902  E8          	db 11101000b
 2172 B903  E2          	db 11100010b
 2173 B904  C0          	db 11000000b
 2174 B905  07          	db 00000111b
 2175 B906  00          	db 00000000b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  49
PL41XX  Z80

 2176 B907  8A          	db 10001010b
 2177 B908  CA          	db 11001010b
 2178 B909  E9          	db 11101001b
 2179 B90A  E6          	db 11100110b
 2180 B90B  C5          	db 11000101b
 2181 B90C  85          	db 10000101b
 2182 B90D  82          	db 10000010b
 2183 B90E  42          	db 01000010b
 2184 B90F  E0          	db 11100000b
 2185 B910  4F          	db 01001111b
 2186 B911  82          	db 10000010b
 2187 B912  45          	db 01000101b
 2188 B913  E0          	db 11100000b
 2189 B914  50          	db 01010000b
 2190 B915  0A          	db 00001010b
 2191 B916  02          	db 00000010b
 2192 B917  90          	db 10010000b
 2193 B918  C0          	db 11000000b
 2194 B919  E2          	db 11100010b
 2195 B91A  E4          	db 11100100b
 2196 B91B  86          	db 10000110b
 2197 B91C  88          	db 10001000b
 2198 B91D  AA          	db 10101010b
 2199 B91E  DA          	db 11011010b
 2200 B91F  E8          	db 11101000b
 2201 B920  04          	db 00000100b
 2202 B921  0A          	db 00001010b
 2203 B922  EA          	db 11101010b
 2204 B923  3A          	db 00111010b
 2205 B924  B0          	db 10110000b
 2206 B925  06          	db 00000110b
 2207 B926  0A          	db 00001010b
 2208 B927  82          	db 10000010b
 2209 B928  A0          	db 10100000b
 2210 B929  C0          	db 11000000b
 2211 B92A  E2          	db 11100010b
 2212 B92B  EA          	db 11101010b
 2213 B92C  03          	db 00000011b
 2214 B92D  0A          	db 00001010b
 2215 B92E  B0          	db 10110000b
 2216 B92F  EA          	db 11101010b
 2217 B930  05          	db 00000101b
 2218 B931  0A          	db 00001010b
 2219 B932  90          	db 10010000b
 2220 B933  B6          	db 10110110b
 2221 B934  D0          	db 11010000b
 2222 B935  EA          	db 11101010b
 2223 B936  82          	db 10000010b
 2224 B937  0A          	db 00001010b
 2225 B938  E0          	db 11100000b
 2226 B939  2F          	db 00101111b
 2227 B93A  05          	db 00000101b
 2228 B93B  0A          	db 00001010b
 2229 B93C  B5          	db 10110101b
 2230 B93D  EA          	db 11101010b
 2231 B93E  35          	db 00110101b
 2232 B93F  B0          	db 10110000b
 2233 B940  04          	db 00000100b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  50
PL41XX  Z80

 2234 B941  1A          	db 00011010b
 2235 B942  EA          	db 11101010b
 2236 B943  80          	db 10000000b
 2237 B944  E0          	db 11100000b
 2238 B945  04          	db 00000100b
 2239 B946  5A          	db 01011010b
 2240 B947  AA          	db 10101010b
 2241 B948  A0          	db 10100000b
 2242 B949  D0          	db 11010000b
 2243 B94A  02          	db 00000010b
 2244 B94B  0A          	db 00001010b
 2245 B94C  E0          	db 11100000b
 2246 B94D  04          	db 00000100b
 2247 B94E  1A          	db 00011010b
 2248 B94F  CA          	db 11001010b
 2249 B950  C0          	db 11000000b
 2250 B951  90          	db 10010000b
 2251 B952  03          	db 00000011b
 2252 B953  16          	db 00010110b
 2253 B954  B9          	db 10111001b
 2254 B955  D6          	db 11010110b
 2255 B956  02          	db 00000010b
 2256 B957  00          	db 00000000b
 2257 B958  E0          	db 11100000b
 2258 B959  12          	db 00010010b
 2259 B95A  3A          	db 00111010b
 2260 B95B  C8          	db 11001000b
 2261 B95C  1A          	db 00011010b
 2262 B95D  53          	db 01010011b
 2263 B95E  C4          	db 11000100b
 2264 B95F  A4          	db 10100100b
 2265 B960  93          	db 10010011b
 2266 B961  91          	db 10010001b
 2267 B962  A0          	db 10100000b
 2268 B963  D0          	db 11010000b
 2269 B964  D5          	db 11010101b
 2270 B965  C6          	db 11000110b
 2271 B966  96          	db 10010110b
 2272 B967  91          	db 10010001b
 2273 B968  1A          	db 00011010b
 2274 B969  94          	db 10010100b
 2275 B96A  17          	db 00010111b
 2276 B96B  55          	db 01010101b
 2277 B96C  C6          	db 11000110b
 2278 B96D  A6          	db 10100110b
 2279 B96E  95          	db 10010101b
 2280 B96F  91          	db 10010001b
 2281 B970  A0          	db 10100000b
 2282 B971  D0          	db 11010000b
 2283 B972  92          	db 10010010b
 2284 B973  50          	db 01010000b
 2285 B974  DA          	db 11011010b
 2286 B975  63          	db 01100011b
 2287 B976  92          	db 10010010b
 2288 B977  13          	db 00010011b
 2289 B978  D3          	db 11010011b
 2290 B979  E3          	db 11100011b
 2291 B97A  56          	db 01010110b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  51
PL41XX  Z80

 2292 B97B  1A          	db 00011010b
 2293 B97C  CA          	db 11001010b
 2294 B97D  4E          	db 01001110b
 2295 B97E  BE          	db 10111110b
 2296 B97F  AD          	db 10101101b
 2297 B980  A1          	db 10100001b
 2298 B981  D4          	db 11010100b
 2299 B982  11          	db 00010001b
 2300 B983  C1          	db 11000001b
 2301 B984  D3          	db 11010011b
 2302 B985  DA          	db 11011010b
 2303 B986  63          	db 01100011b
 2304 B987  92          	db 10010010b
 2305 B988  10          	db 00010000b
 2306 B989  9A          	db 10011010b
 2307 B98A  13          	db 00010011b
 2308 B98B  16          	db 00010110b
 2309 B98C  10          	db 00010000b
 2310 B98D  C0          	db 11000000b
 2311 B98E  30          	db 00110000b
 2312 B98F  B6          	db 10110110b
 2313 B990  96          	db 10010110b
 2314 B991  38          	db 00111000b
 2315 B992  56          	db 01010110b
 2316 B993  11          	db 00010001b
 2317 B994  A1          	db 10100001b
 2318 B995  B3          	db 10110011b
 2319 B996  BA          	db 10111010b
 2320 B997  9A          	db 10011010b
 2321 B998  3C          	db 00111100b
 2322 B999  15          	db 00010101b
 2323 B99A  10          	db 00010000b
 2324 B99B  9A          	db 10011010b
 2325 B99C  56          	db 01010110b
 2326 B99D  93          	db 10010011b
 2327 B99E  D0          	db 11010000b
 2328 B99F  93          	db 10010011b
 2329 B9A0  10          	db 00010000b
 2330 B9A1  C0          	db 11000000b
 2331 B9A2  1A          	db 00011010b
 2332 B9A3  97          	db 10010111b
 2333 B9A4  0C          	db 00001100b
 2334 B9A5  00          	db 00000000b
 2335 B9A6  86          	db 10000110b
 2336 B9A7  05          	db 00000101b
 2337 B9A8  96          	db 10010110b
 2338 B9A9  A6          	db 10100110b
 2339 B9AA  B5          	db 10110101b
 2340 B9AB  B0          	db 10110000b
 2341 B9AC  35          	db 00110101b
 2342 B9AD  C6          	db 11000110b
 2343 B9AE  D6          	db 11010110b
 2344 B9AF  E5          	db 11100101b
 2345 B9B0  E0          	db 11100000b
 2346 B9B1  92          	db 10010010b
 2347 B9B2  10          	db 00010000b
 2348 B9B3  96          	db 10010110b
 2349 B9B4  13          	db 00010011b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  52
PL41XX  Z80

 2350 B9B5  19          	db 00011001b
 2351 B9B6  11          	db 00010001b
 2352 B9B7  95          	db 10010101b
 2353 B9B8  A6          	db 10100110b
 2354 B9B9  C6          	db 11000110b
 2355 B9BA  D5          	db 11010101b
 2356 B9BB  D1          	db 11010001b
 2357 B9BC  C0          	db 11000000b
 2358 B9BD  A0          	db 10100000b
 2359 B9BE  91          	db 10010001b
 2360 B9BF  D2          	db 11010010b
 2361 B9C0  11          	db 00010001b
 2362 B9C1  9A          	db 10011010b
 2363 B9C2  14          	db 00010100b
 2364 B9C3  D2          	db 11010010b
 2365 B9C4  51          	db 01010001b
 2366 B9C5  DA          	db 11011010b
 2367 B9C6  63          	db 01100011b
 2368 B9C7  15          	db 00010101b
 2369 B9C8  20          	db 00100000b
 2370 B9C9  A6          	db 10100110b
 2371 B9CA  25          	db 00100101b
 2372 B9CB  C6          	db 11000110b
 2373 B9CC  D5          	db 11010101b
 2374 B9CD  1A          	db 00011010b
 2375 B9CE  11          	db 00010001b
 2376 B9CF  A0          	db 10100000b
 2377 B9D0  C0          	db 11000000b
 2378 B9D1  D1          	db 11010001b
 2379 B9D2  D2          	db 11010010b
 2380 B9D3  94          	db 10010100b
 2381 B9D4  95          	db 10010101b
 2382 B9D5  A6          	db 10100110b
 2383 B9D6  C6          	db 11000110b
 2384 B9D7  D5          	db 11010101b
 2385 B9D8  16          	db 00010110b
 2386 B9D9  16          	db 00010110b
 2387 B9DA  C6          	db 11000110b
 2388 B9DB  28          	db 00101000b
 2389 B9DC  A1          	db 10100001b
 2390 B9DD  B0          	db 10110000b
 2391 B9DE  C0          	db 11000000b
 2392 B9DF  15          	db 00010101b
 2393 B9E0  16          	db 00010110b
 2394 B9E1  91          	db 10010001b
 2395 B9E2  A0          	db 10100000b
 2396 B9E3  D0          	db 11010000b
 2397 B9E4  D6          	db 11010110b
 2398 B9E5  13          	db 00010011b
 2399 B9E6  16          	db 00010110b
 2400 B9E7  B0          	db 10110000b
 2401 B9E8  D6          	db 11010110b
 2402 B9E9  05          	db 00000101b
 2403 B9EA  06          	db 00000110b
 2404 B9EB  90          	db 10010000b
 2405 B9EC  B4          	db 10110100b
 2406 B9ED  D0          	db 11010000b
 2407 B9EE  E6          	db 11100110b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  53
PL41XX  Z80

 2408 B9EF  14          	db 00010100b
 2409 B9F0  10          	db 00010000b
 2410 B9F1  D6          	db 11010110b
 2411 B9F2  16          	db 00010110b
 2412 B9F3  D0          	db 11010000b
 2413 B9F4  55          	db 01010101b
 2414 B9F5  11          	db 00010001b
 2415 B9F6  A1          	db 10100001b
 2416 B9F7  DA          	db 11011010b
 2417 B9F8  1A          	db 00011010b
 2418 B9F9  B4          	db 10110100b
 2419 B9FA  14          	db 00010100b
 2420 B9FB  16          	db 00010110b
 2421 B9FC  D6          	db 11010110b
 2422 B9FD  90          	db 10010000b
 2423 B9FE  D0          	db 11010000b
 2424 B9FF  09          	db 00001001b
 2425 BA00  5A          	db 01011010b
 2426 BA01  CA          	db 11001010b
 2427 BA02  B9          	db 10111001b
 2428 BA03  B6          	db 10110110b
 2429 BA04  95          	db 10010101b
 2430 BA05  B4          	db 10110100b
 2431 BA06  B1          	db 10110001b
 2432 BA07  C0          	db 11000000b
 2433 BA08  D0          	db 11010000b
 2434 BA09  14          	db 00010100b
 2435 BA0A  3A          	db 00111010b
 2436 BA0B  B7          	db 10110111b
 2437 BA0C  33          	db 00110011b
 2438 BA0D  B0          	db 10110000b
 2439 BA0E  09          	db 00001001b
 2440 BA0F  1A          	db 00011010b
 2441 BA10  AA          	db 10101010b
 2442 BA11  B9          	db 10111001b
 2443 BA12  B6          	db 10110110b
 2444 BA13  D5          	db 11010101b
 2445 BA14  B4          	db 10110100b
 2446 BA15  B1          	db 10110001b
 2447 BA16  A0          	db 10100000b
 2448 BA17  90          	db 10010000b
 2449 BA18  06          	db 00000110b
 2450 BA19  04          	db 00000100b
 2451 BA1A  95          	db 10010101b
 2452 BA1B  A5          	db 10100101b
 2453 BA1C  C3          	db 11000011b
 2454 BA1D  D3          	db 11010011b
 2455 BA1E  E4          	db 11100100b
 2456 BA1F  0C          	db 00001100b
 2457 BA20  10          	db 00010000b
 2458 BA21  99          	db 10011001b
 2459 BA22  AA          	db 10101010b
 2460 BA23  CA          	db 11001010b
 2461 BA24  D9          	db 11011001b
 2462 BA25  D7          	db 11010111b
 2463 BA26  B6          	db 10110110b
 2464 BA27  D5          	db 11010101b
 2465 BA28  E4          	db 11100100b
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  54
PL41XX  Z80

 2466 BA29  E2          	db 11100010b
 2467 BA2A  D1          	db 11010001b
 2468 BA2B  B0          	db 10110000b
 2469                   ; Ende der Zeichentabelle
 2470                   
 2471                   ; UP zu circle:
 2472 BA2C  E5          MA2E1:	PUSH	HL
 2473 BA2D  C5          	PUSH	BC
 2474 BA2E  CD D6DD     	CALL	OPKOP
 2475 BA31  C1          	POP	BC
 2476 BA32  11 0000     	LD	DE,0
 2477 BA35  21 03E8     	LD	HL,WRA1+3
 2478 BA38  7E          	LD	A,(HL)
 2479 BA39  B7          	OR	A
 2480 BA3A  CA BA74     	JP	Z,MA329
 2481 BA3D  2B          	DEC	HL
 2482 BA3E  7E          	LD	A,(HL)
 2483 BA3F  B7          	OR	A
 2484 BA40  F2 BA51     	JP	P,MA306
 2485 BA43  E6 7F       	AND	7FH
 2486 BA45  77          	LD	(HL),A
 2487 BA46  21 0285     	LD	HL,PARAM
 2488 BA49  7E          	LD	A,(HL)
 2489 BA4A  B1          	OR	C
 2490 BA4B  77          	LD	(HL),A
 2491 BA4C  E1          	POP	HL
 2492 BA4D  CD D6F7     	CALL	OPTRAN
 2493 BA50  E5          	PUSH	HL
 2494 BA51  01 7E22     MA306:	LD	BC,7E22H
 2495 BA54  11 F983     	LD	DE,0F983H
 2496 BA57  CD D59A     	CALL	MUL1
 2497 BA5A  21 03E8     	LD	HL,WRA1+3
 2498 BA5D  3E 81       	LD	A,81H
 2499 BA5F  BE          	CP	(HL)
 2500 BA60  DA C967     	JP	C,FCER
 2501 BA63  CD D6C8     	CALL	OPARST
 2502 BA66  AF          	XOR	A	; Dieser Code-Teil unterscheidet sich
 2503 BA67  06 08       	LD	B,8	; vom KC87, dort wird (7FF0h) benutzt 
 2504 BA69  CD D0B1     	CALL	FRE3
 2505 BA6C  C1          	POP	BC
 2506 BA6D  D1          	POP	DE
 2507 BA6E  CD D59A     	CALL	MUL1
 2508 BA71  CD C96F     	CALL	EPRVL3
 2509 BA74  E1          MA329:	POP	HL
 2510 BA75  C9          MA32B:	RET		; Hier landen alls Spruenge bei SCREEN 0 (Grafikbildschirm)
 2511                   
 2512                   ;*****************************************************************************
 2513                   ; BASIC-Interface
 2514                   ;*****************************************************************************
 2515                   
 2516                   ;-----------------------------------------------------------------------------
 2517                   ; PPSET (x,y)[,Farbe]	oder
 2518                   ; PPPSET STEP (X,Y)[,Farbe]
 2519                   ; Setzen eines Punktes
 2520                   ; Farbe:	0 Hintergrundfarbe (Loeschen)
 2521                   ;		1 Vordergrundfarbe (Standard: stift = 1)
 2522                   ;-----------------------------------------------------------------------------
 2523                   
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  55
PL41XX  Z80

 2524 BA76  7E          PPSET:	LD	A,(HL)	; naechstes Zeichen testen
 2525 BA77  FE AB       	CP	0ABH	; Token STEP?
 2526 BA79  06 FF       	LD	B,-1	; B=-1 Offset-Mode: relativ
 2527 BA7B  20 05       	JR	NZ,PSET1
 2528 BA7D  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2529 BA80  18 02       	JR	PSET2
 2530                   	;
 2531 BA82  06 01       PSET1:	LD	B,1	; B=1 Offset-Mode: absolut
 2532 BA84  11 0285     PSET2:	LD	DE,PARAM
 2533 BA87  D5          	PUSH	DE
 2534 BA88  78          	LD	A,B	; 1=absolut / -1=relativ
 2535 BA89  12          	LD	(DE),A	; Offset-Mode eintragen
 2536 BA8A  13          	INC	DE	; naechster Parameter
 2537 BA8B  CD BEA8     	CALL	POINT3	; Koordinaten (X,Y) ermitteln
 2538 BA8E  20 03       	JR	NZ,PSET3
 2539 BA90  3C          	INC	A
 2540 BA91  18 06       	JR	PSET4
 2541                   	;
 2542 BA93  CD C8D6     PSET3:	CALL	CPCOMM	; Komma?
 2543 BA96  CD BEE4     	CALL	MA7B2	; 0/1-Parameter holen
 2544 BA99  12          PSET4:	LD	(DE),A	; Farbe bzw. Stiftmode
 2545 BA9A  D1          	POP	DE
 2546 BA9B  0E 01       	LD	C,1	; Funktion 1
 2547 BA9D  C3 AF68     	JP	PLSV	; ueber Sprungverteiler aufrufen
 2548                   
 2549                   ;-----------------------------------------------------------------------------
 2550                   ; PLINE [(x1,y1)]-(x2,y2)[,[Farbe][,B[F]]]
 2551                   ; Zeichnen von Linie oder Rechteck
 2552                   ; Farbe:	0 Hintergrundfarbe (Loeschen)
 2553                   ;		1 Vordergrundfarbe (Standard: stift = 1)
 2554                   ; B - Zeichnen eines Rechteckes (box)
 2555                   ;-----------------------------------------------------------------------------
 2556                   
 2557 BAA0  06 01       PLINE:	LD	B,1
 2558 BAA2  7E          	LD	A,(HL)	; naechstes Zeichen testen
 2559 BAA3  FE AD       	CP	0ADH	; Token "-"?
 2560 BAA5  28 05       	JR	Z,LINE1
 2561 BAA7  FE AB       	CP	0ABH	; Token STEP?
 2562 BAA9  20 05       	JR	NZ,LINE2
 2563 BAAB  05          	DEC	B	; B=0
 2564 BAAC  05          LINE1:	DEC	B	; B=-1
 2565 BAAD  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2566 BAB0  11 0285     LINE2:	LD	DE,PARAM
 2567 BAB3  D5          	PUSH	DE
 2568 BAB4  78          	LD	A,B	; 1=absolut / -1=relativ
 2569 BAB5  12          	LD	(DE),A	; Offset-Mode eintragen
 2570 BAB6  13          	INC	DE
 2571 BAB7  A7          	AND	A
 2572 BAB8  20 05       	JR	NZ,LINE3
 2573 BABA  11 028A     	LD	DE,PARAM+5 ; bei b=0 geht es weiter mit 2. Punkt
 2574 BABD  18 0A       	JR	LINE4
 2575                   	;
 2576 BABF  CD BEA8     LINE3:	CALL	POINT3	; Koordinaten (X,Y) ermitteln
 2577 BAC2  FE AD       	CP	0ADH	; Token "-"?
 2578 BAC4  20 7C       	JR	NZ,SNERR	; SN-ERROR
 2579 BAC6  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2580                   ; 2. Punkt
 2581 BAC9              LINE4:
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  56
PL41XX  Z80

 2582 BAC9  7E          	LD	A,(HL)
 2583 BACA  FE AB       	CP	0ABH	; Token "STEP"?
 2584 BACC  20 07       	JR	NZ,LINE5
 2585 BACE  06 FF       	LD	B,-1
 2586 BAD0  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2587 BAD3  18 02       	JR	LINE6
 2588                   	;
 2589 BAD5  06 01       LINE5:	LD	B,1	; kein STEP, B=1
 2590 BAD7  78          LINE6:	LD	A,B
 2591 BAD8  12          	LD	(DE),A	; Offset-Mode
 2592 BAD9  13          	INC	DE
 2593 BADA  CD BEA8     	CALL	POINT3	; Koordinaten (X,Y) ermitteln
 2594 BADD  20 04       	JR	NZ,LINE7
 2595 BADF  3E 01       	LD	A,1
 2596 BAE1  18 3B       	JR	LINE11	; wenn keine weiteren Werte kommen
 2597                   ; Stift-Mode
 2598 BAE3  FE 2C       LINE7:	CP	','
 2599 BAE5  20 5B       	JR	NZ,SNERR	; SN-ERROR
 2600 BAE7  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2601 BAEA  FE 2C       	CP	','	; folgt noch ein Komma?
 2602 BAEC  20 06       	JR	NZ,LINE8
 2603 BAEE  3E 01       	LD	A,1	; Stift-Mode ist nicht angegeben
 2604 BAF0  12          	LD	(DE),A	; dann Mode 1 (Standard)
 2605 BAF1  13          	INC	DE
 2606 BAF2  18 0F       	JR	LINE9
 2607                   
 2608 BAF4  CD BEE4     LINE8:	CALL	MA7B2	; 0/1-Parameter holen
 2609 BAF7  12          	LD	(DE),A
 2610 BAF8  13          	INC	DE
 2611 BAF9  2B          	DEC	HL
 2612 BAFA  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2613 BAFD  28 21       	JR	Z,LINE12
 2614 BAFF  FE 2C       	CP	','
 2615 BB01  20 3F       	JR	NZ,SNERR	; SN-ERROR
 2616 BB03  06 00       LINE9:	LD	B,0
 2617 BB05  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2618 BB08  FE 42       	CP	'B'
 2619 BB0A  20 36       	JR	NZ,SNERR	; SN-ERROR
 2620 BB0C  04          	INC	B	; bei 'B' b=1
 2621 BB0D  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2622 BB10  FE 46       	CP	'F'	; folgt noch ein 'F'?
 2623 BB12  20 07       	JR	NZ,LINE10
 2624 BB14  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2625 BB17  04          	INC	B	; dann b=2
 2626 BB18  78          	LD	A,B
 2627 BB19  18 06       	JR	LINE13
 2628                   
 2629 BB1B  78          LINE10:	LD	A,B
 2630 BB1C  18 03       	JR	LINE13
 2631                   
 2632 BB1E  12          LINE11:	LD	(DE),A	; Stift (Farbe) ablegen
 2633 BB1F  13          	INC	DE
 2634 BB20  AF          LINE12:	XOR	A
 2635 BB21  12          LINE13:	LD	(DE),A
 2636 BB22  D1          	POP	DE
 2637 BB23  0E 02       	LD	C,2	; Funktion 2
 2638 BB25  C3 AF68     	JP	PLSV	; ueber Sprungverteiler aufrufen
 2639                   
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  57
PL41XX  Z80

 2640                   ;-----------------------------------------------------------------------------
 2641                   ; PCIRCLE (x,y),radius[,stift[,anf-winkel[,end-winkel[,ellip]]]]
 2642                   ; PCIRCLE (x,y),radius[,stift],[anf-winkel],[end-winkel],ellip
 2643                   ; Zeichnen eines Kreises
 2644                   ; stift - 0 Hintergrundfarbe (Loeschen), 1 Vordergrundfarbe, (Standard: stift = 1)
 2645                   ; anf-winkel - Anfangswinkel fuer Kreisbogen (Bogenmass)
 2646                   ; end-winkel - Endwinkel fuer Kreisbogen (Bogenmass)
 2647                   ; ellip - Ellipsenparameter (Standard: ellip = 1)
 2648                   ;-----------------------------------------------------------------------------
 2649                   
 2650 BB28  7E          PCIRCLE:	LD	A,(HL)
 2651 BB29  FE AB       	CP	0ABH	; Token "STEP"?
 2652 BB2B  06 FF       	LD	B,-1	; STEP, b=-1
 2653 BB2D  20 05       	JR	NZ,CIRC1
 2654 BB2F  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2655 BB32  18 02       	JR	CIRC2
 2656                   	;
 2657 BB34  06 01       CIRC1:	LD	B,1	; kein STEP, b=1
 2658 BB36  11 0285     CIRC2:	LD	DE,PARAM
 2659 BB39  D5          	PUSH	DE
 2660 BB3A  78          	LD	A,B
 2661 BB3B  12          	LD	(DE),A
 2662 BB3C  13          	INC	DE
 2663 BB3D  CD BEA8     	CALL	POINT3	; Koordinaten (X,Y) ermitteln
 2664 BB40  FE 2C       	CP	','
 2665 BB42  C2 C348     SNERR:	JP	NZ,SNER
 2666                   ; Radius
 2667 BB45  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2668 BB48  CD CD3A     	CALL	SNALY	; Parameter uebernehmen
 2669 BB4B  11 028A     	LD	DE,PARAM+5
 2670 BB4E  CD BDA2     	CALL	SIZE7	; float-Wert nach (DE)
 2671 BB51  CD C8BE     	CALL	TCHAR1
 2672 BB54  28 78       	JR	Z,CIRC10	; wenn kein weiteres Zeichen folgt
 2673 BB56  FE 2C       	CP	','
 2674 BB58  20 E8       	JR	NZ,SNERR	; SN-ERROR
 2675                   ; Stift
 2676 BB5A  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2677 BB5D  FE 2C       	CP	','
 2678 BB5F  20 08       	JR	NZ,CIRC4
 2679 BB61  11 028E     	LD	DE,PARAM+9
 2680 BB64  CD BC24     	CALL	MA4DA	; Default 1 nach (DE) schreiben
 2681 BB67  18 09       	JR	CIRC5
 2682                   
 2683 BB69  CD BEE4     CIRC4:	CALL	MA7B2	; 0/1-Parameter holen
 2684 BB6C  12          	LD	(DE),A
 2685 BB6D  CD C8BE     	CALL	TCHAR1
 2686 BB70  28 5F       	JR	Z,CIRC11
 2687                   ; anf-winkel
 2688 BB72  CD C8BD     CIRC5:	CALL	TCHAR	; Token konsumieren
 2689 BB75  FE 2C       	CP	','
 2690 BB77  20 05       	JR	NZ,CIRC6
 2691 BB79  CD BC29     	CALL	MA4DF	; anf-winkel 0 schreiben
 2692 BB7C  18 12       	JR	CIRC7
 2693                   
 2694 BB7E  CD CD3A     CIRC6:	CALL	SNALY	; Parameter uebernehmen
 2695 BB81  11 028F     	LD	DE,PARAM+10
 2696 BB84  CD BDA2     	CALL	SIZE7	; float-Wert nach (DE)
 2697 BB87  CD C8BE     	CALL	TCHAR1
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  58
PL41XX  Z80

 2698 BB8A  28 48       	JR	Z,CIRC12
 2699 BB8C  FE 2C       	CP	','
 2700 BB8E  20 B2       	JR	NZ,SNERR	; SN-ERROR
 2701                   ; end-winkel
 2702 BB90  CD C8BD     CIRC7:	CALL	TCHAR	; Token konsumieren
 2703 BB93  FE 2C       	CP	','
 2704 BB95  20 05       	JR	NZ,CIRC8
 2705 BB97  CD BC2F     	CALL	MA4E5	; end-winkel Float Wert 2*PI schreiben
 2706 BB9A  18 12       	JR	CIRC9
 2707                   
 2708 BB9C  CD CD3A     CIRC8:	CALL	SNALY	; Parameter uebernehmen
 2709 BB9F  11 0293     	LD	DE,PARAM+14
 2710 BBA2  CD BDA2     	CALL	SIZE7	; float-Wert nach (DE)
 2711 BBA5  CD C8BE     	CALL	TCHAR1
 2712 BBA8  28 2D       	JR	Z,CIRC13
 2713 BBAA  FE 2C       	CP	','
 2714 BBAC  20 94       	JR	NZ,SNERR	; SN-ERROR
 2715 BBAE  CD C8BD     CIRC9:	CALL	TCHAR	; Token konsumieren
 2716 BBB1  CD CD3A     	CALL	SNALY	; Parameter uebernehmen
 2717 BBB4  E5          	PUSH	HL
 2718 BBB5  21 03E7     	LD	HL,WRA1+2 ; es muSS 0<=ellip<=1 gelten, sonst Fehler
 2719 BBB8  CB 7E       	BIT	7,(HL)
 2720 BBBA  C2 C967     	JP	NZ,FCER
 2721 BBBD  21 03E8     	LD	HL,WRA1+3
 2722 BBC0  7E          	LD	A,(HL)
 2723 BBC1  A7          	AND	A
 2724 BBC2  CA C967     	JP	Z,FCER
 2725 BBC5  E1          	POP	HL
 2726 BBC6  11 0297     	LD	DE,PARAM+18
 2727 BBC9  CD BDA2     	CALL	SIZE7	; float-Wert nach (DE)
 2728 BBCC  18 0C       	JR	CIRC14
 2729                   ; Defaultwerte
 2730 BBCE  CD BC24     CIRC10:	CALL	MA4DA	; Stift 1 nach (DE) schreiben
 2731 BBD1  CD BC29     CIRC11:	CALL	MA4DF	; anf-winkel 0 schreiben
 2732 BBD4  CD BC2F     CIRC12:	CALL	MA4E5	; end-winkel Float Wert 2*PI schreiben
 2733 BBD7  CD BC40     CIRC13:	CALL	MA4F6	; ellip Float Wert 1.0f schreiben
 2734                   ; Parameter skalieren
 2735 BBDA  E5          CIRC14:	PUSH	HL
 2736 BBDB  21 027D     	LD	HL,XSCALE
 2737 BBDE  CD D6DD     	CALL	OPKOP
 2738 BBE1  21 0297     	LD	HL,PARAM+18	; ellip
 2739 BBE4  E5          	PUSH	HL
 2740 BBE5  CD D6EE     	CALL	OPLAD
 2741 BBE8  CD D5F5     	CALL	DIV1
 2742 BBEB  21 0281     	LD	HL,YSCALE
 2743 BBEE  CD D6EE     	CALL	OPLAD
 2744 BBF1  CD D59A     	CALL	MUL1
 2745 BBF4  21 03E7     	LD	HL,WRA1+2
 2746 BBF7  7E          	LD	A,(HL)
 2747 BBF8  E6 7F       	AND	7FH
 2748 BBFA  77          	LD	(HL),A
 2749 BBFB  E1          	POP	HL
 2750 BBFC  CD D6F7     	CALL	OPTRAN
 2751 BBFF  21 027D     	LD	HL,XSCALE
 2752 BC02  3A 03E8     	LD	A,(WRA1+3)
 2753 BC05  FE 81       	CP	81H		; 1.0f
 2754 BC07  38 03       	JR	C,CIRC15
 2755 BC09  21 0281     	LD	HL,YSCALE
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  59
PL41XX  Z80

 2756 BC0C  CD D6DD     CIRC15:	CALL	OPKOP
 2757 BC0F  21 028A     	LD	HL,PARAM+5	; radius
 2758 BC12  E5          	PUSH	HL
 2759 BC13  CD D6EE     	CALL	OPLAD
 2760 BC16  CD D59A     	CALL	MUL1
 2761 BC19  E1          	POP	HL
 2762 BC1A  CD D6F7     	CALL	OPTRAN
 2763 BC1D  E1          	POP	HL
 2764 BC1E  D1          	POP	DE
 2765 BC1F  0E 03       	LD	C,3	; Funktion 3
 2766 BC21  C3 AF68     	JP	PLSV	; Sprungverteiler
 2767                   
 2768                   ; 1 nach (DE) schreiben
 2769 BC24  3E 01       MA4DA:	LD	A,1
 2770 BC26  12          	LD	(DE),A
 2771 BC27  13          	INC	DE
 2772 BC28  C9          	RET
 2773                   
 2774                   ; 0 nach anf-winkel schreiben (PARAM+10..PARAM+12 sind 0)
 2775 BC29  11 0292     MA4DF:	LD	DE,PARAM+13
 2776 BC2C  AF          	XOR	A
 2777 BC2D  12          	LD	(DE),A
 2778 BC2E  C9          	RET
 2779                   
 2780                   ; Float Wert 6.28319f (2*PI) nach end-winkel schreiben
 2781 BC2F  E5          MA4E5:	PUSH	HL
 2782 BC30  21 0293     	LD	HL,PARAM+14
 2783 BC33  36 DB       	LD	(HL),0DBH
 2784 BC35  23          	INC	HL
 2785 BC36  36 0F       	LD	(HL),0FH
 2786 BC38  23          	INC	HL
 2787 BC39  36 49       	LD	(HL),49H
 2788 BC3B  23          	INC	HL
 2789 BC3C  36 83       	LD	(HL),83H
 2790 BC3E  E1          	POP	HL
 2791 BC3F  C9          	RET
 2792                   
 2793                   ; Float Wert 1.0f nach ellip schreiben
 2794 BC40  11 0297     MA4F6:	LD	DE,PARAM+18
 2795 BC43  AF          	XOR	A
 2796 BC44  12          	LD	(DE),A
 2797 BC45  13          	INC	DE
 2798 BC46  12          	LD	(DE),A
 2799 BC47  13          	INC	DE
 2800 BC48  12          	LD	(DE),A
 2801 BC49  13          	INC	DE
 2802 BC4A  3E 81       	LD	A,81H
 2803 BC4C  12          	LD	(DE),A
 2804 BC4D  C9          	RET
 2805                   
 2806                   ;-----------------------------------------------------------------------------
 2807                   ; PAINT (x,y)[,c[,d]]
 2808                   ; c default 1
 2809                   ; d default 1
 2810                   ;-----------------------------------------------------------------------------
 2811                   
 2812 BC4E  7E          PAINT:	LD	A,(HL)
 2813 BC4F  FE AB       	CP	0ABH	; Token "STEP"?
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  60
PL41XX  Z80

 2814 BC51  06 FF       	LD	B,-1	; STEP, b=-1
 2815 BC53  20 05       	JR	NZ,PAINT1
 2816 BC55  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2817 BC58  18 02       	JR	PAINT2
 2818                   
 2819 BC5A  06 01       PAINT1:	LD	B,1	; kein STEP, b=1
 2820 BC5C  11 0285     PAINT2:	LD	DE,PARAM
 2821 BC5F  D5          	PUSH	DE
 2822 BC60  78          	LD	A,B
 2823 BC61  12          	LD	(DE),A	; Offset-Mode
 2824 BC62  13          	INC	DE
 2825                   ; (x,y)
 2826 BC63  CD BEA8     	CALL	POINT3	; Koordinaten (X,Y) ermitteln
 2827 BC66  28 2A       	JR	Z,PAINT5	; es folgt kein weiteres Zeichen
 2828 BC68  FE 2C       	CP	','
 2829 BC6A  C2 C348     	JP	NZ,SNER
 2830                   ; c
 2831 BC6D  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2832 BC70  FE 2C       	CP	','
 2833 BC72  20 06       	JR	NZ,PAINT3
 2834 BC74  3E 01       	LD	A,1	; sonst Std.-Wert 1
 2835 BC76  12          	LD	(DE),A
 2836 BC77  13          	INC	DE
 2837 BC78  18 0E       	JR	PAINT4
 2838                   
 2839 BC7A  CD BEE4     PAINT3:	CALL	MA7B2	; 0/1-Parameter holen
 2840 BC7D  12          	LD	(DE),A
 2841 BC7E  13          	INC	DE
 2842 BC7F  7E          	LD	A,(HL)	; naechstes Zeichen
 2843 BC80  A7          	AND	A
 2844 BC81  28 13       	JR	Z,PAINT6	; es folgt kein weiteres Zeichen
 2845 BC83  FE 2C       	CP	','
 2846 BC85  C2 C348     	JP	NZ,SNER
 2847                   ; d
 2848 BC88  CD C8BD     PAINT4:	CALL	TCHAR	; Token konsumieren
 2849 BC8B  D5          	PUSH	DE
 2850 BC8C  CD D421     	CALL	ARGVL1	; numerischen Parameter abholen
 2851 BC8F  D1          	POP	DE
 2852 BC90  18 06       	JR	PAINT7
 2853                   
 2854 BC92  3E 01       PAINT5:	LD	A,1	; c Default 1
 2855 BC94  12          	LD	(DE),A
 2856 BC95  13          	INC	DE
 2857 BC96  3E 01       PAINT6:	LD	A,1	; d Default 1
 2858 BC98  12          PAINT7:	LD	(DE),A
 2859 BC99  D1          	POP	DE
 2860 BC9A  0E 04       	LD	C,4	; Funktion 4
 2861 BC9C  C3 AF68     	JP	PLSV	; Sprungverteiler
 2862                   
 2863                   ;-----------------------------------------------------------------------------
 2864                   ; LABEL	string[,stift]
 2865                   ; Ausgabe einer Zeichenkette ab aktueller Stiftposition
 2866                   ;-----------------------------------------------------------------------------
 2867                   
 2868 BC9F  CD CD3A     LABEL:	CALL	SNALY	; Parameter uebernehmen
 2869 BCA2  E5          	PUSH	HL
 2870 BCA3  CD D330     	CALL	LEN1
 2871 BCA6  11 0285     	LD	DE,PARAM
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  61
PL41XX  Z80

 2872 BCA9  01 0004     	LD	BC,4	; 2 Byte Laenge, 2 Byte Adr. String
 2873 BCAC  ED B0       	LDIR
 2874 BCAE  E1          	POP	HL
 2875 BCAF  2B          	DEC	HL
 2876 BCB0  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2877 BCB3  28 0D       	JR	Z,LABEL1	; keine weiteren Zeichen vorhanden
 2878 BCB5  FE 2C       	CP	','
 2879 BCB7  C2 C348     	JP	NZ,SNER
 2880 BCBA  CD C8BD     	CALL	TCHAR	; Token konsumieren
 2881 BCBD  CD BEE4     	CALL	MA7B2	; 0/1-Parameter holen
 2882 BCC0  18 02       	JR	LABEL2
 2883                   
 2884 BCC2  3E 01       LABEL1:	LD	A,1	; Std. Stift := 1
 2885 BCC4  12          LABEL2:	LD	(DE),A
 2886 BCC5  11 0285     	LD	DE,PARAM
 2887 BCC8  0E 05       	LD	C,5	; Funktion 5
 2888 BCCA  C3 AF68     	JP	PLSV	; Sprungverteiler
 2889                   
 2890                   ;-----------------------------------------------------------------------------
 2891                   ; SIZE b,l[,r[,s[,a]]]
 2892                   ; SIZE b,l,[r],[s],a
 2893                   ; Festlegung der Schriftart (nur fuer PLOTTER)
 2894                   ; b Breite der Buchstaben (Geraeteeinheiten)
 2895                   ; I Laenge (Geraeteeinheiten)
 2896                   ; r Schreibrichtung (Bogenmass)
 2897                   ; s Schraeglage (Bogenmass)
 2898                   ; a Abstand 0 - gleichabstaendig (Standard), 1 - proportional
 2899                   ;-----------------------------------------------------------------------------
 2900                   
 2901 BCCD  E5          SIZE:	PUSH	HL
 2902 BCCE  21 028E     	LD	HL,PARAM+9
 2903 BCD1  36 00       	LD	(HL),0
 2904 BCD3  11 028F     	LD	DE,PARAM+10
 2905 BCD6  01 000B     	LD	BC,11
 2906 BCD9  ED B0       	LDIR		; Puffer loeschen
 2907 BCDB  E1          	POP	HL
 2908                   ; b
 2909 BCDC  CD CD3A     	CALL	SNALY	; Parameter uebernehmen
 2910 BCDF  11 028E     	LD	DE,PARAM+9
 2911 BCE2  CD BDA2     	CALL	SIZE7	; float-Wert nach (DE)
 2912 BCE5  CD C8D6     	CALL	CPCOMM	; Komma?
 2913                   ; l
 2914 BCE8  CD CD3A     	CALL	SNALY	; Parameter uebernehmen
 2915 BCEB  11 0292     	LD	DE,PARAM+13
 2916 BCEE  CD BDA2     	CALL	SIZE7	; float-Wert nach (DE)
 2917 BCF1  CD C8BE     	CALL	TCHAR1
 2918 BCF4  28 13       	JR	Z,SIZE1	; keine weiteren Zeichen
 2919                   ; r
 2920 BCF6  CD C8D6     	CALL	CPCOMM	; Komma?
 2921 BCF9  CD C8BE     	CALL	TCHAR1
 2922 BCFC  FE 2C       	CP	','
 2923 BCFE  28 09       	JR	Z,SIZE1
 2924 BD00  CD CD3A     	CALL	SNALY	; Parameter uebernehmen
 2925 BD03  11 0296     	LD	DE,PARAM+17
 2926 BD06  CD BDA2     	CALL	SIZE7	; float-Wert nach (DE)
 2927                   ; mit r skalieren
 2928 BD09  E5          SIZE1:	PUSH	HL
 2929 BD0A  21 0296     	LD	HL,PARAM+17
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  62
PL41XX  Z80

 2930 BD0D  CD BDAD     	CALL	SIZE8		; float-Wert nach (DE)
 2931 BD10  CD DA70     	CALL	COS
 2932 BD13  21 028E     	LD	HL,PARAM+9
 2933 BD16  CD BDB6     	CALL	SIZE9	; skalieren
 2934 BD19  22 0285     	LD	(PARAM),HL
 2935 BD1C  21 0296     	LD	HL,PARAM+17
 2936 BD1F  CD BDAD     	CALL	SIZE8		; float-Wert nach (DE)
 2937 BD22  CD DA76     	CALL	B_SIN
 2938 BD25  21 028E     	LD	HL,PARAM+9
 2939 BD28  CD BDB6     	CALL	SIZE9	; skalieren
 2940 BD2B  22 0287     	LD	(PARAM+2),HL
 2941 BD2E  E1          	POP	HL
 2942                   ; s
 2943 BD2F  CD C8BE     	CALL	TCHAR1
 2944 BD32  28 0A       	JR	Z,SIZE2
 2945 BD34  CD C8D6     	CALL	CPCOMM	; Komma?
 2946 BD37  CD C8BE     	CALL	TCHAR1
 2947 BD3A  FE 2C       	CP	','
 2948 BD3C  20 06       	JR	NZ,SIZE3
 2949 BD3E  AF          SIZE2:	XOR	A
 2950 BD3F  32 0291     	LD	(PARAM+12),A
 2951 BD42  18 09       	JR	SIZE4
 2952                   
 2953 BD44  CD CD3A     SIZE3:	CALL	SNALY	; Parameter uebernehmen
 2954 BD47  11 028E     	LD	DE,PARAM+9
 2955 BD4A  CD BDA2     	CALL	SIZE7	; float-Wert nach (DE)
 2956                   ; mit s skalieren
 2957 BD4D  E5          SIZE4:	PUSH	HL
 2958 BD4E  21 028E     	LD	HL,PARAM+9
 2959 BD51  CD BDAD     	CALL	SIZE8		; float-Wert nach (DE)
 2960 BD54  21 0296     	LD	HL,PARAM+17
 2961 BD57  CD D466     	CALL	ADD3
 2962 BD5A  21 DABA     	LD	HL,COSL
 2963 BD5D  CD D461     	CALL	ADD2
 2964 BD60  11 028E     	LD	DE,PARAM+9
 2965 BD63  CD BDA2     	CALL	SIZE7	; float-Wert nach (DE)
 2966 BD66  CD DA70     	CALL	COS
 2967 BD69  21 0292     	LD	HL,PARAM+13
 2968 BD6C  CD BDB6     	CALL	SIZE9	; skalieren
 2969 BD6F  22 0289     	LD	(PARAM+4),HL
 2970 BD72  21 028E     	LD	HL,PARAM+9
 2971 BD75  CD BDAD     	CALL	SIZE8		; float-Wert nach (DE)
 2972 BD78  CD DA76     	CALL	B_SIN
 2973 BD7B  21 0292     	LD	HL,PARAM+13
 2974 BD7E  CD BDB6     	CALL	SIZE9	; skalieren
 2975 BD81  22 028B     	LD	(PARAM+6),HL
 2976 BD84  E1          	POP	HL
 2977                   ; a
 2978 BD85  CD C8BE     	CALL	TCHAR1
 2979 BD88  28 0C       	JR	Z,SIZE5
 2980 BD8A  CD C8D6     	CALL	CPCOMM	; Komma?
 2981 BD8D  CD BEE4     	CALL	MA7B2	; 0/1-Parameter holen
 2982 BD90  28 04       	JR	Z,SIZE5
 2983 BD92  3E 80       	LD	A,80H	; wenn 1
 2984 BD94  18 01       	JR	SIZE6
 2985                   
 2986 BD96  AF          SIZE5:	XOR	A	; Abstand Standard = 0
 2987 BD97  32 028D     SIZE6:	LD	(PARAM+8),A
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  63
PL41XX  Z80

 2988 BD9A  11 0285     	LD	DE,PARAM
 2989 BD9D  0E 06       	LD	C,6	; Funktion 6
 2990 BD9F  C3 AF68     	JP	PLSV	; Sprungverteiler
 2991                   
 2992                   ; Float-Wert nach (DE) transportieren (4 Byte)
 2993 BDA2  E5          SIZE7:	PUSH	HL
 2994 BDA3  21 03E5     	LD	HL,WRA1	; ARITHMETIKREGISTER 1
 2995 BDA6  01 0004     	LD	BC,4
 2996 BDA9  ED B0       	LDIR
 2997 BDAB  E1          	POP	HL
 2998 BDAC  C9          	RET
 2999                   
 3000                   ; Float-Wert nach (DE) transportieren (4 Byte)
 3001 BDAD  11 03E5     SIZE8:	LD	DE,WRA1	; ARITHMETIKREGISTER 1
 3002 BDB0  01 0004     	LD	BC,4
 3003 BDB3  ED B0       	LDIR
 3004 BDB5  C9          	RET
 3005                   
 3006                   ; Skalieren (Multiplikation mit Skalefaktor (HL))
 3007 BDB6  CD D6EE     SIZE9:	CALL	OPLAD
 3008 BDB9  CD D59A     	CALL	MUL1
 3009 BDBC  CD C96F     	CALL	EPRVL3
 3010 BDBF  EB          	EX	DE,HL
 3011 BDC0  C9          	RET
 3012                   
 3013                   ;-----------------------------------------------------------------------------
 3014                   ; ZERO (x,y)
 3015                   ; Der Nullpunkt des aktuellen Koordinatensystems wird in den Punkt (x,y) gelegt.
 3016                   ; 	(Festlegung des Koordinatenursprungs)
 3017                   ;-----------------------------------------------------------------------------
 3018                   
 3019 BDC1  7E          ZERO:	LD	A,(HL)
 3020 BDC2  FE AB       	CP	0ABH	; Token "STEP"?
 3021 BDC4  06 FF       	LD	B,-1	; STEP => b=-1
 3022 BDC6  20 05       	JR	NZ,ZERO1
 3023 BDC8  CD C8BD     	CALL	TCHAR	; Token konsumieren
 3024 BDCB  18 02       	JR	ZERO2
 3025                   
 3026 BDCD  06 01       ZERO1:	LD	B,1	; kein STEP => b=1
 3027 BDCF  11 0285     ZERO2:	LD	DE,PARAM
 3028 BDD2  D5          	PUSH	DE
 3029 BDD3  78          	LD	A,B
 3030 BDD4  12          	LD	(DE),A	; Step
 3031 BDD5  13          	INC	DE
 3032 BDD6  CD BEA8     	CALL	POINT3	; Koordinaten (X,Y) ermitteln
 3033 BDD9  D1          	POP	DE
 3034 BDDA  0E 07       	LD	C,7	; Funktion 7
 3035 BDDC  18 13       	JR	YPOS1
 3036                   
 3037                   ;-----------------------------------------------------------------------------
 3038                   ; HOME
 3039                   ; Die Koordinaten des letzten erreichbaren Punktes werden in den
 3040                   ; Koordinatenursprung, den Punkt (0,0) des aktuellen Koordinatensystems, gelegt.
 3041                   ; HOME ist gleichbedeutend mit PSET(0,0),0.
 3042                   ;-----------------------------------------------------------------------------
 3043                   
 3044 BDDE  0E 08       PHOME:	LD	C,8	; Funktion 8
 3045 BDE0  18 0F       	JR	YPOS1
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  64
PL41XX  Z80

 3046                   
 3047                   ;-----------------------------------------------------------------------------
 3048                   ; GCLS	(Grundeinstellung des Plotters)
 3049                   ;-----------------------------------------------------------------------------
 3050                   
 3051 BDE2  0E 09       GCLS:	LD	C,9	; Funktion 9
 3052 BDE4  CD BE10     	CALL	SCALE1	; SCALE-Faktor 1 einstellen
 3053 BDE7  18 08       	JR	YPOS1
 3054                   
 3055                   ;-----------------------------------------------------------------------------
 3056                   ; XPOS
 3057                   ; liefert als Rueckgabeparameter die X-Koordinate des letzten erreichten Punktes
 3058                   ;-----------------------------------------------------------------------------
 3059                   
 3060 BDE9  0E 0B       XPOS:	LD	C,11	; Funktion 11
 3061 BDEB  18 04       	JR	YPOS1
 3062                   
 3063                   ;-----------------------------------------------------------------------------
 3064                   ; YPOS
 3065                   ; liefert als Rueckgabeparameter die Y-Koordinate des letzten erreichten Punktes
 3066                   ;-----------------------------------------------------------------------------
 3067                   
 3068 BDED  0E 0C       YPOS:	LD	C,12	; Funktion 12
 3069 BDEF  18 00       	JR	YPOS1	; das ist eigentlich gar kein Sprung...
 3070                   
 3071 BDF1  C3 AF68     YPOS1:	JP	PLSV	; Sprungverteiler
 3072                   
 3073                   ;-----------------------------------------------------------------------------
 3074                   ; SCALE	xfaktor,yfaktor
 3075                   ; Mit SCALE erfolgt eine Massstabsfestlegung in X- bzw. Y-Richtung (unabhaengig
 3076                   ; voneinander).  Alle Koordinatenangaben werden vor der Verarbeitung mit xfaktor
 3077                   ; bzw. yfaktor multipliziert.
 3078                   ;-----------------------------------------------------------------------------
 3079                   
 3080 BDF4  CD CD3A     SCALE:	CALL	SNALY	; Parameter uebernehmen
 3081 BDF7  11 027D     	LD	DE,XSCALE
 3082 BDFA  CD BDA2     	CALL	SIZE7	; float-Wert nach (DE)
 3083 BDFD  7E          	LD	A,(HL)
 3084 BDFE  FE 2C       	CP	','
 3085 BE00  C2 C348     	JP	NZ,SNER
 3086 BE03  CD C8BD     	CALL	TCHAR	; Token konsumieren
 3087 BE06  CD CD3A     	CALL	SNALY	; Parameter uebernehmen
 3088 BE09  11 0281     	LD	DE,YSCALE
 3089 BE0C  CD BDA2     	CALL	SIZE7	; float-Wert nach (DE)
 3090 BE0F  C9          	RET
 3091                   ;
 3092                   ; Scalierungsfaktoren auf 1,1 setzen
 3093                   ; (UP fuer SCREEN1 und GCLS)
 3094                   ;
 3095 BE10  EB          SCALE1:	EX	DE,HL	; HL sichern
 3096 BE11  21 0000     	LD	HL,0
 3097 BE14  22 027D     	LD	(XSCALE),HL	; SCALE x-Faktor
 3098 BE17  22 0281     	LD	(YSCALE),HL	; SCALE y-Faktor
 3099 BE1A  26 81       	LD	H,81H		; hl=8100h <=> "1.0f"
 3100 BE1C  22 027F     	LD	(XSCALE+2),HL
 3101 BE1F  22 0283     	LD	(YSCALE+2),HL
 3102 BE22  EB          	EX	DE,HL	; HL regenerieren
 3103 BE23  C9          	RET
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  65
PL41XX  Z80

 3104                   ;
 3105                   ; Tabelle der Portadressen zur Plotter-Zuweisung
 3106                   ; KC85: alle an M001 PIO-Port B
 3107                   ;
 3108                   ;PORTTAB:
 3109                   ;	DB	5	; Plotter 1 (KC87: 89h)
 3110                   ;	DB	5	; Plotter 2 (KC87: C8h)
 3111                   ;	DB	5	; Plotter 3 (KC87: C9h)
 3112                   ;	DB	5	; Plotter 4 (KC87: CCh)
 3113                   ;	DB	5	; Plotter 5 (KC87: CBh)
 3114                   ;
 3115                   ;-----------------------------------------------------------------------------
 3116                   ; SCREEN [bildschirm],plotter
 3117                   ; Bildschirm	0 = alphanumerischer Bildschirm KC87
 3118                   ;		1 = Grafikbildschirm KC87
 3119                   ; Plotter	0 = Abschalten des Plotters
 3120                   ;		1-5 Plotter aktivieren mit 5 verschiedenen Portadressen
 3121                   ; Zuweisung des Plotters: Wird die SCREEN-Anweisung erst nach den Anweisungen
 3122                   ; zum Zeichnen gegeben, zeichnet der Grafik-Zusatz "im Hintergrund".
 3123                   ;-----------------------------------------------------------------------------
 3124                   
 3125 BE24  3A 035A     SCREEN:	LD	A,(WINJP)
 3126 BE27  CB 7F       	BIT	7,A		; erster Aufruf?
 3127 BE29  CB FF       	SET	7,A		; merken
 3128 BE2B  CC BE10     	CALL	Z,SCALE1	; SCALE 1,1
 3129 BE2E  CD C8BE     	CALL	TCHAR1		; Parameter angegeben?
 3130 BE31  28 21       	JR	Z,SCRN5		; nein, Grafikbildschirm aus bei KC87
 3131 BE33  FE 2C       	CP	','		; zweiter Wert?
 3132                   ;	JR	NZ,SCRN1	; nein
 3133                   ;	CALL	SCRN10	; KC87: Grafikbildschirm aus
 3134 BE35  28 0D       	JR	Z,SCRN4		; ja
 3135                   		
 3136 BE37  CD BEE4     SCRN1:	CALL	MA7B2		; 0/1-Parameter holen
 3137                   ;	JR	NZ,SCRN2
 3138                   ;	CALL	SCRN10	; KC87: Grafikbildschirm aus
 3139                   ;	JR	SCRN3
 3140                   ;
 3141                   ;SCRN2:	CALL	SCRN11	; KC87: Farbwert aus (0027H) benutzen
 3142                   ; zweiter Parameter
 3143 BE3A  CD C8BE     SCRN3:	CALL	TCHAR1
 3144 BE3D  28 15       	JR	Z,SCRN6		; kein weiteres Zeichen => Plotter aus
 3145 BE3F  FE 2C       	CP	','
 3146 BE41  C2 C348     	JP	NZ,SNER		; Fehler, wenn kein Komma
 3147                   ; Plotter initialisieren
 3148 BE44  CD C8BD     SCRN4:	CALL	TCHAR		; Token konsumieren
 3149 BE47  CD D421     	CALL	ARGVL1		; Parameter abholen
 3150 BE4A  A7          	AND	A
 3151 BE4B  28 08       	JR	Z,SCRN7		; 0 = Plotter abschalten
 3152 BE4D  FE 06       	CP	6
 3153 BE4F  D2 C967     	JP	NC,FCER		; Parameter > 5
 3154                   ;	DEC	A
 3155                   ;	LD	C,A
 3156                   ;	LD	B,0
 3157                   ;	EX	DE,HL		; HL sichern in DE
 3158                   ;	LD	HL,PORTTAB	; Tabelle mit 5 Portadressen beim KC87
 3159                   ;	ADD	HL,BC
 3160                   ;	LD	A,(HL)		; Tabelle lesen
 3161                   ;	EX	DE,HL		; HL restaurieren
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  66
PL41XX  Z80

 3162                   ;	AND	A		; Z=1, wenn Port=0
 3163 BE52  18 01       	JR	SCRN7
 3164                   ;
 3165                   ; SCREEN ohne Parameter aufgerufen
 3166                   ;	
 3167 BE54              SCRN5:	;CALL	SCRN10	; KC87: Grafik-Bildschirm aus
 3168 BE54  AF          SCRN6:	XOR	A		; 0 - Abschalten Plotter
 3169 BE55  E5          SCRN7:	PUSH	HL
 3170 BE56  3A 035A     	LD	A,(WINJP)
 3171 BE59  28 16       	JR	Z,SCRN8
 3172                   ; Plotter ein:			; Umschaltung auf Plotter-Routinen
 3173 BE5B  21 BA76     	LD	HL,PPSET
 3174 BE5E  22 AF0E     	LD	(TOKE4),HL	; PSET
 3175 BE61  21 BAA0     	LD	HL,PLINE
 3176 BE64  22 AF2A     	LD	(TOKF2),HL	; LINE
 3177 BE67  21 BB28     	LD	HL,PCIRCLE
 3178 BE6A  22 AF2C     	LD	(TOKF3),HL	; CIRCLE
 3179 BE6D  CB C7       	SET	0,A		; Bit0=1 setzen => Plotter ein
 3180 BE6F  18 14       	JR	SCRN9
 3181                   ; Plotter aus:			; Umschaltung auf CAOS-Routinen
 3182 BE71  2A AF44     SCRN8:	LD	HL,(TOKC)
 3183 BE74  22 AF0E     	LD	(TOKE4),HL	; PSET
 3184 BE77  2A AF46     	LD	HL,(TOKC+2)
 3185 BE7A  22 AF2A     	LD	(TOKF2),HL	; LINE
 3186 BE7D  2A AF48     	LD	HL,(TOKC+4)
 3187 BE80  22 AF2C     	LD	(TOKF3),HL	; CIRCLE
 3188 BE83  CB 87       	RES	0,A		; Bit0=0 setzen => Plotter aus
 3189 BE85  E1          SCRN9:	POP	HL
 3190 BE86  32 035A     	LD	(WINJP),A
 3191 BE89  C9          	RET
 3192                   
 3193                   ; KC87: Grafikbildschirm aus:
 3194                   ;SCRN10:	LD	A,0E2H	; RAND, Ink cyan, Grafik aus, Paper gruen
 3195                   ;	JR	SCRN12
 3196                   
 3197                   ;SCRN11:	LD	A,(0027H) ; KC87: aktuelles Farbattribut
 3198                   ;	OR	88H	; KC87: GRAF ein und RAND ein
 3199                   ;SCRN12:	;OUT	(0B8H),A	; KC87 Grafikzusatz
 3200                   ;	NOP
 3201                   ;	NOP
 3202                   ;	RET
 3203                   
 3204                   ;-----------------------------------------------------------------------------
 3205                   ; POINT (X,Y)
 3206                   ; Bestimmen des Punktzustandes
 3207                   ; POINT liefert als Rueckgabeparameter 0, wenn der Abfragepunkt die
 3208                   ; Hintergrundfarbe, und 1, wenn der Abfragepunkt die Vordergrundfarbe hat.
 3209                   ;-----------------------------------------------------------------------------
 3210                   
 3211 BE8A  7E          POINT:	LD	A,(HL)
 3212 BE8B  FE AB       	CP	0ABH		; Token "STEP"?
 3213 BE8D  06 FF       	LD	B,-1		; Offset-Mode -1
 3214 BE8F  20 05       	JR	NZ,POINT1	; kein STEP
 3215 BE91  CD C8BD     	CALL	TCHAR		; Token konsumieren
 3216 BE94  18 02       	JR	POINT2
 3217                   
 3218 BE96  06 01       POINT1:	LD	B,1		; Offset-Mode 1
 3219 BE98  11 0285     POINT2:	LD	DE,PARAM
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  67
PL41XX  Z80

 3220 BE9B  D5          	PUSH	DE
 3221 BE9C  78          	LD	A,B
 3222 BE9D  12          	LD	(DE),A
 3223 BE9E  13          	INC	DE
 3224 BE9F  CD BEA8     	CALL	POINT3		; Koordinaten (X,Y) ermitteln
 3225 BEA2  D1          	POP	DE
 3226 BEA3  0E 0A       	LD	C,10		; Funktion 10
 3227 BEA5  C3 AF68     	JP	PLSV		; Sprungverteiler
 3228                   
 3229                   ; Koordinaten (X,Y) ermitteln
 3230 BEA8  7E          POINT3:	LD	A,(HL)
 3231 BEA9  FE 28       	CP	'('		; Klammer auf?
 3232 BEAB  C2 C348     	JP	NZ,SNER		; Syntax-Fehler
 3233 BEAE  CD C8BD     	CALL	TCHAR		; Token konsumieren
 3234 BEB1  D5          	PUSH	DE
 3235 BEB2  CD CD3A     	CALL	SNALY		; X-Koordinate uebernehmen
 3236 BEB5  E5          	PUSH	HL		; Programmzeiger
 3237 BEB6  21 027D     	LD	HL,XSCALE
 3238 BEB9  CD BDB6     	CALL	SIZE9		; skalieren
 3239 BEBC  EB          	EX	DE,HL
 3240 BEBD  E1          	POP	HL		; Programmzeiger
 3241 BEBE  E3          	EX	(SP),HL
 3242 BEBF  73          	LD	(HL),E
 3243 BEC0  23          	INC	HL
 3244 BEC1  72          	LD	(HL),D
 3245 BEC2  23          	INC	HL
 3246 BEC3  E3          	EX	(SP),HL
 3247 BEC4  CD C8D6     	CALL	CPCOMM		; Komma holen
 3248 BEC7  CD CD3A     	CALL	SNALY		; Y-Koordinate uebernehmen
 3249 BECA  E5          	PUSH	HL
 3250 BECB  21 0281     	LD	HL,YSCALE
 3251 BECE  CD BDB6     	CALL	SIZE9		; skalieren
 3252 BED1  EB          	EX	DE,HL
 3253 BED2  E1          	POP	HL
 3254 BED3  E3          	EX	(SP),HL
 3255 BED4  73          	LD	(HL),E		; in (HL) ablegen
 3256 BED5  23          	INC	HL
 3257 BED6  72          	LD	(HL),D
 3258 BED7  23          	INC	HL
 3259 BED8  D1          	POP	DE
 3260 BED9  EB          	EX	DE,HL
 3261 BEDA  7E          	LD	A,(HL)
 3262 BEDB  FE 29       	CP	')'
 3263 BEDD  C2 C348     	JP	NZ,SNER
 3264 BEE0  CD C8BD     	CALL	TCHAR		; Token konsumieren
 3265 BEE3  C9          	RET
 3266                   
 3267                   ; ungenutzter Code ???
 3268                   ;	PUSH	DE
 3269                   ;	CALL	EPRVL4
 3270                   ;	EX	(SP),HL
 3271                   ;	LD	(HL),E
 3272                   ;	INC	HL
 3273                   ;	LD	(HL),D
 3274                   ;	INC	HL
 3275                   ;	EX	(SP),HL
 3276                   ;	POP	DE
 3277                   ;	RET
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  68
PL41XX  Z80

 3278                   
 3279                   ; 0/1-Parameter holen
 3280 BEE4  D5          MA7B2:	PUSH	DE
 3281 BEE5  CD D421     	CALL	ARGVL1		; numerischen Parameter abholen
 3282 BEE8  D1          	POP	DE
 3283 BEE9  A7          	AND	A
 3284 BEEA  C8          	RET	Z		; wenn A = 0
 3285 BEEB  3D          	DEC	A
 3286 BEEC  C2 C967     	JP	NZ,FCER		; wenn A <> 1
 3287 BEEF  3C          	INC	A		; A = 1 restaurieren
 3288 BEF0  C9          	RET
 3289                   
 3290                   ;	DS	0A7D6h-$,0FFH	; Frei bis zu Sprungtabelle (A7D6h wie bei KC87)
 3291                   
 3292                   ; Sprungverteiler:
 3293 BEF1  C3 BA76     JPPSET:	JP	PPSET
 3294 BEF4  C3 BAA0     JPLINE:	JP	PLINE
 3295 BEF7  C3 BB28     JCIRCL:	JP	PCIRCLE
 3296 BEFA  C3 BC4E     	JP	PAINT
 3297 BEFD  C3 BC9F     JLABEL:	JP	LABEL
 3298 BF00  C3 BCCD     JSIZE:	JP	SIZE
 3299 BF03  C3 BDC1     JZERO:	JP	ZERO
 3300 BF06  C3 BDDE     JHOME:	JP	PHOME
 3301 BF09  C3 BDE2     JGCLS:	JP	GCLS
 3302 BF0C  C3 BDF4     JSCALE:	JP	SCALE
 3303 BF0F  C3 BE24     JSCRN:	JP	SCREEN
 3304 BF12  C3 BE8A     	JP	POINT
 3305 BF15  C3 BDE9     	JP	XPOS
 3306 BF18  C3 BDED     	JP	YPOS
 3307                   
 3308                   ;-----------------------------------------------------------------------------
 3309                   ; INIT-Programm XY41xx	KC85/3-5 mit CAOS 3.1 - 4.8
 3310                   ; Code verschieblich, Ausfuehrung im RAM0 mit Autostart
 3311                   ;-----------------------------------------------------------------------------
 3312                   
 3313 BF1B  C3 AEDA     EXTGO1:	JP	BEXP1		; Sprung zur Verarbeitung der Erweiterungen
 3314 BF1E  AE00        EXTTAB:	DW	TOKTAB
 3315                   
 3316                   ;	DW	7F7FH		; Programmstart
 3317                   ;	DB	'INIT41XX',1	; kein Menuewort, nur Autostart
 3318                   ;
 3319                   ; Test, ob eventuell schon RAM auf 4000H, 8000H und C000H vorhanden ist
 3320                   ;
 3321 BF20  06 05       START:	LD	B,5		; 5x testen
 3322 BF22  21 4000     	LD	HL,4000H	; mit 4000H beginnen
 3323 BF25  DB 88       MSA:	IN	A,88H
 3324 BF27  CB 97       	RES	2,A		; IRM aus
 3325 BF29  D3 88       	OUT	88H,A
 3326 BF2B  7E          	LD	A,(HL)		; Inhalt
 3327 BF2C  2F          	CPL			; negieren
 3328 BF2D  77          	LD	(HL),A		; zurueckschreiben
 3329 BF2E  BE          	CP	(HL)		; und vergleichen
 3330 BF2F  2F          	CPL			; (Z-Flag nicht veraendert)
 3331 BF30  77          	LD	(HL),A		; wieder der alte Wert
 3332 BF31  DB 88       	IN	A,88H
 3333 BF33  CB D7       	SET	2,A		; IRM ein
 3334 BF35  D3 88       	OUT	88H,A
 3335 BF37  20 0A       	JR	NZ,MSX		; kein RAM vorhanden
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  69
PL41XX  Z80

 3336 BF39  3E 20       	LD	A,20H
 3337 BF3B  84          	ADD	A,H		; 4000H, 6000H, 8000H, A000H, C000H
 3338 BF3C  67          	LD	H,A
 3339 BF3D  10 E6       	DJNZ	MSA
 3340 BF3F  3E FF       	LD	A,-1		; Kennung "RAM schon vorhanden"
 3341 BF41  18 01       	JR	MS0
 3342                   	;
 3343 BF43  AF          MSX:	XOR	A		; A=0, also RAM-Modul suchen
 3344 BF44  32 B785     MS0:	LD	(ARG2+1),A	; Merkzelle fuer Steckplatz RAM-Modul
 3345 BF47  AF          	XOR	A
 3346 BF48  32 B783     	LD	(ARG1+1),A	; Merkzelle fuer Steckplatz M001
 3347                   ;
 3348                   ; Modulsuche erstes M001 und M022 bzw. M011:
 3349                   ;
 3350 BF4B  01 0880     	LD	BC,0880H	; mit Steckplatz beginnen
 3351 BF4E  ED 78       MS1:	IN	A,(C)		; Kennbyte lesen
 3352 BF50  FE EF       	CP	0EFH		; M001?
 3353 BF52  28 4F       	JR	Z,M001
 3354 BF54  FE F4       	CP	0F4H		; M022?
 3355 BF56  28 5D       	JR	Z,M022
 3356 BF58  FE F6       	CP	0F6H		; M011?
 3357 BF5A  28 71       	JR	Z,M011
 3358 BF5C  04          MS2:	INC	B		; naechster Schacht
 3359 BF5D  20 EF       	JR	NZ,MS1		; weitersuchen bis Steckplatz FF
 3360                   ;
 3361                   ; alle Steckplaetze abgesucht, anzeigen was fehlt:
 3362                   ;
 3363 BF5F  3A B783     	LD	A,(ARG1+1)
 3364 BF62  B7          	OR	A		; M001 gefunden?
 3365 BF63  20 11       	JR	NZ,M001OK	; ja
 3366 BF65  CD F003     	CALL	PV1
 3367 BF68  23          	DB	OSTR
 3368 BF69  0D 0A 45 52 	DB	CR,LF,'ERROR M001',0
 3369 BF76  3A B785     M001OK:	LD	A,(ARG2+1)
 3370 BF79  B7          	OR	A		; RAM-Modul gefunden?
 3371 BF7A  20 22       	JR	NZ,EXIT		; ja
 3372 BF7C  CD F003     	CALL	PV1
 3373 BF7F  23          	DB	OSTR
 3374 BF80  0D 0A 45 52 	DB	CR,LF,'ERROR M011',0
 3375 BF8D  3A E011     	LD	A,(0E011H)
 3376 BF90  FE 7F       	CP	7FH		; KC85/4?
 3377 BF92  20 0A       	JR	NZ,EXIT		; nein
 3378 BF94  CD F003     	CALL	PV1
 3379 BF97  23          	DB	OSTR		; beim KC85/4 reicht auch ein M022
 3380 BF98  2F 4D 30 32 	DB	'/M022',0
 3381 BF9E  CD F003     EXIT:	CALL	PV1
 3382 BFA1  2C          	DB	CRLF
 3383 BFA2  C9          	RET			; Ruecksprung zu CAOS
 3384                   ;
 3385                   ; M001 gefunden:
 3386                   ;
 3387 BFA3  3A B783     M001:	LD	A,(ARG1+1)	; M001-Steckplatz
 3388 BFA6  B7          	OR	A		; schon belegt?
 3389 BFA7  20 04       	JR	NZ,MS3		; ja
 3390 BFA9  ED 43 B782  	LD	(ARG1),BC	; M001 Steckplatz B merken
 3391 BFAD  3A B785     MS3:	LD	A,(ARG2+1)	; RAM-Steckplatz
 3392 BFB0  B7          	OR	A		; auch schon belegt?
 3393 BFB1  28 A9       JMS2:	JR	Z,MS2		; nein, weitersuchen
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  70
PL41XX  Z80

 3394 BFB3  18 28       	JR	MS5		; Suche beendet
 3395                   ;
 3396                   ; M022 / M011 gefunden:
 3397                   ;
 3398 BFB5  3A E011     M022:	LD	A,(0E011H)
 3399 BFB8  FE 7F       	CP	7FH		; KC85/4?
 3400 BFBA  20 A0       	JR	NZ,MS2		; M022 beim KC85/3 nicht ausreichend
 3401                   ; beim KC85/4 auch nicht, wenn RAM4 oder RAM8 aus ist !
 3402 BFBC  DD 7E 04    	LD	A,(IX+4)	; Merkzelle Port 86H
 3403 BFBF  E6 03       	AND	3		; nur Bit 0+1 testen
 3404 BFC1  FE 03       	CP	3
 3405 BFC3  20 97       	JR	NZ,MS2		; RAM4 ist nicht W/R online
 3406 BFC5  DB 89       	IN	A,(PIOBD)
 3407 BFC7  E6 60       	AND	60H		; nur Bit 5+6 testen
 3408 BFC9  FE 60       	CP	60H
 3409 BFCB  20 8F       	JR	NZ,MS2		; RAM8 ist nicht W/R online
 3410 BFCD  3A B785     M011:	LD	A,(ARG2+1)	; M011/M022
 3411 BFD0  B7          	OR	A		; schon belegt?
 3412 BFD1  20 04       	JR	NZ,MS4
 3413 BFD3  ED 43 B784  	LD	(ARG2),BC	; RAM-Modul Steckplatz B merken
 3414 BFD7  3A B783     MS4:	LD	A,(ARG1+1)	; M001-Steckplatz
 3415 BFDA  B7          	OR	A		; auch schon belegt?
 3416 BFDB  28 D4       	JR	Z,JMS2		; nein, weitersuchen
 3417                   ;
 3418                   ; Module einschalten:
 3419                   ;
 3420 BFDD  2A B783     MS5:	LD	HL,(ARG1+1)	; L=Steckplatz M001
 3421 BFE0  16 01       	LD	D,1		; Steuerbyte
 3422 BFE2  3E 02       	LD	A,2		; schalten
 3423 BFE4  CD F003     	CALL	PV1
 3424 BFE7  26          	DB	MODU		; M001 einschalten
 3425 BFE8  3A B785     	LD	A,(ARG2+1)
 3426 BFEB  6F          	LD	L,A		; Steckplatz RAM-Modul
 3427 BFEC  3C          	INC	A		; bereits genug RAM vorhanden?
 3428 BFED  28 08       	JR	Z,MS6		; ja, dann nicht schalten
 3429 BFEF  16 C3       	LD	D,0C3H		; Steuerbyte
 3430 BFF1  3E 02       	LD	A,2		; schalten
 3431 BFF3  CD F003     	CALL	PV1
 3432 BFF6  26          	DB	MODU		; RAM-Modul auf C000H W/R einschalten
 3433                   ;
 3434                   ; BASIC-ROM zuschalten
 3435                   ;
 3436 BFF7  3E 02       MS6:	LD	A,2		; schalten
 3437 BFF9  6F          	LD	L,A		; BASIC/USER
 3438 BFFA  16 C1       	LD	D,0C1H
 3439 BFFC  CD F003     	CALL	PV1
 3440 BFFF  26          	DB	MODU		; BASIC-ROM einschalten
 3441                   ;
 3442                   ; Inhalt des BASIC-ROM nach 4000H kopieren
 3443                   ;
 3444 C000  21 C000     	LD	HL,0C000H	; Quelle: BASIC
 3445 C003  11 4000     	LD	DE,4000H	; Ziel: RAM4
 3446 C006  01 2000     	LD	BC,2000H	; Laenge: 8 KByte
 3447 C009  ED B0       	LDIR
 3448                   ;
 3449                   ; BASIC-ROM wieder abschalten
 3450                   ;
 3451 C00B  3E 02       	LD	A,2		; schalten
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  71
PL41XX  Z80

 3452 C00D  6F          	LD	L,A		; BASIC/USER
 3453 C00E  16 00       	LD	D,0
 3454 C010  CD F003     	CALL	PV1
 3455 C013  26          	DB	MODU		; BASIC ausschalten
 3456                   ;
 3457                   ; BASIC vom RAM 4 in RAM-Modul kopieren
 3458                   ;
 3459 C014  21 4000     	LD	HL,4000H	; Quelle: RAM4
 3460 C017  11 C000     	LD	DE,0C000H	; Ziel; RAM-Modul auf C000H
 3461 C01A  01 2000     	LD	BC,2000H	; Laenge: 8KByte
 3462 C01D  ED B0       	LDIR
 3463                   ;
 3464                   ; BASIC im RAM-Modul modifizieren
 3465                   ;
 3466                   ; 1. Verwendung EXTTAB
 3467 C01F  21 BF1E     	LD	HL,EXTTAB	; EXTTAB neu, Zeiger auf Token-Tabelle
 3468 C022  22 C540     	LD	(SCANEX),HL	; Verwendung im Interpreter
 3469                   ; 2. Verwendung suchen (wegen Patch bei CAOS 4.8)
 3470 C025  EB          	EX	DE,HL		; EXTTAB jetzt in DE
 3471 C026  21 C7A3     	LD	HL,LISTX
 3472 C029  23          MD:	INC	HL
 3473 C02A  7E          	LD	A,(HL)
 3474 C02B  FE 0C       	CP	0CH
 3475 C02D  20 FA       	JR	NZ,MD
 3476 C02F  73          	LD	(HL),E		; Verwendung im LIST
 3477 C030  23          	INC	HL
 3478 C031  72          	LD	(HL),D
 3479                   ; 3. Verwendung EXTGO1
 3480 C032  21 BF1B     	LD	HL,EXTGO1	; modifizierte Routine fuer mehr Token
 3481 C035  22 C8AB     	LD	(EXT1),HL
 3482                   ; 4. Name aendern in PL-BASIC
 3483 C038  21 AF4A     	LD	HL,PBASIC	; "Plotter-BASIC"
 3484 C03B  22 C024     	LD	(RESSP+1),HL	; Name des BASIC modifizieren
 3485                   ; 5. RAM-Suche begrenzen
 3486 C03E  3E AD       	LD	A,High(ADRES)-1	; bis ADFFH
 3487 C040  32 C043     	LD	(RAMSCH+2),A
 3488                   ;
 3489                   ; BASIC-RAM-Modul Read-only (aber nur wenn es ein M022 ist)
 3490                   ;
 3491 C043  ED 4B B784  	LD	BC,(ARG2)	; RAM-Modul
 3492 C047  ED 78       	IN	A,(C)
 3493 C049  FE F4       	CP	0F4H		; M022?
 3494 C04B  20 09       	JR	NZ,IRM_OF	; nein, nur M022 R/O schalten
 3495 C04D  68          	LD	L,B		; Steckplatz RAM-Modul
 3496 C04E  16 C1       	LD	D,0C1H		; Steuerbyte R/O
 3497 C050  3E 02       	LD	A,2		; schalten
 3498 C052  CD F003     	CALL	PV1
 3499 C055  26          	DB	MODU		; RAM-Modul auf C000H R/O einschalten
 3500                   ;
 3501                   ;-----------------------------------------------------------------------------
 3502                   ; BASIC-Zusatz aus dem RAM ab 6200H in den RAM8 ab 9600H kopieren
 3503                   ; und Token-Adressen aus dem aktuellen CAOS-ROM uebernehmen
 3504                   ;-----------------------------------------------------------------------------
 3505                   ;
 3506 C056  DB 88       IRM_OF:	IN	A,88H
 3507 C058  CB 97       	RES	2,A		; IRM aus
 3508 C05A  D3 88       	OUT	88H,A
 3509                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  72
PL41XX  Z80

 3510                   ; Zusatz-BASIC in den RAM8 kopieren
 3511                   ;
 3512 C05C  21 0300     	LD	HL,ADRES-OFFS	; von: 0300H bis 15FFH
 3513 C05F  11 AE00     	LD	DE,ADRES	; nach AE00H bis BFFFH
 3514 C062  01 1200     	LD	BC,1200H	; Laenge	
 3515 C065  ED B0       	LDIR
 3516                   ;
 3517                   ; Token-Adressen aus dem aktuellen CAOS uebernehmen
 3518                   ;
 3519 C067  2A E00C     	LD	HL,(0E00CH)	; EXTTAB im CAOS
 3520 C06A  11 AE00     	LD	DE,TOKTAB	; hier hin kopieren in den RAM
 3521 C06D  06 23       	LD	B,0F7H-0D4H	; Anzahl Token bis F7H (bei CAOS 4.8)
 3522 C06F  7E          TS1:	LD	A,(HL)
 3523 C070  FE 80       	CP	80H		; Ende der Token?
 3524 C072  28 0A       	JR	Z,TS3		; ja
 3525 C074  CB 7F       	BIT	7,A		; neuer Token?
 3526 C076  28 01       	JR	Z,TS2		; nein
 3527 C078  05          	DEC	B		; Token mitzaehlen
 3528 C079  12          TS2:	LD	(DE),A		; Token in RAM kopieren
 3529 C07A  13          	INC	DE
 3530 C07B  23          	INC	HL		; naechstes Zeichen
 3531 C07C  18 F1       	JR	TS1
 3532                   ;
 3533                   ; Falls weniger Token als bei CAOS 4.8, dann fuer die fehlenden
 3534                   ; Token ein REM (9CH) eintragen
 3535                   ;
 3536 C07E  E5          TS3:	PUSH	HL		; Adresse merken
 3537 C07F  04          	INC	B
 3538 C080  05          	DEC	B
 3539 C081  28 10       	JR	Z,TS5		; kein fehlender Token
 3540 C083  C5          	PUSH	BC
 3541 C084  3E FF       	LD	A,0FFH		; Ersatzzeichen fuer das fehlende Token
 3542 C086  12          TS4:	LD	(DE),A
 3543 C087  13          	INC	DE
 3544 C088  10 FC       	DJNZ	TS4
 3545 C08A  21 AEB9     	LD	HL,TOKF8	; jetzt die neuen Token entsprechend
 3546 C08D  01 0021     	LD	BC,TOKFF-TOKF8	; danach anordnen
 3547 C090  ED B0       	LDIR
 3548 C092  C1          	POP	BC
 3549                   ;
 3550                   ; unmittelbar nach den TOKEN schliesst sich in allen CAOS-Versionen
 3551                   ; auch die Sprungtabelle der Token an.
 3552                   ; C=0 bei CAOS 4.8
 3553                   ; C=2 bei CAOS 4.5
 3554                   ; C=3 bei CAOS 3.1
 3555                   ;
 3556 C093  3E 23       TS5:	LD	A,35		; 35 Adressen bei CAOS 4.8 (INKEY$ bis CHDIR)
 3557 C095  90          	SUB	B		; abzueglich der fehlenden Token bis CAOS 4.6
 3558 C096  87          	ADD	A,A		; 2 Byte pro Adresse
 3559 C097  4F          	LD	C,A
 3560 C098  06 00       	LD	B,0		; BC = Anzahl der zu uebernehmenden Adressen
 3561 C09A  E1          	POP	HL		; Adresse, von 80H (Token-Ende)
 3562 C09B  23          	INC	HL		; weiter zu den Adressen im CAOS-ROM
 3563 C09C  11 AEF0     	LD	DE,TOKJP	; TOKJP neu im RAM
 3564 C09F  ED B0       	LDIR			; kopieren
 3565                   ;
 3566                   ; Auslesen der CAOS-Adressen von PSET, LINE und CIRCLE
 3567                   ;
SLR180 SuperFast Relocating Macro Assembler     			    SLR180 1.31 Page  73
PL41XX  Z80

 3568 C0A1  2A AF0E     	LD	HL,(TOKE4)	; PSET
 3569 C0A4  22 AF44     	LD	(TOKC),HL
 3570 C0A7  2A AF2A     	LD	HL,(TOKF2)	; LINE
 3571 C0AA  22 AF46     	LD	(TOKC+2),HL
 3572 C0AD  2A AF2C     	LD	HL,(TOKF3)	; CIRCLE
 3573 C0B0  22 AF48     	LD	(TOKC+4),HL
 3574                   ;
 3575                   ; Treiber im RAM loeschen, Adressbereich 300H bis hierher
 3576                   ;
 3577 C0B3  11 0300     	LD	DE,300H		; WORKRAM von BASIC
 3578 C0B6  21 15CC     	LD	HL,CP-OFFS		; Kopier-Routine
 3579 C0B9  01 0005     	LD	BC,5		; Laenge
 3580 C0BC  ED B0       	LDIR
 3581 C0BE  21 0367     	LD	HL,0367H	; BASIC-Work-RAM wird bis 0367H initialisiert
 3582 C0C1  11 0368     	LD	DE,0368H
 3583 C0C4  01 7C98     	LD	BC,7FFFH-0367H	; gesamter RAM (ausser WORKRAM)
 3584 C0C7  36 00       	LD	(HL),0		; Loeschen
 3585 C0C9  C3 0300     	JP	300H
 3586                   	;
 3587 C0CC  ED B0       CP:	LDIR			; RAM loeschen
 3588 C0CE  C3 C00D     	JP	LDWSP		; BASIC starten
 3589                   ;
 3590                   ;***************************************
 3591                   ;
 3592         15D1      EADR	EQU	$-OFFS		; Endadresse
 3593                   	.dephase
 3594                   
 3595                   	END
 0 Error(s) Detected.
 4945 Absolute Bytes. 558 Symbols Detected.
